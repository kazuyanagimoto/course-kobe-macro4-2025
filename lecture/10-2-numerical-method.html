<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="柳本和春">
<meta name="dcterms.date" content="2025-10-11">

<title>数値計算の補足 – Family Macroeconomics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../static/img/logo.drawio.svg" rel="icon" type="image/svg+xml">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-d1f10ae5b1bd2fcd88626ad4c33800b6.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-a5387b16c79744f55f942101f6586ee8.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-d1f10ae5b1bd2fcd88626ad4c33800b6.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-29a9cb4b6e38590d1988549b314d426b.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-2481093b93c3456eab0eea680925ecdf.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-29a9cb4b6e38590d1988549b314d426b.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="数値計算の補足 – Family Macroeconomics">
<meta property="og:description" content="">
<meta property="og:image" content="https://kazuyanagimoto.github.io/course-kobe-macro4-2025/lecture/static/img/sns-card.drawio.png">
<meta property="og:site_name" content="Family Macroeconomics">
<meta property="og:locale" content="ja_JP">
<meta name="twitter:title" content="数値計算の補足 – Family Macroeconomics">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://kazuyanagimoto.github.io/course-kobe-macro4-2025/lecture/static/img/sns-card.drawio.png">
<meta name="twitter:creator" content="@kazuyanagimoto">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Family Macroeconomics</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../lecture.html"> 
<span class="menu-text">Materials</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/kazuyanagimoto/course-kobe-macro4-2025"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#計算量" id="toc-計算量" class="nav-link active" data-scroll-target="#計算量">計算量</a>
  <ul class="collapse">
  <li><a href="#時間計算量" id="toc-時間計算量" class="nav-link" data-scroll-target="#時間計算量">時間計算量</a></li>
  <li><a href="#領域計算量" id="toc-領域計算量" class="nav-link" data-scroll-target="#領域計算量">領域計算量</a></li>
  <li><a href="#計算量の実践" id="toc-計算量の実践" class="nav-link" data-scroll-target="#計算量の実践">計算量の実践</a></li>
  </ul></li>
  <li><a href="#微分" id="toc-微分" class="nav-link" data-scroll-target="#微分">微分</a>
  <ul class="collapse">
  <li><a href="#数式微分-symbolic-differentiation" id="toc-数式微分-symbolic-differentiation" class="nav-link" data-scroll-target="#数式微分-symbolic-differentiation">数式微分 (Symbolic Differentiation)</a></li>
  <li><a href="#数値微分-numerical-differentiation" id="toc-数値微分-numerical-differentiation" class="nav-link" data-scroll-target="#数値微分-numerical-differentiation">数値微分 (Numerical Differentiation)</a></li>
  <li><a href="#自動微分-automatic-differentiation" id="toc-自動微分-automatic-differentiation" class="nav-link" data-scroll-target="#自動微分-automatic-differentiation">自動微分 (Automatic Differentiation)</a></li>
  </ul></li>
  <li><a href="#並列計算" id="toc-並列計算" class="nav-link" data-scroll-target="#並列計算">並列計算</a></li>
  <li><a href="#monte-carlo-simulation-for-smm" id="toc-monte-carlo-simulation-for-smm" class="nav-link" data-scroll-target="#monte-carlo-simulation-for-smm">Monte Carlo Simulation for SMM</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">数値計算の補足</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">柳本和春 <a href="mailto:yanagimoto@econ.kobe-u.ac.jp" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0009-0007-1967-8304" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            神戸大学
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 11, 2025</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">December 15, 2025</p>
    </div>
  </div>
    
  </div>
  


</header>


<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>このページは数値計算に関する補足を雑多にまとめたものです. 書きかけの内容を多く含みます.</p>
</div>
</div>
<div id="setup" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Plots</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LaTeXStrings</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">default</span>(size<span class="op">=</span>(<span class="fl">500</span>, <span class="fl">309</span>), titlefontsize<span class="op">=</span><span class="fl">10</span>, fmt<span class="op">=:</span>svg)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<section id="計算量" class="level2">
<h2 class="anchored" data-anchor-id="計算量">計算量</h2>
<p>アルゴリズムの効率性を評価する尺度として、計算時間とメモリ使用量があります. ここでいう計算時間とは, アルゴリズムが終了するまでにかかるステップ数 (<strong>時間計算量</strong>, time complexity) のことをいい, 実際のPC上での実行時間とは異なります. より高いスペックのPCを使えば, 同じアルゴリズムでも実行時間は短くなる一方で, ステップ数の次元が異なるアルゴリズムはマシンの性能に関わらず効率的と言えます.また, メモリ使用量とはアルゴリズムが終了するまでに必要なメモリの量 (<strong>領域計算量</strong>, space complexity) のことをいいます.</p>
<section id="時間計算量" class="level3">
<h3 class="anchored" data-anchor-id="時間計算量">時間計算量</h3>
<p>時間計算量は, 入力の大きさ <span class="math inline">\(n\)</span> に対するステップ数 <span class="math inline">\(T(n)\)</span> の関数として表されます. 例えば, 配列の要素数が <span class="math inline">\(n\)</span> のときに, すべての要素を1回ずつ見るアルゴリズムは, <span class="math inline">\(T(n) = n\)</span> となります. また, 2重ループで配列のすべての組み合わせを調べるアルゴリズムは, <span class="math inline">\(T(n) = n^2\)</span> となります. このように, アルゴリズムの時間計算量は, 入力の大きさに対するステップ数の増加率によって特徴づけられます.</p>
<p>時間計算量を評価する際, 重要なのは支配的な項の次元数になります. 例えば, <span class="math inline">\(T(n) = 3n^2 + 2n + 1\)</span> の場合, <span class="math inline">\(n\)</span> が大きくなると <span class="math inline">\(3n^2\)</span> の項が支配的になるため, <span class="math inline">\(n^2\)</span> に着目すれば十分です. この考え方に従ったとき, 計算量を <span class="math inline">\(O(n^2)\)</span> と表記します. より厳密に表現すると以下のようになります.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span><span class="math inline">\(O\)</span>-記法
</div>
</div>
<div class="callout-body-container callout-body">
<p><span class="math inline">\(f(n)\)</span> が <span class="math inline">\(O(g(n))\)</span> とは, 任意の <span class="math inline">\(n \ge 0\)</span> に対して, ある定数 <span class="math inline">\(C &gt; 0\)</span> が存在して, 以下の不等式が成り立つことをいう.</p>
<p><span class="math display">\[
|f(n)| \le C |g(n)|.
\]</span></p>
</div>
</div>
<p>定量モデルで気にする必要があるのは, ほとんどの場合, グリッド数によるオーダーです. 例えば, <span class="math inline">\(V(k, z)\)</span> のような2次元の価値関数をグリッド上で計算する場合, <span class="math inline">\(k\)</span> のグリッド数 <span class="math inline">\(n_k\)</span> と <span class="math inline">\(z\)</span> のグリッド数 <span class="math inline">\(n_z\)</span> に対して, 計算量は <span class="math inline">\(n_k n_z\)</span> の関数となります.</p>
</section>
<section id="領域計算量" class="level3">
<h3 class="anchored" data-anchor-id="領域計算量">領域計算量</h3>
<p>領域計算量は, アルゴリズムが終了するまでに必要なメモリの量を, 入力の大きさ <span class="math inline">\(n\)</span> に対する関数として表します. 例えば, 配列の要素数が <span class="math inline">\(n\)</span> のときに, すべての要素を保存するアルゴリズムは, 領域計算量が <span class="math inline">\(O(n)\)</span> となります. また, 2次元配列を保存するアルゴリズムは, 領域計算量が <span class="math inline">\(O(n^2)\)</span> となります.</p>
<p><strong>メモリのヒエラルキー</strong></p>
<p>なぜメモリの使用量が重要なのでしょうか. 近年のPCは何百GBもの容量があるし, いくら使おうと問題ではないのではないか, と思うかもしれません. しかし, 実際には, メモリのヒエラルキー (memory hierarchy) によって, メモリの速度と容量が大きく異なります.</p>
<p>一般に, 高速なメモリは高価であるため搭載量が少なく, 低速なメモリは安価であるため搭載量が多いです. それらを合わせると <a href="#fig-memory-hierarchy" class="quarto-xref">図&nbsp;1</a> ようなピラミッド型のヒエラルキーが形成されます.</p>
<div id="fig-memory-hierarchy" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-memory-hierarchy-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../static/img/lecture/memory_hierarchy.drawio.svg" class="img-fluid quarto-figure quarto-figure-center figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-memory-hierarchy-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Memory Hierarchy.
</figcaption>
</figure>
</div>
<ul>
<li>レジスタ (Registers): CPU内部にある最も高速なメモリ</li>
<li>キャッシュ (Cache): (近年では) CPU内部にある高速なメモリ. L1, L2, L3 などのレベルがある. ここまでCPU内部にある.</li>
<li>主記憶 (Main Memory): RAM (Random Access Memory)</li>
<li>補助記憶 (Auxiliary Storage): SSD (Solid State Drive) やHDD (Hard Disk Drive)</li>
</ul>
<p>たとえば, AMDの最新世代のCPUである <a href="https://www.amd.com/en/products/processors/desktops/ryzen/9000-series/amd-ryzen-5-9600.html">Ryzen 5 9600</a> の場合, L1キャッシュは480KB, L2キャッシュは6MB, L3キャッシュは32MBです. レジスタはサイズで表現することはあまりありませんが, ざっくり数百B程度と考えてください. 一方で, 一般にメモリと呼ばれる RAM は8GBから64GB 程度が一般的です. さらに, 一般にストレージとよばれるSSDやHDDは数百GBから数TBの容量があります.</p>
</section>
<section id="計算量の実践" class="level3">
<h3 class="anchored" data-anchor-id="計算量の実践">計算量の実践</h3>
<p>実際にモデルを使って, 計算量を測定してみましょう. 例えば, 以下のような単純なライフサイクルモデルを考えます.</p>
<p><strong>Model</strong></p>
<p><span class="math display">\[
\max_{\{c_t, a_{t+1}\}_{t=0}^{T-1}} \sum_{t=0}^{T-1} \beta^t u(c_t) \\
\quad\text{s.t. } c_t + a_{t+1} = (1+r) a_t + w, \quad a_0 \text{ given}, \quad a_T \ge 0.
\]</span></p>
<p>これは後方帰納法で解くことができます. コードで表すと次の <code>solve!</code> 関数のようになります.</p>
<div id="model-life-cycle" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> My</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="pp">@kwdef</span> <span class="kw">struct</span> Model{TF<span class="op">&lt;:</span><span class="dt">AbstractFloat</span>,TI<span class="op">&lt;:</span><span class="dt">Integer</span>}</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Utility function</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    γ<span class="op">::</span><span class="dt">TF </span><span class="op">=</span> <span class="fl">2.0</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    β<span class="op">::</span><span class="dt">TF </span><span class="op">=</span> <span class="fl">0.96</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    T<span class="op">::</span><span class="dt">Int </span><span class="op">=</span> <span class="fl">10</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prices</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    r<span class="op">::</span><span class="dt">TF </span><span class="op">=</span> <span class="fl">0.07</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    w<span class="op">::</span><span class="dt">TF </span><span class="op">=</span> <span class="fl">5.0</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Grid for assets</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    n_a<span class="op">::</span><span class="dt">TI </span><span class="op">=</span> <span class="fl">30</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    a_min<span class="op">::</span><span class="dt">TF </span><span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    a_max<span class="op">::</span><span class="dt">TF </span><span class="op">=</span> <span class="fl">4.0</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    a_grid<span class="op">::</span><span class="dt">Vector{TF} </span><span class="op">=</span> <span class="fu">collect</span>(<span class="fu">range</span>(start<span class="op">=</span>a_min, stop<span class="op">=</span>a_max, length<span class="op">=</span>n_a))</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Value function</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    V<span class="op">::</span><span class="dt">Matrix{TF} </span><span class="op">=</span> <span class="fu">zeros</span>(n_a, T)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="fu">u</span>(c, m<span class="op">::</span><span class="dt">Model</span>) <span class="op">=</span> <span class="fu">isone</span>(m.γ) ? <span class="fu">log</span>(c) <span class="op">:</span> c<span class="op">^</span>(<span class="fl">1</span> <span class="op">-</span> m.γ) <span class="op">/</span> (<span class="fl">1</span> <span class="op">-</span> m.γ)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">solve!</span>(m<span class="op">::</span><span class="dt">Model</span>)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    (; T, n_a, r, w, β, a_grid) <span class="op">=</span> m</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    V <span class="op">=</span> <span class="fu">zeros</span>(n_a, T)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="op">=</span> T<span class="op">:-</span><span class="fl">1</span><span class="op">:</span><span class="fl">1</span>, i_a <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>n_a</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>        utility <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i_a′ <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>n_a</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>            V′ <span class="op">=</span> (t <span class="op">==</span> T) ? <span class="fl">0.0</span> <span class="op">:</span> V[i_a′, t<span class="op">+</span><span class="fl">1</span>]</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>            c <span class="op">=</span> (<span class="fl">1</span> <span class="op">+</span> r) <span class="op">*</span> a_grid[i_a] <span class="op">+</span> w <span class="op">-</span> a_grid[i_a′]</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> c <span class="op">&gt;</span> <span class="fl">0</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>                utility <span class="op">=</span> <span class="fu">max</span>(<span class="fu">u</span>(c, m) <span class="op">+</span> β <span class="op">*</span> V′, utility)</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>        V[i_a, t] <span class="op">=</span> utility</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    m.V <span class="op">.=</span> V</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="cn">nothing</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> <span class="co"># module My</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>時間計算量の数え方として, 四則演算, 比較 (<code>&gt;</code>, <code>max</code> など), 代入, 配列へのアクセスは <span class="math inline">\(O(1)\)</span> とします. すると, 計算回数の主要部は for-loop つまり, <span class="math inline">\(O(n_a^2 T)\)</span> です. メモリ使用量は, 価値関数 <span class="math inline">\(V\)</span> の保存に使用している部分が支配的なので <span class="math inline">\(O(n_a T)\)</span> です. では, <span class="math inline">\(T = 10\)</span> で固定して, <span class="math inline">\(n_a\)</span> を変化させたときの計算時間とメモリ使用量を測定してみましょう.</p>
<p><strong>BenchmarkTools.jl</strong></p>
<p>Juliaでは, <code>BenchmarkTools.jl</code> パッケージを使うと実際の計算時間とメモリ使用量を測定できます.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div id="6" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">BenchmarkTools</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="pp">@benchmark</span> My.<span class="fu">solve!</span>(m) setup <span class="op">=</span> (m <span class="op">=</span> My.<span class="fu">Model</span>(n_a<span class="op">=</span><span class="fl">100</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 10000 samples with 1 evaluation per sample.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">375.375 μs</span> … <span class="ansi-magenta-fg"> 8.924 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 95.52%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">403.458 μs              </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">398.868 μs</span> ± <span class="ansi-green-fg">87.552 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.21% ±  0.96%

  ▇▅▃▃▂▂▁▃▂▁▁▁      <span class="ansi-green-fg">▁</span>▁ <span class="ansi-blue-fg">█</span>▆▄▃▂▂▂▁  ▁  ▁                          ▂
  ██████████████████<span class="ansi-green-fg">█</span>██<span class="ansi-blue-fg">█</span>████████████████████▇▇▇▅▆▆▆▅▅▅▅▅▆▄▅▅▅▄ █
  375 μs<span class="ansi-bright-black-fg">        </span><span class="ansi-bright-black-fg">Histogram: </span><span class="ansi-bright-black-fg ansi-bold">log(</span><span class="ansi-bright-black-fg">frequency</span><span class="ansi-bright-black-fg ansi-bold">)</span><span class="ansi-bright-black-fg"> by time</span>       454 μs <span class="ansi-bold">&lt;</span>

 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">8.08 KiB</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">3</span>.</pre>
</div>
</div>
</div>
<p><code>@benchmark</code> マクロは上記のように関数の実行時間に合わせて適切な試行回数を自動で決定し, 実行時間の分布を表示してくれます. 基本的には中央値 (median) を見るのが良いでしょう.</p>
<p>メモリ使用量も8.08KiBと表示されています. 今回の配列 <code>V</code> は <code>Float64</code> 型の2次元配列で, <span class="math inline">\(n_a\)</span> 行 <span class="math inline">\(T\)</span> 列なので, メモリ使用量は <span class="math inline">\(8 n_a T\)</span> バイトになります (64bit = 8バイト) . 例えば, <span class="math inline">\(n_a = 100\)</span> のときは <span class="math inline">\(8 \times 100 \times 10 = 8000\)</span> バイトで, 8.08KiB (1KiB = 1024バイト) とほぼ一致しています.</p>
<p>次に <span class="math inline">\(n_a = 1000\)</span> としたときの計算時間を測定してみましょう.</p>
<div id="8" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@benchmark</span> My.<span class="fu">solve!</span>(m) setup <span class="op">=</span> (m <span class="op">=</span> My.<span class="fu">Model</span>(n_a<span class="op">=</span><span class="fl">1000</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 127 samples with 1 evaluation per sample.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">38.442 ms</span> … <span class="ansi-magenta-fg"> 41.851 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">39.561 ms               </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">39.541 ms</span> ± <span class="ansi-green-fg">469.936 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%

                  ▄▅▃▃▃<span class="ansi-blue-fg">▃</span>▅█▃▄                                    
  ▅▃▁▆▃▃▁▅▅▁▁▃▁▅▆██████<span class="ansi-blue-fg">█</span>████▇▆█▇▁▁▁▁▃▃▃▁▆▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▃ ▃
  38.4 ms<span class="ansi-bright-black-fg">         Histogram: frequency by time</span>         41.6 ms <span class="ansi-bold">&lt;</span>

 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">80.08 KiB</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">3</span>.</pre>
</div>
</div>
</div>
<p>おおむね計算時間が100倍, メモリ使用量が10倍になっていることがわかります. これは, 計算時間が <span class="math inline">\(O(n_a^2 T)\)</span>, メモリ使用量が <span class="math inline">\(O(n_a T)\)</span> であることと一致しています.</p>
</section>
</section>
<section id="微分" class="level2">
<h2 class="anchored" data-anchor-id="微分">微分</h2>
<p>数値計算の文脈において微分は主に3種類あります.</p>
<ul>
<li>数式微分 (Symbolic Differentiation)</li>
<li>数値微分 (Numerical Differentiation)</li>
<li>自動微分 (Automatic Differentiation)</li>
</ul>
<p>数式微分 (手計算による解析的な微分) が可能な場合は, これが最も高速で効率的ですが, 複雑な関数に対しては, 数値微分や自動微分などで計算する必要があります. 以下では, 次のラグランジアンを例に, それぞれの微分方法を説明します.</p>
<p><span class="math display">\[
\mathcal{L} = \phi \log \left(w(1-l)\right)  + (1-\phi) \frac{l^{1-\gamma}}{1-\gamma}
\]</span></p>
<section id="数式微分-symbolic-differentiation" class="level3">
<h3 class="anchored" data-anchor-id="数式微分-symbolic-differentiation">数式微分 (Symbolic Differentiation)</h3>
<p>いわゆる手計算による微分です. 一階条件を求めると,</p>
<p><span class="math display">\[
\frac{\partial \mathcal{L}}{\partial l} = -\frac{\phi}{1-l} + (1-\phi) l^{-\gamma} = 0.
\]</span></p>
<p><code>Symbolics.jl</code> パッケージを使うと, Julia上で数式微分を行うこともできます.</p>
<div id="symbolic-diff" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Symbolics</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Latexify</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="pp">@variables</span> w l ϕ γ</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> ϕ <span class="op">*</span> <span class="fu">log</span>(w <span class="op">*</span> (<span class="fl">1</span> <span class="op">-</span> l)) <span class="op">+</span> (<span class="fl">1</span> <span class="op">-</span> ϕ) <span class="op">*</span> l<span class="op">^</span>(<span class="fl">1</span> <span class="op">-</span> γ) <span class="op">/</span> (<span class="fl">1</span> <span class="op">-</span> γ)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>∂l <span class="op">=</span> <span class="fu">Differential</span>(l)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>∂L∂l <span class="op">=</span> <span class="fu">expand_derivatives</span>(<span class="fu">∂l</span>(L))</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="fu">latexify</span>(∂L∂l))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><span class="math display">\[\begin{equation}
\frac{ - \phi}{1 - l} + l^{ - \gamma} \left( 1 - \phi \right)
\end{equation}\]</span></p>
</div>
</section>
<section id="数値微分-numerical-differentiation" class="level3">
<h3 class="anchored" data-anchor-id="数値微分-numerical-differentiation">数値微分 (Numerical Differentiation)</h3>
<p><span class="math display">\[
f'(x) = \lim_{\Delta \to 0} \frac{f(x+\Delta) - f(x)}{\Delta}.
\]</span></p>
<p>数値微分は上記の微分の定義を数値的に近似する方法です. 定義通りに行うと, 非常に小さい <span class="math inline">\(d\)</span> (例えば <span class="math inline">\(10^{-9}\)</span> など) を使って, 以下のように近似できます.</p>
<p><span class="math display">\[
f'(x) \approx \frac{f(x+d) - f(x)}{d}.
\]</span></p>
<p>実用上は, 中心差分 (central difference) を使うことが多いです.</p>
<p><span class="math display">\[
f'(x) \approx \frac{f(x+\frac{1}{2}d) - f(x-\frac{1}{2}d)}{d}.
\]</span></p>
<p>Julia では, <code>FiniteDiff.jl</code> パッケージを使うと数値微分ができます.</p>
<div id="numerical-diff" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">FiniteDiff</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(l; w<span class="op">=</span><span class="fl">1</span>., ϕ<span class="op">=</span><span class="fl">0.5</span>, γ<span class="op">=</span><span class="fl">1.5</span>) <span class="op">=</span> ϕ <span class="op">*</span> <span class="fu">log</span>(w <span class="op">*</span> (<span class="fl">1</span> <span class="op">-</span> l)) <span class="op">+</span> (<span class="fl">1</span> <span class="op">-</span> ϕ) <span class="op">*</span> l<span class="op">^</span>(<span class="fl">1</span> <span class="op">-</span> γ) <span class="op">/</span> (<span class="fl">1</span> <span class="op">-</span> γ)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">f′_analytical</span>(l; w<span class="op">=</span><span class="fl">1</span>., ϕ<span class="op">=</span><span class="fl">0.5</span>, γ<span class="op">=</span><span class="fl">1.5</span>) <span class="op">=</span> <span class="op">-</span>ϕ <span class="op">/</span> (<span class="fl">1</span> <span class="op">-</span> l) <span class="op">+</span> (<span class="fl">1</span> <span class="op">-</span> ϕ) <span class="op">*</span> l<span class="op">^</span>(<span class="op">-</span>γ)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">f′_numerical</span>(l; Δ<span class="op">=</span><span class="fl">1e-9</span>) <span class="op">=</span> (<span class="fu">f</span>(l <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> Δ) <span class="op">-</span> <span class="fu">f</span>(l <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> Δ)) <span class="op">/</span> Δ</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">f′_finitediff</span>(l) <span class="op">=</span> FiniteDiff.<span class="fu">finite_difference_derivative</span>(l <span class="op">-&gt;</span> <span class="fu">f</span>(l), l)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-fig-comp-numerical-diff" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fl">0.2</span><span class="op">:</span><span class="fl">0.01</span><span class="op">:</span><span class="fl">0.9</span>, f′_analytical, label<span class="op">=</span><span class="st">"Analytical"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(<span class="fl">0.2</span><span class="op">:</span><span class="fl">0.01</span><span class="op">:</span><span class="fl">0.9</span>, f′_numerical, label<span class="op">=</span><span class="st">"Numerical"</span>, linestyle<span class="op">=:</span>dash)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(<span class="fl">0.2</span><span class="op">:</span><span class="fl">0.01</span><span class="op">:</span><span class="fl">0.9</span>, f′_finitediff, label<span class="op">=</span><span class="st">"FiniteDiff.jl"</span>, linestyle<span class="op">=:</span>dot)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="fig-comp-numerical-diff" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="1">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-comp-numerical-diff-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="500" height="309" viewbox="0 0 2000 1236">
<defs>
  <clippath id="clip300">
    <rect x="0" y="0" width="2000" height="1236"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip300)" d="M0 1236 L2000 1236 L2000 1.24345e-14 L0 1.24345e-14  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip301">
    <rect x="400" y="0" width="1401" height="1236"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip300)" d="M145.191 1128.61 L1952.76 1128.61 L1952.76 47.2441 L145.191 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip302">
    <rect x="145" y="47" width="1809" height="1082"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.348,1128.61 196.348,47.2441 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="683.563,1128.61 683.563,47.2441 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1170.78,1128.61 1170.78,47.2441 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1657.99,1128.61 1657.99,47.2441 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="145.191,1052.93 1952.76,1052.93 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="145.191,835.407 1952.76,835.407 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="145.191,617.88 1952.76,617.88 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="145.191,400.352 1952.76,400.352 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="145.191,182.824 1952.76,182.824 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="145.191,1128.61 1952.76,1128.61 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.348,1128.61 196.348,1109.71 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="683.563,1128.61 683.563,1109.71 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1170.78,1128.61 1170.78,1109.71 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1657.99,1128.61 1657.99,1109.71 "></polyline>
<path clip-path="url(#clip300)" d="M174.531 1156.33 Q170.92 1156.33 169.092 1159.89 Q167.286 1163.44 167.286 1170.57 Q167.286 1177.67 169.092 1181.24 Q170.92 1184.78 174.531 1184.78 Q178.166 1184.78 179.971 1181.24 Q181.8 1177.67 181.8 1170.57 Q181.8 1163.44 179.971 1159.89 Q178.166 1156.33 174.531 1156.33 M174.531 1152.63 Q180.342 1152.63 183.397 1157.23 Q186.476 1161.82 186.476 1170.57 Q186.476 1179.29 183.397 1183.9 Q180.342 1188.48 174.531 1188.48 Q168.721 1188.48 165.643 1183.9 Q162.587 1179.29 162.587 1170.57 Q162.587 1161.82 165.643 1157.23 Q168.721 1152.63 174.531 1152.63 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M194.693 1181.93 L199.578 1181.93 L199.578 1187.81 L194.693 1187.81 L194.693 1181.93 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M213.79 1183.88 L230.11 1183.88 L230.11 1187.81 L208.165 1187.81 L208.165 1183.88 Q210.827 1181.12 215.411 1176.49 Q220.017 1171.84 221.198 1170.5 Q223.443 1167.97 224.323 1166.24 Q225.226 1164.48 225.226 1162.79 Q225.226 1160.03 223.281 1158.3 Q221.36 1156.56 218.258 1156.56 Q216.059 1156.56 213.605 1157.32 Q211.175 1158.09 208.397 1159.64 L208.397 1154.92 Q211.221 1153.78 213.675 1153.2 Q216.128 1152.63 218.165 1152.63 Q223.536 1152.63 226.73 1155.31 Q229.925 1158 229.925 1162.49 Q229.925 1164.62 229.114 1166.54 Q228.327 1168.44 226.221 1171.03 Q225.642 1171.7 222.54 1174.92 Q219.439 1178.11 213.79 1183.88 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M660.704 1156.33 Q657.093 1156.33 655.264 1159.89 Q653.459 1163.44 653.459 1170.57 Q653.459 1177.67 655.264 1181.24 Q657.093 1184.78 660.704 1184.78 Q664.338 1184.78 666.144 1181.24 Q667.972 1177.67 667.972 1170.57 Q667.972 1163.44 666.144 1159.89 Q664.338 1156.33 660.704 1156.33 M660.704 1152.63 Q666.514 1152.63 669.57 1157.23 Q672.648 1161.82 672.648 1170.57 Q672.648 1179.29 669.57 1183.9 Q666.514 1188.48 660.704 1188.48 Q654.894 1188.48 651.815 1183.9 Q648.76 1179.29 648.76 1170.57 Q648.76 1161.82 651.815 1157.23 Q654.894 1152.63 660.704 1152.63 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M680.866 1181.93 L685.75 1181.93 L685.75 1187.81 L680.866 1187.81 L680.866 1181.93 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M708.782 1157.32 L696.977 1175.77 L708.782 1175.77 L708.782 1157.32 M707.556 1153.25 L713.435 1153.25 L713.435 1175.77 L718.366 1175.77 L718.366 1179.66 L713.435 1179.66 L713.435 1187.81 L708.782 1187.81 L708.782 1179.66 L693.181 1179.66 L693.181 1175.15 L707.556 1153.25 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1148.08 1156.33 Q1144.47 1156.33 1142.64 1159.89 Q1140.83 1163.44 1140.83 1170.57 Q1140.83 1177.67 1142.64 1181.24 Q1144.47 1184.78 1148.08 1184.78 Q1151.71 1184.78 1153.52 1181.24 Q1155.35 1177.67 1155.35 1170.57 Q1155.35 1163.44 1153.52 1159.89 Q1151.71 1156.33 1148.08 1156.33 M1148.08 1152.63 Q1153.89 1152.63 1156.95 1157.23 Q1160.02 1161.82 1160.02 1170.57 Q1160.02 1179.29 1156.95 1183.9 Q1153.89 1188.48 1148.08 1188.48 Q1142.27 1188.48 1139.19 1183.9 Q1136.14 1179.29 1136.14 1170.57 Q1136.14 1161.82 1139.19 1157.23 Q1142.27 1152.63 1148.08 1152.63 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1168.24 1181.93 L1173.13 1181.93 L1173.13 1187.81 L1168.24 1187.81 L1168.24 1181.93 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1193.89 1168.67 Q1190.74 1168.67 1188.89 1170.82 Q1187.06 1172.97 1187.06 1176.72 Q1187.06 1180.45 1188.89 1182.63 Q1190.74 1184.78 1193.89 1184.78 Q1197.04 1184.78 1198.87 1182.63 Q1200.72 1180.45 1200.72 1176.72 Q1200.72 1172.97 1198.87 1170.82 Q1197.04 1168.67 1193.89 1168.67 M1203.17 1154.01 L1203.17 1158.27 Q1201.41 1157.44 1199.61 1157 Q1197.83 1156.56 1196.07 1156.56 Q1191.44 1156.56 1188.98 1159.69 Q1186.55 1162.81 1186.21 1169.13 Q1187.57 1167.12 1189.63 1166.05 Q1191.69 1164.96 1194.17 1164.96 Q1199.38 1164.96 1202.39 1168.13 Q1205.42 1171.28 1205.42 1176.72 Q1205.42 1182.05 1202.27 1185.26 Q1199.12 1188.48 1193.89 1188.48 Q1187.89 1188.48 1184.72 1183.9 Q1181.55 1179.29 1181.55 1170.57 Q1181.55 1162.37 1185.44 1157.51 Q1189.33 1152.63 1195.88 1152.63 Q1197.64 1152.63 1199.42 1152.97 Q1201.23 1153.32 1203.17 1154.01 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1635.42 1156.33 Q1631.81 1156.33 1629.98 1159.89 Q1628.18 1163.44 1628.18 1170.57 Q1628.18 1177.67 1629.98 1181.24 Q1631.81 1184.78 1635.42 1184.78 Q1639.06 1184.78 1640.86 1181.24 Q1642.69 1177.67 1642.69 1170.57 Q1642.69 1163.44 1640.86 1159.89 Q1639.06 1156.33 1635.42 1156.33 M1635.42 1152.63 Q1641.23 1152.63 1644.29 1157.23 Q1647.37 1161.82 1647.37 1170.57 Q1647.37 1179.29 1644.29 1183.9 Q1641.23 1188.48 1635.42 1188.48 Q1629.61 1188.48 1626.53 1183.9 Q1623.48 1179.29 1623.48 1170.57 Q1623.48 1161.82 1626.53 1157.23 Q1629.61 1152.63 1635.42 1152.63 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1655.58 1181.93 L1660.47 1181.93 L1660.47 1187.81 L1655.58 1187.81 L1655.58 1181.93 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1680.65 1171.4 Q1677.32 1171.4 1675.4 1173.18 Q1673.5 1174.96 1673.5 1178.09 Q1673.5 1181.21 1675.4 1183 Q1677.32 1184.78 1680.65 1184.78 Q1683.99 1184.78 1685.91 1183 Q1687.83 1181.19 1687.83 1178.09 Q1687.83 1174.96 1685.91 1173.18 Q1684.01 1171.4 1680.65 1171.4 M1675.98 1169.41 Q1672.97 1168.67 1671.28 1166.61 Q1669.61 1164.55 1669.61 1161.58 Q1669.61 1157.44 1672.55 1155.03 Q1675.51 1152.63 1680.65 1152.63 Q1685.82 1152.63 1688.75 1155.03 Q1691.69 1157.44 1691.69 1161.58 Q1691.69 1164.55 1690 1166.61 Q1688.34 1168.67 1685.35 1169.41 Q1688.73 1170.2 1690.61 1172.49 Q1692.5 1174.78 1692.5 1178.09 Q1692.5 1183.11 1689.43 1185.8 Q1686.37 1188.48 1680.65 1188.48 Q1674.94 1188.48 1671.86 1185.8 Q1668.8 1183.11 1668.8 1178.09 Q1668.8 1174.78 1670.7 1172.49 Q1672.6 1170.2 1675.98 1169.41 M1674.26 1162.02 Q1674.26 1164.71 1675.93 1166.21 Q1677.62 1167.72 1680.65 1167.72 Q1683.66 1167.72 1685.35 1166.21 Q1687.07 1164.71 1687.07 1162.02 Q1687.07 1159.34 1685.35 1157.83 Q1683.66 1156.33 1680.65 1156.33 Q1677.62 1156.33 1675.93 1157.83 Q1674.26 1159.34 1674.26 1162.02 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="145.191,1128.61 145.191,47.2441 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="145.191,1052.93 164.089,1052.93 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="145.191,835.407 164.089,835.407 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="145.191,617.88 164.089,617.88 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="145.191,400.352 164.089,400.352 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="145.191,182.824 164.089,182.824 "></polyline>
<path clip-path="url(#clip300)" d="M52.9921 1053.39 L82.6679 1053.39 L82.6679 1057.32 L52.9921 1057.32 L52.9921 1053.39 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M105.608 1039.73 L93.8021 1058.18 L105.608 1058.18 L105.608 1039.73 M104.381 1035.65 L110.26 1035.65 L110.26 1058.18 L115.191 1058.18 L115.191 1062.07 L110.26 1062.07 L110.26 1070.21 L105.608 1070.21 L105.608 1062.07 L90.0058 1062.07 L90.0058 1057.55 L104.381 1035.65 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M55.0754 835.859 L84.7512 835.859 L84.7512 839.794 L55.0754 839.794 L55.0754 835.859 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M98.8715 848.752 L115.191 848.752 L115.191 852.687 L93.2465 852.687 L93.2465 848.752 Q95.9086 845.998 100.492 841.368 Q105.098 836.715 106.279 835.373 Q108.524 832.849 109.404 831.113 Q110.307 829.354 110.307 827.664 Q110.307 824.91 108.362 823.174 Q106.441 821.438 103.339 821.438 Q101.14 821.438 98.6863 822.201 Q96.2558 822.965 93.478 824.516 L93.478 819.794 Q96.3021 818.66 98.7558 818.081 Q101.209 817.502 103.246 817.502 Q108.617 817.502 111.811 820.188 Q115.006 822.873 115.006 827.363 Q115.006 829.493 114.196 831.414 Q113.408 833.312 111.302 835.905 Q110.723 836.576 107.621 839.794 Q104.52 842.988 98.8715 848.752 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M103.246 603.678 Q99.6354 603.678 97.8067 607.243 Q96.0012 610.785 96.0012 617.914 Q96.0012 625.021 97.8067 628.586 Q99.6354 632.127 103.246 632.127 Q106.881 632.127 108.686 628.586 Q110.515 625.021 110.515 617.914 Q110.515 610.785 108.686 607.243 Q106.881 603.678 103.246 603.678 M103.246 599.975 Q109.057 599.975 112.112 604.581 Q115.191 609.164 115.191 617.914 Q115.191 626.641 112.112 631.248 Q109.057 635.831 103.246 635.831 Q97.4363 635.831 94.3576 631.248 Q91.3021 626.641 91.3021 617.914 Q91.3021 609.164 94.3576 604.581 Q97.4363 599.975 103.246 599.975 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M98.8715 413.697 L115.191 413.697 L115.191 417.632 L93.2465 417.632 L93.2465 413.697 Q95.9086 410.942 100.492 406.313 Q105.098 401.66 106.279 400.317 Q108.524 397.794 109.404 396.058 Q110.307 394.299 110.307 392.609 Q110.307 389.854 108.362 388.118 Q106.441 386.382 103.339 386.382 Q101.14 386.382 98.6863 387.146 Q96.2558 387.91 93.478 389.461 L93.478 384.739 Q96.3021 383.604 98.7558 383.026 Q101.209 382.447 103.246 382.447 Q108.617 382.447 111.811 385.132 Q115.006 387.817 115.006 392.308 Q115.006 394.438 114.196 396.359 Q113.408 398.257 111.302 400.85 Q110.723 401.521 107.621 404.739 Q104.52 407.933 98.8715 413.697 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M105.608 169.618 L93.8021 188.067 L105.608 188.067 L105.608 169.618 M104.381 165.544 L110.26 165.544 L110.26 188.067 L115.191 188.067 L115.191 191.956 L110.26 191.956 L110.26 200.104 L105.608 200.104 L105.608 191.956 L90.0058 191.956 L90.0058 187.442 L104.381 165.544 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip302)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.348,77.8489 220.709,121.617 245.07,160.588 269.431,195.488 293.791,226.907 318.152,255.334 342.513,281.17 366.873,304.753 391.234,326.367 415.595,346.251 439.956,364.61 464.316,381.621 488.677,397.433 513.038,412.178 537.398,425.97 561.759,438.909 586.12,451.083 610.481,462.57 634.841,473.437 659.202,483.746 683.563,493.553 707.923,502.905 732.284,511.849 756.645,520.422 781.006,528.663 805.366,536.605 829.727,544.279 854.088,551.712 878.448,558.932 902.809,565.963 927.17,572.828 951.531,579.55 975.891,586.148 1000.25,592.644 1024.61,599.056 1048.97,605.404 1073.33,611.706 1097.69,617.98 1122.06,624.245 1146.42,630.52 1170.78,636.823 1195.14,643.175 1219.5,649.595 1243.86,656.104 1268.22,662.726 1292.58,669.484 1316.94,676.403 1341.3,683.512 1365.66,690.841 1390.02,698.424 1414.38,706.297 1438.74,714.503 1463.11,723.087 1487.47,732.103 1511.83,741.612 1536.19,751.681 1560.55,762.392 1584.91,773.837 1609.27,786.127 1633.63,799.393 1657.99,813.788 1682.35,829.502 1706.71,846.764 1731.07,865.855 1755.43,887.129 1779.79,911.031 1804.16,938.134 1828.52,969.187 1852.88,1005.19 1877.24,1047.49 1901.6,1098.01 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" stroke-dasharray="16, 10" points="196.348,77.8488 220.709,121.617 245.07,160.588 269.431,195.488 293.791,226.907 318.152,255.334 342.513,281.17 366.873,304.753 391.234,326.367 415.595,346.251 439.956,364.61 464.316,381.621 488.677,397.433 513.038,412.178 537.398,425.97 561.759,438.909 586.12,451.083 610.481,462.57 634.841,473.437 659.202,483.746 683.563,493.553 707.923,502.905 732.284,511.849 756.645,520.422 781.006,528.663 805.366,536.605 829.727,544.279 854.088,551.712 878.448,558.932 902.809,565.963 927.17,572.828 951.531,579.55 975.891,586.148 1000.25,592.644 1024.61,599.056 1048.97,605.404 1073.33,611.706 1097.69,617.98 1122.06,624.245 1146.42,630.52 1170.78,636.823 1195.14,643.175 1219.5,649.595 1243.86,656.104 1268.22,662.726 1292.58,669.484 1316.94,676.403 1341.3,683.512 1365.66,690.841 1390.02,698.424 1414.38,706.297 1438.74,714.503 1463.11,723.087 1487.47,732.104 1511.83,741.612 1536.19,751.681 1560.55,762.392 1584.91,773.837 1609.27,786.127 1633.63,799.393 1657.99,813.788 1682.35,829.502 1706.71,846.764 1731.07,865.855 1755.43,887.129 1779.79,911.031 1804.16,938.134 1828.52,969.187 1852.88,1005.19 1877.24,1047.49 1901.6,1098.01 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" stroke-dasharray="2, 4" points="196.348,77.8489 220.709,121.617 245.07,160.588 269.431,195.488 293.791,226.907 318.152,255.334 342.513,281.17 366.873,304.753 391.234,326.367 415.595,346.251 439.956,364.61 464.316,381.621 488.677,397.433 513.038,412.178 537.398,425.97 561.759,438.909 586.12,451.083 610.481,462.57 634.841,473.437 659.202,483.746 683.563,493.553 707.923,502.905 732.284,511.849 756.645,520.422 781.006,528.663 805.366,536.605 829.727,544.279 854.088,551.712 878.448,558.932 902.809,565.963 927.17,572.828 951.531,579.55 975.891,586.148 1000.25,592.644 1024.61,599.056 1048.97,605.404 1073.33,611.706 1097.69,617.98 1122.06,624.245 1146.42,630.52 1170.78,636.823 1195.14,643.175 1219.5,649.595 1243.86,656.104 1268.22,662.726 1292.58,669.484 1316.94,676.403 1341.3,683.512 1365.66,690.841 1390.02,698.424 1414.38,706.297 1438.74,714.503 1463.11,723.087 1487.47,732.103 1511.83,741.612 1536.19,751.681 1560.55,762.392 1584.91,773.837 1609.27,786.127 1633.63,799.393 1657.99,813.788 1682.35,829.502 1706.71,846.764 1731.07,865.855 1755.43,887.129 1779.79,911.031 1804.16,938.134 1828.52,969.187 1852.88,1005.19 1877.24,1047.49 1901.6,1098.01 "></polyline>
<path clip-path="url(#clip300)" d="M1471.86 290.65 L1892.5 290.65 L1892.5 83.2896 L1471.86 83.2896  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1471.86,290.65 1892.5,290.65 1892.5,83.2896 1471.86,83.2896 1471.86,290.65 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1491.95,135.13 1612.45,135.13 "></polyline>
<path clip-path="url(#clip300)" d="M1648.37 122.456 L1642.03 139.655 L1654.74 139.655 L1648.37 122.456 M1645.73 117.85 L1651.03 117.85 L1664.2 152.41 L1659.34 152.41 L1656.19 143.544 L1640.62 143.544 L1637.47 152.41 L1632.54 152.41 L1645.73 117.85 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1690.62 136.762 L1690.62 152.41 L1686.36 152.41 L1686.36 136.9 Q1686.36 133.22 1684.92 131.391 Q1683.49 129.563 1680.62 129.563 Q1677.17 129.563 1675.18 131.762 Q1673.18 133.961 1673.18 137.757 L1673.18 152.41 L1668.9 152.41 L1668.9 126.484 L1673.18 126.484 L1673.18 130.512 Q1674.71 128.174 1676.77 127.016 Q1678.86 125.859 1681.56 125.859 Q1686.03 125.859 1688.32 128.637 Q1690.62 131.391 1690.62 136.762 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1710.89 139.377 Q1705.73 139.377 1703.74 140.558 Q1701.75 141.738 1701.75 144.586 Q1701.75 146.854 1703.23 148.197 Q1704.74 149.516 1707.3 149.516 Q1710.85 149.516 1712.98 147.016 Q1715.13 144.493 1715.13 140.326 L1715.13 139.377 L1710.89 139.377 M1719.39 137.618 L1719.39 152.41 L1715.13 152.41 L1715.13 148.474 Q1713.67 150.836 1711.49 151.97 Q1709.32 153.081 1706.17 153.081 Q1702.19 153.081 1699.83 150.859 Q1697.49 148.613 1697.49 144.863 Q1697.49 140.488 1700.41 138.266 Q1703.35 136.044 1709.16 136.044 L1715.13 136.044 L1715.13 135.627 Q1715.13 132.688 1713.18 131.09 Q1711.26 129.47 1707.77 129.47 Q1705.55 129.47 1703.44 130.002 Q1701.33 130.535 1699.39 131.6 L1699.39 127.664 Q1701.73 126.762 1703.93 126.322 Q1706.12 125.859 1708.21 125.859 Q1713.83 125.859 1716.61 128.776 Q1719.39 131.692 1719.39 137.618 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1728.16 116.391 L1732.42 116.391 L1732.42 152.41 L1728.16 152.41 L1728.16 116.391 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1752.12 154.817 Q1750.31 159.447 1748.6 160.859 Q1746.89 162.271 1744.02 162.271 L1740.61 162.271 L1740.61 158.706 L1743.11 158.706 Q1744.87 158.706 1745.85 157.873 Q1746.82 157.039 1748 153.937 L1748.76 151.993 L1738.28 126.484 L1742.79 126.484 L1750.89 146.762 L1758.99 126.484 L1763.51 126.484 L1752.12 154.817 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1773.6 119.123 L1773.6 126.484 L1782.37 126.484 L1782.37 129.794 L1773.6 129.794 L1773.6 143.868 Q1773.6 147.039 1774.46 147.942 Q1775.34 148.845 1778 148.845 L1782.37 148.845 L1782.37 152.41 L1778 152.41 Q1773.07 152.41 1771.19 150.581 Q1769.32 148.729 1769.32 143.868 L1769.32 129.794 L1766.19 129.794 L1766.19 126.484 L1769.32 126.484 L1769.32 119.123 L1773.6 119.123 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1787.98 126.484 L1792.23 126.484 L1792.23 152.41 L1787.98 152.41 L1787.98 126.484 M1787.98 116.391 L1792.23 116.391 L1792.23 121.785 L1787.98 121.785 L1787.98 116.391 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1819.8 127.479 L1819.8 131.461 Q1818 130.465 1816.17 129.979 Q1814.36 129.47 1812.51 129.47 Q1808.37 129.47 1806.08 132.109 Q1803.79 134.725 1803.79 139.47 Q1803.79 144.215 1806.08 146.854 Q1808.37 149.47 1812.51 149.47 Q1814.36 149.47 1816.17 148.984 Q1818 148.474 1819.8 147.479 L1819.8 151.414 Q1818.02 152.248 1816.1 152.664 Q1814.2 153.081 1812.05 153.081 Q1806.19 153.081 1802.74 149.4 Q1799.3 145.72 1799.3 139.47 Q1799.3 133.127 1802.77 129.493 Q1806.26 125.859 1812.33 125.859 Q1814.29 125.859 1816.17 126.276 Q1818.04 126.669 1819.8 127.479 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1838.99 139.377 Q1833.83 139.377 1831.84 140.558 Q1829.85 141.738 1829.85 144.586 Q1829.85 146.854 1831.33 148.197 Q1832.84 149.516 1835.41 149.516 Q1838.95 149.516 1841.08 147.016 Q1843.23 144.493 1843.23 140.326 L1843.23 139.377 L1838.99 139.377 M1847.49 137.618 L1847.49 152.41 L1843.23 152.41 L1843.23 148.474 Q1841.77 150.836 1839.6 151.97 Q1837.42 153.081 1834.27 153.081 Q1830.29 153.081 1827.93 150.859 Q1825.59 148.613 1825.59 144.863 Q1825.59 140.488 1828.51 138.266 Q1831.45 136.044 1837.26 136.044 L1843.23 136.044 L1843.23 135.627 Q1843.23 132.688 1841.29 131.09 Q1839.36 129.47 1835.87 129.47 Q1833.65 129.47 1831.54 130.002 Q1829.43 130.535 1827.49 131.6 L1827.49 127.664 Q1829.83 126.762 1832.03 126.322 Q1834.23 125.859 1836.31 125.859 Q1841.93 125.859 1844.71 128.776 Q1847.49 131.692 1847.49 137.618 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1856.26 116.391 L1860.52 116.391 L1860.52 152.41 L1856.26 152.41 L1856.26 116.391 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip300)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" stroke-dasharray="16, 10" points="1491.95,186.97 1612.45,186.97 "></polyline>
<path clip-path="url(#clip300)" d="M1632.54 169.69 L1638.83 169.69 L1654.16 198.602 L1654.16 169.69 L1658.69 169.69 L1658.69 204.25 L1652.4 204.25 L1637.07 175.338 L1637.07 204.25 L1632.54 204.25 L1632.54 169.69 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1667.37 194.018 L1667.37 178.324 L1671.63 178.324 L1671.63 193.856 Q1671.63 197.537 1673.07 199.389 Q1674.5 201.217 1677.37 201.217 Q1680.82 201.217 1682.81 199.018 Q1684.83 196.819 1684.83 193.023 L1684.83 178.324 L1689.09 178.324 L1689.09 204.25 L1684.83 204.25 L1684.83 200.268 Q1683.28 202.629 1681.22 203.787 Q1679.18 204.921 1676.47 204.921 Q1672 204.921 1669.69 202.143 Q1667.37 199.365 1667.37 194.018 M1678.09 177.699 L1678.09 177.699 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1718.05 183.301 Q1719.64 180.43 1721.86 179.065 Q1724.09 177.699 1727.1 177.699 Q1731.15 177.699 1733.35 180.546 Q1735.55 183.37 1735.55 188.602 L1735.55 204.25 L1731.26 204.25 L1731.26 188.74 Q1731.26 185.014 1729.94 183.208 Q1728.62 181.403 1725.92 181.403 Q1722.61 181.403 1720.68 183.602 Q1718.76 185.801 1718.76 189.597 L1718.76 204.25 L1714.48 204.25 L1714.48 188.74 Q1714.48 184.99 1713.16 183.208 Q1711.84 181.403 1709.09 181.403 Q1705.82 181.403 1703.9 183.625 Q1701.98 185.824 1701.98 189.597 L1701.98 204.25 L1697.7 204.25 L1697.7 178.324 L1701.98 178.324 L1701.98 182.352 Q1703.44 179.967 1705.48 178.833 Q1707.51 177.699 1710.31 177.699 Q1713.14 177.699 1715.11 179.134 Q1717.1 180.569 1718.05 183.301 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1766.22 190.222 L1766.22 192.305 L1746.63 192.305 Q1746.91 196.703 1749.27 199.018 Q1751.66 201.31 1755.89 201.31 Q1758.35 201.31 1760.64 200.708 Q1762.95 200.106 1765.22 198.902 L1765.22 202.93 Q1762.93 203.902 1760.52 204.412 Q1758.11 204.921 1755.64 204.921 Q1749.43 204.921 1745.8 201.31 Q1742.19 197.699 1742.19 191.541 Q1742.19 185.176 1745.61 181.449 Q1749.06 177.699 1754.9 177.699 Q1760.13 177.699 1763.16 181.078 Q1766.22 184.435 1766.22 190.222 M1761.96 188.972 Q1761.91 185.477 1759.99 183.393 Q1758.09 181.31 1754.94 181.31 Q1751.38 181.31 1749.23 183.324 Q1747.1 185.338 1746.77 188.995 L1761.96 188.972 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1788.23 182.305 Q1787.51 181.889 1786.66 181.703 Q1785.82 181.495 1784.8 181.495 Q1781.19 181.495 1779.25 183.856 Q1777.33 186.194 1777.33 190.592 L1777.33 204.25 L1773.05 204.25 L1773.05 178.324 L1777.33 178.324 L1777.33 182.352 Q1778.67 179.991 1780.82 178.856 Q1782.98 177.699 1786.05 177.699 Q1786.49 177.699 1787.03 177.768 Q1787.56 177.815 1788.21 177.93 L1788.23 182.305 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1792.7 178.324 L1796.96 178.324 L1796.96 204.25 L1792.7 204.25 L1792.7 178.324 M1792.7 168.231 L1796.96 168.231 L1796.96 173.625 L1792.7 173.625 L1792.7 168.231 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1824.53 179.319 L1824.53 183.301 Q1822.72 182.305 1820.89 181.819 Q1819.09 181.31 1817.23 181.31 Q1813.09 181.31 1810.8 183.949 Q1808.51 186.565 1808.51 191.31 Q1808.51 196.055 1810.8 198.694 Q1813.09 201.31 1817.23 201.31 Q1819.09 201.31 1820.89 200.824 Q1822.72 200.314 1824.53 199.319 L1824.53 203.254 Q1822.74 204.088 1820.82 204.504 Q1818.92 204.921 1816.77 204.921 Q1810.92 204.921 1807.47 201.24 Q1804.02 197.56 1804.02 191.31 Q1804.02 184.967 1807.49 181.333 Q1810.98 177.699 1817.05 177.699 Q1819.02 177.699 1820.89 178.116 Q1822.77 178.509 1824.53 179.319 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1843.72 191.217 Q1838.55 191.217 1836.56 192.398 Q1834.57 193.578 1834.57 196.426 Q1834.57 198.694 1836.05 200.037 Q1837.56 201.356 1840.13 201.356 Q1843.67 201.356 1845.8 198.856 Q1847.95 196.333 1847.95 192.166 L1847.95 191.217 L1843.72 191.217 M1852.21 189.458 L1852.21 204.25 L1847.95 204.25 L1847.95 200.314 Q1846.49 202.676 1844.32 203.81 Q1842.14 204.921 1838.99 204.921 Q1835.01 204.921 1832.65 202.699 Q1830.31 200.453 1830.31 196.703 Q1830.31 192.328 1833.23 190.106 Q1836.17 187.884 1841.98 187.884 L1847.95 187.884 L1847.95 187.467 Q1847.95 184.528 1846.01 182.93 Q1844.09 181.31 1840.59 181.31 Q1838.37 181.31 1836.26 181.842 Q1834.16 182.375 1832.21 183.44 L1832.21 179.504 Q1834.55 178.602 1836.75 178.162 Q1838.95 177.699 1841.03 177.699 Q1846.66 177.699 1849.43 180.616 Q1852.21 183.532 1852.21 189.458 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1860.98 168.231 L1865.24 168.231 L1865.24 204.25 L1860.98 204.25 L1860.98 168.231 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip300)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" stroke-dasharray="2, 4" points="1491.95,238.81 1612.45,238.81 "></polyline>
<path clip-path="url(#clip300)" d="M1632.54 221.53 L1652.4 221.53 L1652.4 225.465 L1637.21 225.465 L1637.21 235.65 L1650.92 235.65 L1650.92 239.585 L1637.21 239.585 L1637.21 256.09 L1632.54 256.09 L1632.54 221.53 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1656.17 230.164 L1660.43 230.164 L1660.43 256.09 L1656.17 256.09 L1656.17 230.164 M1656.17 220.071 L1660.43 220.071 L1660.43 225.465 L1656.17 225.465 L1656.17 220.071 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1690.89 240.442 L1690.89 256.09 L1686.63 256.09 L1686.63 240.58 Q1686.63 236.9 1685.2 235.071 Q1683.76 233.243 1680.89 233.243 Q1677.44 233.243 1675.45 235.442 Q1673.46 237.641 1673.46 241.437 L1673.46 256.09 L1669.18 256.09 L1669.18 230.164 L1673.46 230.164 L1673.46 234.192 Q1674.99 231.854 1677.05 230.696 Q1679.13 229.539 1681.84 229.539 Q1686.31 229.539 1688.6 232.317 Q1690.89 235.071 1690.89 240.442 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1699.39 230.164 L1703.65 230.164 L1703.65 256.09 L1699.39 256.09 L1699.39 230.164 M1699.39 220.071 L1703.65 220.071 L1703.65 225.465 L1699.39 225.465 L1699.39 220.071 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1716.77 222.803 L1716.77 230.164 L1725.55 230.164 L1725.55 233.474 L1716.77 233.474 L1716.77 247.548 Q1716.77 250.719 1717.63 251.622 Q1718.51 252.525 1721.17 252.525 L1725.55 252.525 L1725.55 256.09 L1721.17 256.09 Q1716.24 256.09 1714.36 254.261 Q1712.49 252.409 1712.49 247.548 L1712.49 233.474 L1709.36 233.474 L1709.36 230.164 L1712.49 230.164 L1712.49 222.803 L1716.77 222.803 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1753.32 242.062 L1753.32 244.145 L1733.74 244.145 Q1734.02 248.543 1736.38 250.858 Q1738.76 253.15 1743 253.15 Q1745.45 253.15 1747.74 252.548 Q1750.06 251.946 1752.33 250.742 L1752.33 254.77 Q1750.04 255.742 1747.63 256.252 Q1745.22 256.761 1742.74 256.761 Q1736.54 256.761 1732.91 253.15 Q1729.3 249.539 1729.3 243.381 Q1729.3 237.016 1732.72 233.289 Q1736.17 229.539 1742 229.539 Q1747.24 229.539 1750.27 232.918 Q1753.32 236.275 1753.32 242.062 M1749.06 240.812 Q1749.02 237.317 1747.1 235.233 Q1745.2 233.15 1742.05 233.15 Q1738.49 233.15 1736.33 235.164 Q1734.2 237.178 1733.88 240.835 L1749.06 240.812 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1765.17 225.372 L1765.17 252.247 L1770.82 252.247 Q1777.98 252.247 1781.29 249.006 Q1784.62 245.766 1784.62 238.775 Q1784.62 231.831 1781.29 228.613 Q1777.98 225.372 1770.82 225.372 L1765.17 225.372 M1760.5 221.53 L1770.11 221.53 Q1780.15 221.53 1784.85 225.719 Q1789.55 229.886 1789.55 238.775 Q1789.55 247.71 1784.83 251.9 Q1780.11 256.09 1770.11 256.09 L1760.5 256.09 L1760.5 221.53 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1796.82 230.164 L1801.08 230.164 L1801.08 256.09 L1796.82 256.09 L1796.82 230.164 M1796.82 220.071 L1801.08 220.071 L1801.08 225.465 L1796.82 225.465 L1796.82 220.071 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1823.11 220.071 L1823.11 223.613 L1819.04 223.613 Q1816.75 223.613 1815.85 224.539 Q1814.97 225.465 1814.97 227.872 L1814.97 230.164 L1821.98 230.164 L1821.98 233.474 L1814.97 233.474 L1814.97 256.09 L1810.68 256.09 L1810.68 233.474 L1806.61 233.474 L1806.61 230.164 L1810.68 230.164 L1810.68 228.358 Q1810.68 224.03 1812.7 222.062 Q1814.71 220.071 1819.09 220.071 L1823.11 220.071 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1839.8 220.071 L1839.8 223.613 L1835.73 223.613 Q1833.44 223.613 1832.54 224.539 Q1831.66 225.465 1831.66 227.872 L1831.66 230.164 L1838.67 230.164 L1838.67 233.474 L1831.66 233.474 L1831.66 256.09 L1827.37 256.09 L1827.37 233.474 L1823.3 233.474 L1823.3 230.164 L1827.37 230.164 L1827.37 228.358 Q1827.37 224.03 1829.39 222.062 Q1831.4 220.071 1835.78 220.071 L1839.8 220.071 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1840.52 250.21 L1845.41 250.21 L1845.41 256.09 L1840.52 256.09 L1840.52 250.21 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1854.99 230.164 L1859.25 230.164 L1859.25 256.553 Q1859.25 261.506 1857.35 263.728 Q1855.48 265.951 1851.29 265.951 L1849.67 265.951 L1849.67 262.34 L1850.8 262.34 Q1853.23 262.34 1854.11 261.205 Q1854.99 260.094 1854.99 256.553 L1854.99 230.164 M1854.99 220.071 L1859.25 220.071 L1859.25 225.465 L1854.99 225.465 L1854.99 220.071 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1868.16 220.071 L1872.42 220.071 L1872.42 256.09 L1868.16 256.09 L1868.16 220.071 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path></svg>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-comp-numerical-diff-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Comparison of analytical and numerical derivatives.
</figcaption>
</figure>
</div>
</div>
</section>
<section id="自動微分-automatic-differentiation" class="level3">
<h3 class="anchored" data-anchor-id="自動微分-automatic-differentiation">自動微分 (Automatic Differentiation)</h3>
<p>数値微分はとてもシンプルな実装ですが, <span class="math inline">\(d\)</span> の選び方によっては精度が悪くなる可能性があります. より高い精度を求める場合は, 自動微分を用いることができます. 自動微分は, 関数を基本的な演算 (多項式, 三角関数, 対数関数など) の組み合わせとして分解し, 各基本演算の微分を連鎖律に基づいて計算する方法です. これは, 数式微分を数値的に実行するようなイメージです.</p>
<p><strong>順伝播と逆伝播</strong></p>
<p><span class="math display">\[
\frac{dy}{dx} = \frac{dy}{du} \cdot \frac{du}{dx}
\]</span></p>
<ul>
<li>順伝播 (forward mode): 入力から出力に向かって微分を計算する方法.
<ul>
<li><span class="math inline">\(\frac{du}{dx}\)</span> を計算し, それを用いて <span class="math inline">\(\frac{dy}{du}\)</span> を計算する.</li>
</ul></li>
<li>逆伝播 (reverse mode): 出力から入力に向かって微分を計算する方法.
<ul>
<li><span class="math inline">\(\frac{dy}{du}\)</span> を計算し, それを用いて <span class="math inline">\(\frac{du}{dx}\)</span> を計算する.</li>
</ul></li>
</ul>
<p>一般に <span class="math inline">\(f: \mathbb{R}^m \to \mathbb{R}^n\)</span> に対して, <span class="math inline">\(m &gt; n\)</span> の場合は逆伝播が効率的であり, <span class="math inline">\(m &lt; n\)</span> の場合は順伝播が効率的です. 例えば, ニューラルネットワークでは, 多数のパラメータ (重み) を持つモデルに対して, 単一の損失関数を最小化するために逆伝播がよく使われます.</p>
<p>順伝播の効率的な実装は双対数 (dual numbers) を用いて行えることが知られています. 一方, 逆伝播の効率的な実装は難しく, 様々な手法が提案されている状況です. 詳しくは, <span class="citation" data-cites="perla">Perla, Sargent, and Stachurski (<a href="#ref-perla" role="doc-biblioref">n.d.</a>)</span> の<a href="https://julia.quantecon.org/more_julia/optimization_solver_packages.html">9.2節</a> を参照してください.</p>
<p>Julia では, <code>ForwardDiff.jl</code> パッケージを使うと順伝播の自動微分ができます.</p>
<div id="automatic-diff" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ForwardDiff</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">f′_forwarddiff</span>(l) <span class="op">=</span> ForwardDiff.<span class="fu">derivative</span>(l <span class="op">-&gt;</span> <span class="fu">f</span>(l), l)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-fig-comp-automatic-diff" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fl">0.2</span><span class="op">:</span><span class="fl">0.01</span><span class="op">:</span><span class="fl">0.9</span>, f′_analytical, label<span class="op">=</span><span class="st">"Analytical"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(<span class="fl">0.2</span><span class="op">:</span><span class="fl">0.01</span><span class="op">:</span><span class="fl">0.9</span>, f′_forwarddiff, label<span class="op">=</span><span class="st">"ForwardDiff.jl"</span>, linestyle<span class="op">=:</span>dash)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="fig-comp-automatic-diff" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="1">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-comp-automatic-diff-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="500" height="309" viewbox="0 0 2000 1236">
<defs>
  <clippath id="clip360">
    <rect x="0" y="0" width="2000" height="1236"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip360)" d="M0 1236 L2000 1236 L2000 1.24345e-14 L0 1.24345e-14  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip361">
    <rect x="400" y="0" width="1401" height="1236"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip360)" d="M145.191 1128.61 L1952.76 1128.61 L1952.76 47.2441 L145.191 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip362">
    <rect x="145" y="47" width="1809" height="1082"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip362)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.348,1128.61 196.348,47.2441 "></polyline>
<polyline clip-path="url(#clip362)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="683.563,1128.61 683.563,47.2441 "></polyline>
<polyline clip-path="url(#clip362)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1170.78,1128.61 1170.78,47.2441 "></polyline>
<polyline clip-path="url(#clip362)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1657.99,1128.61 1657.99,47.2441 "></polyline>
<polyline clip-path="url(#clip362)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="145.191,1052.94 1952.76,1052.94 "></polyline>
<polyline clip-path="url(#clip362)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="145.191,835.407 1952.76,835.407 "></polyline>
<polyline clip-path="url(#clip362)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="145.191,617.88 1952.76,617.88 "></polyline>
<polyline clip-path="url(#clip362)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="145.191,400.352 1952.76,400.352 "></polyline>
<polyline clip-path="url(#clip362)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="145.191,182.824 1952.76,182.824 "></polyline>
<polyline clip-path="url(#clip360)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="145.191,1128.61 1952.76,1128.61 "></polyline>
<polyline clip-path="url(#clip360)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.348,1128.61 196.348,1109.71 "></polyline>
<polyline clip-path="url(#clip360)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="683.563,1128.61 683.563,1109.71 "></polyline>
<polyline clip-path="url(#clip360)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1170.78,1128.61 1170.78,1109.71 "></polyline>
<polyline clip-path="url(#clip360)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1657.99,1128.61 1657.99,1109.71 "></polyline>
<path clip-path="url(#clip360)" d="M174.531 1156.33 Q170.92 1156.33 169.092 1159.89 Q167.286 1163.44 167.286 1170.57 Q167.286 1177.67 169.092 1181.24 Q170.92 1184.78 174.531 1184.78 Q178.166 1184.78 179.971 1181.24 Q181.8 1177.67 181.8 1170.57 Q181.8 1163.44 179.971 1159.89 Q178.166 1156.33 174.531 1156.33 M174.531 1152.63 Q180.342 1152.63 183.397 1157.23 Q186.476 1161.82 186.476 1170.57 Q186.476 1179.29 183.397 1183.9 Q180.342 1188.48 174.531 1188.48 Q168.721 1188.48 165.643 1183.9 Q162.587 1179.29 162.587 1170.57 Q162.587 1161.82 165.643 1157.23 Q168.721 1152.63 174.531 1152.63 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M194.693 1181.93 L199.578 1181.93 L199.578 1187.81 L194.693 1187.81 L194.693 1181.93 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M213.79 1183.88 L230.11 1183.88 L230.11 1187.81 L208.165 1187.81 L208.165 1183.88 Q210.827 1181.12 215.411 1176.49 Q220.017 1171.84 221.198 1170.5 Q223.443 1167.97 224.323 1166.24 Q225.226 1164.48 225.226 1162.79 Q225.226 1160.03 223.281 1158.3 Q221.36 1156.56 218.258 1156.56 Q216.059 1156.56 213.605 1157.32 Q211.175 1158.09 208.397 1159.64 L208.397 1154.92 Q211.221 1153.78 213.675 1153.2 Q216.128 1152.63 218.165 1152.63 Q223.536 1152.63 226.73 1155.31 Q229.925 1158 229.925 1162.49 Q229.925 1164.62 229.114 1166.54 Q228.327 1168.44 226.221 1171.03 Q225.642 1171.7 222.54 1174.92 Q219.439 1178.11 213.79 1183.88 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M660.704 1156.33 Q657.093 1156.33 655.264 1159.89 Q653.459 1163.44 653.459 1170.57 Q653.459 1177.67 655.264 1181.24 Q657.093 1184.78 660.704 1184.78 Q664.338 1184.78 666.144 1181.24 Q667.972 1177.67 667.972 1170.57 Q667.972 1163.44 666.144 1159.89 Q664.338 1156.33 660.704 1156.33 M660.704 1152.63 Q666.514 1152.63 669.57 1157.23 Q672.648 1161.82 672.648 1170.57 Q672.648 1179.29 669.57 1183.9 Q666.514 1188.48 660.704 1188.48 Q654.894 1188.48 651.815 1183.9 Q648.76 1179.29 648.76 1170.57 Q648.76 1161.82 651.815 1157.23 Q654.894 1152.63 660.704 1152.63 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M680.866 1181.93 L685.75 1181.93 L685.75 1187.81 L680.866 1187.81 L680.866 1181.93 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M708.782 1157.32 L696.977 1175.77 L708.782 1175.77 L708.782 1157.32 M707.556 1153.25 L713.435 1153.25 L713.435 1175.77 L718.366 1175.77 L718.366 1179.66 L713.435 1179.66 L713.435 1187.81 L708.782 1187.81 L708.782 1179.66 L693.181 1179.66 L693.181 1175.15 L707.556 1153.25 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1148.08 1156.33 Q1144.47 1156.33 1142.64 1159.89 Q1140.83 1163.44 1140.83 1170.57 Q1140.83 1177.67 1142.64 1181.24 Q1144.47 1184.78 1148.08 1184.78 Q1151.71 1184.78 1153.52 1181.24 Q1155.35 1177.67 1155.35 1170.57 Q1155.35 1163.44 1153.52 1159.89 Q1151.71 1156.33 1148.08 1156.33 M1148.08 1152.63 Q1153.89 1152.63 1156.95 1157.23 Q1160.02 1161.82 1160.02 1170.57 Q1160.02 1179.29 1156.95 1183.9 Q1153.89 1188.48 1148.08 1188.48 Q1142.27 1188.48 1139.19 1183.9 Q1136.14 1179.29 1136.14 1170.57 Q1136.14 1161.82 1139.19 1157.23 Q1142.27 1152.63 1148.08 1152.63 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1168.24 1181.93 L1173.13 1181.93 L1173.13 1187.81 L1168.24 1187.81 L1168.24 1181.93 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1193.89 1168.67 Q1190.74 1168.67 1188.89 1170.82 Q1187.06 1172.97 1187.06 1176.72 Q1187.06 1180.45 1188.89 1182.63 Q1190.74 1184.78 1193.89 1184.78 Q1197.04 1184.78 1198.87 1182.63 Q1200.72 1180.45 1200.72 1176.72 Q1200.72 1172.97 1198.87 1170.82 Q1197.04 1168.67 1193.89 1168.67 M1203.17 1154.01 L1203.17 1158.27 Q1201.41 1157.44 1199.61 1157 Q1197.83 1156.56 1196.07 1156.56 Q1191.44 1156.56 1188.98 1159.69 Q1186.55 1162.81 1186.21 1169.13 Q1187.57 1167.12 1189.63 1166.05 Q1191.69 1164.96 1194.17 1164.96 Q1199.38 1164.96 1202.39 1168.13 Q1205.42 1171.28 1205.42 1176.72 Q1205.42 1182.05 1202.27 1185.26 Q1199.12 1188.48 1193.89 1188.48 Q1187.89 1188.48 1184.72 1183.9 Q1181.55 1179.29 1181.55 1170.57 Q1181.55 1162.37 1185.44 1157.51 Q1189.33 1152.63 1195.88 1152.63 Q1197.64 1152.63 1199.42 1152.97 Q1201.23 1153.32 1203.17 1154.01 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1635.42 1156.33 Q1631.81 1156.33 1629.98 1159.89 Q1628.18 1163.44 1628.18 1170.57 Q1628.18 1177.67 1629.98 1181.24 Q1631.81 1184.78 1635.42 1184.78 Q1639.06 1184.78 1640.86 1181.24 Q1642.69 1177.67 1642.69 1170.57 Q1642.69 1163.44 1640.86 1159.89 Q1639.06 1156.33 1635.42 1156.33 M1635.42 1152.63 Q1641.23 1152.63 1644.29 1157.23 Q1647.37 1161.82 1647.37 1170.57 Q1647.37 1179.29 1644.29 1183.9 Q1641.23 1188.48 1635.42 1188.48 Q1629.61 1188.48 1626.53 1183.9 Q1623.48 1179.29 1623.48 1170.57 Q1623.48 1161.82 1626.53 1157.23 Q1629.61 1152.63 1635.42 1152.63 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1655.58 1181.93 L1660.47 1181.93 L1660.47 1187.81 L1655.58 1187.81 L1655.58 1181.93 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1680.65 1171.4 Q1677.32 1171.4 1675.4 1173.18 Q1673.5 1174.96 1673.5 1178.09 Q1673.5 1181.21 1675.4 1183 Q1677.32 1184.78 1680.65 1184.78 Q1683.99 1184.78 1685.91 1183 Q1687.83 1181.19 1687.83 1178.09 Q1687.83 1174.96 1685.91 1173.18 Q1684.01 1171.4 1680.65 1171.4 M1675.98 1169.41 Q1672.97 1168.67 1671.28 1166.61 Q1669.61 1164.55 1669.61 1161.58 Q1669.61 1157.44 1672.55 1155.03 Q1675.51 1152.63 1680.65 1152.63 Q1685.82 1152.63 1688.75 1155.03 Q1691.69 1157.44 1691.69 1161.58 Q1691.69 1164.55 1690 1166.61 Q1688.34 1168.67 1685.35 1169.41 Q1688.73 1170.2 1690.61 1172.49 Q1692.5 1174.78 1692.5 1178.09 Q1692.5 1183.11 1689.43 1185.8 Q1686.37 1188.48 1680.65 1188.48 Q1674.94 1188.48 1671.86 1185.8 Q1668.8 1183.11 1668.8 1178.09 Q1668.8 1174.78 1670.7 1172.49 Q1672.6 1170.2 1675.98 1169.41 M1674.26 1162.02 Q1674.26 1164.71 1675.93 1166.21 Q1677.62 1167.72 1680.65 1167.72 Q1683.66 1167.72 1685.35 1166.21 Q1687.07 1164.71 1687.07 1162.02 Q1687.07 1159.34 1685.35 1157.83 Q1683.66 1156.33 1680.65 1156.33 Q1677.62 1156.33 1675.93 1157.83 Q1674.26 1159.34 1674.26 1162.02 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip360)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="145.191,1128.61 145.191,47.2441 "></polyline>
<polyline clip-path="url(#clip360)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="145.191,1052.94 164.089,1052.94 "></polyline>
<polyline clip-path="url(#clip360)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="145.191,835.407 164.089,835.407 "></polyline>
<polyline clip-path="url(#clip360)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="145.191,617.88 164.089,617.88 "></polyline>
<polyline clip-path="url(#clip360)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="145.191,400.352 164.089,400.352 "></polyline>
<polyline clip-path="url(#clip360)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="145.191,182.824 164.089,182.824 "></polyline>
<path clip-path="url(#clip360)" d="M52.9921 1053.39 L82.6679 1053.39 L82.6679 1057.32 L52.9921 1057.32 L52.9921 1053.39 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M105.608 1039.73 L93.8021 1058.18 L105.608 1058.18 L105.608 1039.73 M104.381 1035.66 L110.26 1035.66 L110.26 1058.18 L115.191 1058.18 L115.191 1062.07 L110.26 1062.07 L110.26 1070.22 L105.608 1070.22 L105.608 1062.07 L90.0058 1062.07 L90.0058 1057.55 L104.381 1035.66 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M55.0754 835.859 L84.7512 835.859 L84.7512 839.794 L55.0754 839.794 L55.0754 835.859 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M98.8715 848.752 L115.191 848.752 L115.191 852.687 L93.2465 852.687 L93.2465 848.752 Q95.9086 845.998 100.492 841.368 Q105.098 836.715 106.279 835.373 Q108.524 832.85 109.404 831.113 Q110.307 829.354 110.307 827.664 Q110.307 824.91 108.362 823.174 Q106.441 821.438 103.339 821.438 Q101.14 821.438 98.6863 822.201 Q96.2558 822.965 93.478 824.516 L93.478 819.794 Q96.3021 818.66 98.7558 818.081 Q101.209 817.502 103.246 817.502 Q108.617 817.502 111.811 820.188 Q115.006 822.873 115.006 827.363 Q115.006 829.493 114.196 831.414 Q113.408 833.312 111.302 835.905 Q110.723 836.576 107.621 839.794 Q104.52 842.988 98.8715 848.752 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M103.246 603.678 Q99.6354 603.678 97.8067 607.243 Q96.0012 610.785 96.0012 617.914 Q96.0012 625.021 97.8067 628.586 Q99.6354 632.127 103.246 632.127 Q106.881 632.127 108.686 628.586 Q110.515 625.021 110.515 617.914 Q110.515 610.785 108.686 607.243 Q106.881 603.678 103.246 603.678 M103.246 599.975 Q109.057 599.975 112.112 604.581 Q115.191 609.164 115.191 617.914 Q115.191 626.641 112.112 631.248 Q109.057 635.831 103.246 635.831 Q97.4363 635.831 94.3576 631.248 Q91.3021 626.641 91.3021 617.914 Q91.3021 609.164 94.3576 604.581 Q97.4363 599.975 103.246 599.975 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M98.8715 413.697 L115.191 413.697 L115.191 417.632 L93.2465 417.632 L93.2465 413.697 Q95.9086 410.942 100.492 406.313 Q105.098 401.66 106.279 400.317 Q108.524 397.794 109.404 396.058 Q110.307 394.299 110.307 392.609 Q110.307 389.854 108.362 388.118 Q106.441 386.382 103.339 386.382 Q101.14 386.382 98.6863 387.146 Q96.2558 387.91 93.478 389.461 L93.478 384.739 Q96.3021 383.604 98.7558 383.026 Q101.209 382.447 103.246 382.447 Q108.617 382.447 111.811 385.132 Q115.006 387.817 115.006 392.308 Q115.006 394.438 114.196 396.359 Q113.408 398.257 111.302 400.85 Q110.723 401.521 107.621 404.739 Q104.52 407.933 98.8715 413.697 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M105.608 169.618 L93.8021 188.067 L105.608 188.067 L105.608 169.618 M104.381 165.544 L110.26 165.544 L110.26 188.067 L115.191 188.067 L115.191 191.956 L110.26 191.956 L110.26 200.104 L105.608 200.104 L105.608 191.956 L90.0058 191.956 L90.0058 187.442 L104.381 165.544 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip362)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.348,77.8488 220.709,121.617 245.07,160.588 269.431,195.488 293.791,226.907 318.152,255.334 342.513,281.17 366.873,304.753 391.234,326.367 415.595,346.251 439.956,364.61 464.316,381.621 488.677,397.433 513.038,412.178 537.398,425.97 561.759,438.909 586.12,451.083 610.481,462.57 634.841,473.437 659.202,483.746 683.563,493.553 707.923,502.905 732.284,511.849 756.645,520.422 781.006,528.663 805.366,536.605 829.727,544.279 854.088,551.712 878.448,558.932 902.809,565.963 927.17,572.828 951.531,579.55 975.891,586.148 1000.25,592.644 1024.61,599.056 1048.97,605.404 1073.33,611.706 1097.69,617.98 1122.06,624.245 1146.42,630.52 1170.78,636.823 1195.14,643.175 1219.5,649.595 1243.86,656.104 1268.22,662.726 1292.58,669.484 1316.94,676.403 1341.3,683.512 1365.66,690.841 1390.02,698.424 1414.38,706.297 1438.74,714.503 1463.11,723.087 1487.47,732.104 1511.83,741.612 1536.19,751.681 1560.55,762.392 1584.91,773.837 1609.27,786.127 1633.63,799.393 1657.99,813.788 1682.35,829.502 1706.71,846.764 1731.07,865.855 1755.43,887.129 1779.79,911.031 1804.16,938.134 1828.52,969.187 1852.88,1005.19 1877.24,1047.49 1901.6,1098.01 "></polyline>
<polyline clip-path="url(#clip362)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" stroke-dasharray="16, 10" points="196.348,77.8488 220.709,121.617 245.07,160.588 269.431,195.488 293.791,226.907 318.152,255.334 342.513,281.17 366.873,304.753 391.234,326.367 415.595,346.251 439.956,364.61 464.316,381.621 488.677,397.433 513.038,412.178 537.398,425.97 561.759,438.909 586.12,451.083 610.481,462.57 634.841,473.437 659.202,483.746 683.563,493.553 707.923,502.905 732.284,511.849 756.645,520.422 781.006,528.663 805.366,536.605 829.727,544.279 854.088,551.712 878.448,558.932 902.809,565.963 927.17,572.828 951.531,579.55 975.891,586.148 1000.25,592.644 1024.61,599.056 1048.97,605.404 1073.33,611.706 1097.69,617.98 1122.06,624.245 1146.42,630.52 1170.78,636.823 1195.14,643.175 1219.5,649.595 1243.86,656.104 1268.22,662.726 1292.58,669.484 1316.94,676.403 1341.3,683.512 1365.66,690.841 1390.02,698.424 1414.38,706.297 1438.74,714.503 1463.11,723.087 1487.47,732.104 1511.83,741.612 1536.19,751.681 1560.55,762.392 1584.91,773.837 1609.27,786.127 1633.63,799.393 1657.99,813.788 1682.35,829.502 1706.71,846.764 1731.07,865.855 1755.43,887.129 1779.79,911.031 1804.16,938.134 1828.52,969.187 1852.88,1005.19 1877.24,1047.49 1901.6,1098.01 "></polyline>
<path clip-path="url(#clip360)" d="M1409.18 238.81 L1892.5 238.81 L1892.5 83.2896 L1409.18 83.2896  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<polyline clip-path="url(#clip360)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1409.18,238.81 1892.5,238.81 1892.5,83.2896 1409.18,83.2896 1409.18,238.81 "></polyline>
<polyline clip-path="url(#clip360)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1429.26,135.13 1549.77,135.13 "></polyline>
<path clip-path="url(#clip360)" d="M1585.69 122.456 L1579.34 139.655 L1592.05 139.655 L1585.69 122.456 M1583.05 117.85 L1588.35 117.85 L1601.52 152.41 L1596.66 152.41 L1593.51 143.544 L1577.93 143.544 L1574.78 152.41 L1569.85 152.41 L1583.05 117.85 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1627.93 136.762 L1627.93 152.41 L1623.67 152.41 L1623.67 136.9 Q1623.67 133.22 1622.24 131.391 Q1620.8 129.563 1617.93 129.563 Q1614.48 129.563 1612.49 131.762 Q1610.5 133.961 1610.5 137.757 L1610.5 152.41 L1606.22 152.41 L1606.22 126.484 L1610.5 126.484 L1610.5 130.512 Q1612.03 128.174 1614.09 127.016 Q1616.17 125.859 1618.88 125.859 Q1623.35 125.859 1625.64 128.637 Q1627.93 131.391 1627.93 136.762 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1648.21 139.377 Q1643.05 139.377 1641.06 140.558 Q1639.06 141.738 1639.06 144.586 Q1639.06 146.854 1640.55 148.197 Q1642.05 149.516 1644.62 149.516 Q1648.16 149.516 1650.29 147.016 Q1652.44 144.493 1652.44 140.326 L1652.44 139.377 L1648.21 139.377 M1656.7 137.618 L1656.7 152.41 L1652.44 152.41 L1652.44 148.474 Q1650.99 150.836 1648.81 151.97 Q1646.63 153.081 1643.49 153.081 Q1639.5 153.081 1637.14 150.859 Q1634.81 148.613 1634.81 144.863 Q1634.81 140.488 1637.72 138.266 Q1640.66 136.044 1646.47 136.044 L1652.44 136.044 L1652.44 135.627 Q1652.44 132.688 1650.5 131.09 Q1648.58 129.47 1645.08 129.47 Q1642.86 129.47 1640.75 130.002 Q1638.65 130.535 1636.7 131.6 L1636.7 127.664 Q1639.04 126.762 1641.24 126.322 Q1643.44 125.859 1645.52 125.859 Q1651.15 125.859 1653.93 128.776 Q1656.7 131.692 1656.7 137.618 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1665.48 116.391 L1669.74 116.391 L1669.74 152.41 L1665.48 152.41 L1665.48 116.391 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1689.43 154.817 Q1687.63 159.447 1685.92 160.859 Q1684.2 162.271 1681.33 162.271 L1677.93 162.271 L1677.93 158.706 L1680.43 158.706 Q1682.19 158.706 1683.16 157.873 Q1684.13 157.039 1685.31 153.937 L1686.08 151.993 L1675.59 126.484 L1680.11 126.484 L1688.21 146.762 L1696.31 126.484 L1700.82 126.484 L1689.43 154.817 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1710.92 119.123 L1710.92 126.484 L1719.69 126.484 L1719.69 129.794 L1710.92 129.794 L1710.92 143.868 Q1710.92 147.039 1711.77 147.942 Q1712.65 148.845 1715.31 148.845 L1719.69 148.845 L1719.69 152.41 L1715.31 152.41 Q1710.38 152.41 1708.51 150.581 Q1706.63 148.729 1706.63 143.868 L1706.63 129.794 L1703.51 129.794 L1703.51 126.484 L1706.63 126.484 L1706.63 119.123 L1710.92 119.123 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1725.29 126.484 L1729.55 126.484 L1729.55 152.41 L1725.29 152.41 L1725.29 126.484 M1725.29 116.391 L1729.55 116.391 L1729.55 121.785 L1725.29 121.785 L1725.29 116.391 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1757.12 127.479 L1757.12 131.461 Q1755.31 130.465 1753.49 129.979 Q1751.68 129.47 1749.83 129.47 Q1745.68 129.47 1743.39 132.109 Q1741.1 134.725 1741.1 139.47 Q1741.1 144.215 1743.39 146.854 Q1745.68 149.47 1749.83 149.47 Q1751.68 149.47 1753.49 148.984 Q1755.31 148.474 1757.12 147.479 L1757.12 151.414 Q1755.34 152.248 1753.42 152.664 Q1751.52 153.081 1749.36 153.081 Q1743.51 153.081 1740.06 149.4 Q1736.61 145.72 1736.61 139.47 Q1736.61 133.127 1740.08 129.493 Q1743.58 125.859 1749.64 125.859 Q1751.61 125.859 1753.49 126.276 Q1755.36 126.669 1757.12 127.479 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1776.31 139.377 Q1771.15 139.377 1769.16 140.558 Q1767.17 141.738 1767.17 144.586 Q1767.17 146.854 1768.65 148.197 Q1770.15 149.516 1772.72 149.516 Q1776.26 149.516 1778.39 147.016 Q1780.55 144.493 1780.55 140.326 L1780.55 139.377 L1776.31 139.377 M1784.8 137.618 L1784.8 152.41 L1780.55 152.41 L1780.55 148.474 Q1779.09 150.836 1776.91 151.97 Q1774.74 153.081 1771.59 153.081 Q1767.61 153.081 1765.24 150.859 Q1762.91 148.613 1762.91 144.863 Q1762.91 140.488 1765.82 138.266 Q1768.76 136.044 1774.57 136.044 L1780.55 136.044 L1780.55 135.627 Q1780.55 132.688 1778.6 131.09 Q1776.68 129.47 1773.18 129.47 Q1770.96 129.47 1768.86 130.002 Q1766.75 130.535 1764.8 131.6 L1764.8 127.664 Q1767.14 126.762 1769.34 126.322 Q1771.54 125.859 1773.62 125.859 Q1779.25 125.859 1782.03 128.776 Q1784.8 131.692 1784.8 137.618 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1793.58 116.391 L1797.84 116.391 L1797.84 152.41 L1793.58 152.41 L1793.58 116.391 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip360)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" stroke-dasharray="16, 10" points="1429.26,186.97 1549.77,186.97 "></polyline>
<path clip-path="url(#clip360)" d="M1569.85 169.69 L1589.71 169.69 L1589.71 173.625 L1574.53 173.625 L1574.53 183.81 L1588.23 183.81 L1588.23 187.745 L1574.53 187.745 L1574.53 204.25 L1569.85 204.25 L1569.85 169.69 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1605.29 181.31 Q1601.87 181.31 1599.87 183.995 Q1597.88 186.657 1597.88 191.31 Q1597.88 195.963 1599.85 198.648 Q1601.84 201.31 1605.29 201.31 Q1608.69 201.31 1610.68 198.625 Q1612.68 195.94 1612.68 191.31 Q1612.68 186.703 1610.68 184.018 Q1608.69 181.31 1605.29 181.31 M1605.29 177.699 Q1610.85 177.699 1614.02 181.31 Q1617.19 184.921 1617.19 191.31 Q1617.19 197.676 1614.02 201.31 Q1610.85 204.921 1605.29 204.921 Q1599.71 204.921 1596.54 201.31 Q1593.39 197.676 1593.39 191.31 Q1593.39 184.921 1596.54 181.31 Q1599.71 177.699 1605.29 177.699 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1639.27 182.305 Q1638.56 181.889 1637.7 181.703 Q1636.87 181.495 1635.85 181.495 Q1632.24 181.495 1630.29 183.856 Q1628.37 186.194 1628.37 190.592 L1628.37 204.25 L1624.09 204.25 L1624.09 178.324 L1628.37 178.324 L1628.37 182.352 Q1629.71 179.991 1631.87 178.856 Q1634.02 177.699 1637.1 177.699 Q1637.54 177.699 1638.07 177.768 Q1638.6 177.815 1639.25 177.93 L1639.27 182.305 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1641.26 178.324 L1645.52 178.324 L1650.85 198.555 L1656.15 178.324 L1661.17 178.324 L1666.49 198.555 L1671.8 178.324 L1676.05 178.324 L1669.27 204.25 L1664.25 204.25 L1658.67 183 L1653.07 204.25 L1648.05 204.25 L1641.26 178.324 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1694.3 191.217 Q1689.13 191.217 1687.14 192.398 Q1685.15 193.578 1685.15 196.426 Q1685.15 198.694 1686.63 200.037 Q1688.14 201.356 1690.71 201.356 Q1694.25 201.356 1696.38 198.856 Q1698.53 196.333 1698.53 192.166 L1698.53 191.217 L1694.3 191.217 M1702.79 189.458 L1702.79 204.25 L1698.53 204.25 L1698.53 200.314 Q1697.07 202.676 1694.9 203.81 Q1692.72 204.921 1689.57 204.921 Q1685.59 204.921 1683.23 202.699 Q1680.89 200.453 1680.89 196.703 Q1680.89 192.328 1683.81 190.106 Q1686.75 187.884 1692.56 187.884 L1698.53 187.884 L1698.53 187.467 Q1698.53 184.528 1696.59 182.93 Q1694.67 181.31 1691.17 181.31 Q1688.95 181.31 1686.84 181.842 Q1684.74 182.375 1682.79 183.44 L1682.79 179.504 Q1685.13 178.602 1687.33 178.162 Q1689.53 177.699 1691.61 177.699 Q1697.24 177.699 1700.01 180.616 Q1702.79 183.532 1702.79 189.458 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1726.59 182.305 Q1725.87 181.889 1725.01 181.703 Q1724.18 181.495 1723.16 181.495 Q1719.55 181.495 1717.61 183.856 Q1715.68 186.194 1715.68 190.592 L1715.68 204.25 L1711.4 204.25 L1711.4 178.324 L1715.68 178.324 L1715.68 182.352 Q1717.03 179.991 1719.18 178.856 Q1721.33 177.699 1724.41 177.699 Q1724.85 177.699 1725.38 177.768 Q1725.92 177.815 1726.56 177.93 L1726.59 182.305 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1747.28 182.259 L1747.28 168.231 L1751.54 168.231 L1751.54 204.25 L1747.28 204.25 L1747.28 200.361 Q1745.94 202.676 1743.88 203.81 Q1741.84 204.921 1738.97 204.921 Q1734.27 204.921 1731.31 201.171 Q1728.37 197.421 1728.37 191.31 Q1728.37 185.199 1731.31 181.449 Q1734.27 177.699 1738.97 177.699 Q1741.84 177.699 1743.88 178.833 Q1745.94 179.944 1747.28 182.259 M1732.77 191.31 Q1732.77 196.009 1734.69 198.694 Q1736.63 201.356 1740.01 201.356 Q1743.39 201.356 1745.34 198.694 Q1747.28 196.009 1747.28 191.31 Q1747.28 186.611 1745.34 183.949 Q1743.39 181.264 1740.01 181.264 Q1736.63 181.264 1734.69 183.949 Q1732.77 186.611 1732.77 191.31 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1765.17 173.532 L1765.17 200.407 L1770.82 200.407 Q1777.98 200.407 1781.29 197.166 Q1784.62 193.926 1784.62 186.935 Q1784.62 179.991 1781.29 176.773 Q1777.98 173.532 1770.82 173.532 L1765.17 173.532 M1760.5 169.69 L1770.11 169.69 Q1780.15 169.69 1784.85 173.879 Q1789.55 178.046 1789.55 186.935 Q1789.55 195.87 1784.83 200.06 Q1780.11 204.25 1770.11 204.25 L1760.5 204.25 L1760.5 169.69 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1796.82 178.324 L1801.08 178.324 L1801.08 204.25 L1796.82 204.25 L1796.82 178.324 M1796.82 168.231 L1801.08 168.231 L1801.08 173.625 L1796.82 173.625 L1796.82 168.231 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1823.11 168.231 L1823.11 171.773 L1819.04 171.773 Q1816.75 171.773 1815.85 172.699 Q1814.97 173.625 1814.97 176.032 L1814.97 178.324 L1821.98 178.324 L1821.98 181.634 L1814.97 181.634 L1814.97 204.25 L1810.68 204.25 L1810.68 181.634 L1806.61 181.634 L1806.61 178.324 L1810.68 178.324 L1810.68 176.518 Q1810.68 172.19 1812.7 170.222 Q1814.71 168.231 1819.09 168.231 L1823.11 168.231 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1839.8 168.231 L1839.8 171.773 L1835.73 171.773 Q1833.44 171.773 1832.54 172.699 Q1831.66 173.625 1831.66 176.032 L1831.66 178.324 L1838.67 178.324 L1838.67 181.634 L1831.66 181.634 L1831.66 204.25 L1827.37 204.25 L1827.37 181.634 L1823.3 181.634 L1823.3 178.324 L1827.37 178.324 L1827.37 176.518 Q1827.37 172.19 1829.39 170.222 Q1831.4 168.231 1835.78 168.231 L1839.8 168.231 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1840.52 198.37 L1845.41 198.37 L1845.41 204.25 L1840.52 204.25 L1840.52 198.37 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1854.99 178.324 L1859.25 178.324 L1859.25 204.713 Q1859.25 209.666 1857.35 211.888 Q1855.48 214.111 1851.29 214.111 L1849.67 214.111 L1849.67 210.5 L1850.8 210.5 Q1853.23 210.5 1854.11 209.365 Q1854.99 208.254 1854.99 204.713 L1854.99 178.324 M1854.99 168.231 L1859.25 168.231 L1859.25 173.625 L1854.99 173.625 L1854.99 168.231 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1868.16 168.231 L1872.42 168.231 L1872.42 204.25 L1868.16 204.25 L1868.16 168.231 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path></svg>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-comp-automatic-diff-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Comparison of analytical and automatic derivatives.
</figcaption>
</figure>
</div>
</div>
</section>
</section>
<section id="並列計算" class="level2">
<h2 class="anchored" data-anchor-id="並列計算">並列計算</h2>
<p>現代のPCは複数のコアを持つマルチコアCPUを搭載しています. パッケージのバックグラウンドで並列計算が用いられていることもありますが, 基本的にはユーザーが明示的に並列計算を指示する必要があります.</p>
<p>まずは, 自分のPCが何コア持っているかを確認してみましょう.</p>
<div id="cell-check-cores" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="bu">Threads</span>.<span class="fu">nthreads</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="check-cores" class="cell-output cell-output-display" data-execution_count="1">
<pre><code>12</code></pre>
</div>
</div>
<p>ここで, スレッド数が1となっている場合は, Juliaを起動する前に環境変数 <code>JULIA_NUM_THREADS</code> を設定する必要があります.</p>
<ul>
<li>Quarto: <code>julia.exeflags: ["--threads=auto"]</code> をYAMLヘッダーに追加</li>
<li>VSCode: <code>settings.json</code> に <code>"julia.numThreads": "auto"</code> を追加</li>
<li>ターミナル: <code>export JULIA_NUM_THREADS=auto</code> を実行</li>
</ul>
<p><code>auto</code> と設定した場合, 利用可能なコア数に応じて自動的にスレッド数が設定されます. 現代のPCであれば, ほとんどの場合, 利用可能なコア数が2以上になるはずです.</p>
<div id="define-solve-multi" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">solve_multi!</span>(m<span class="op">::</span><span class="dt">My.Model</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    (; T, n_a, r, w, β, a_grid) <span class="op">=</span> m</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    V <span class="op">=</span> <span class="fu">zeros</span>(n_a, T)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="op">=</span> T<span class="op">:-</span><span class="fl">1</span><span class="op">:</span><span class="fl">1</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Threads</span>.<span class="pp">@threads</span> <span class="cf">for</span> i_a <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>n_a</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>            utility <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i_a′ <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>n_a</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>                V′ <span class="op">=</span> (t <span class="op">==</span> T) ? <span class="fl">0.0</span> <span class="op">:</span> V[i_a′, t<span class="op">+</span><span class="fl">1</span>]</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>                c <span class="op">=</span> (<span class="fl">1</span> <span class="op">+</span> r) <span class="op">*</span> a_grid[i_a] <span class="op">+</span> w <span class="op">-</span> a_grid[i_a′]</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> c <span class="op">&gt;</span> <span class="fl">0</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                    utility <span class="op">=</span> <span class="fu">max</span>(My.<span class="fu">u</span>(c, m) <span class="op">+</span> β <span class="op">*</span> V′, utility)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>                <span class="cf">end</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>            V[i_a, t] <span class="op">=</span> utility</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    m.V <span class="op">.=</span> V</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="cn">nothing</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-benchmark-single" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@benchmark</span> My.<span class="fu">solve!</span>(m) setup <span class="op">=</span> (m <span class="op">=</span> My.<span class="fu">Model</span>(n_a<span class="op">=</span><span class="fl">1000</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="benchmark-single" class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 126 samples with 1 evaluation per sample.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">38.504 ms</span> … <span class="ansi-magenta-fg"> 40.417 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">39.827 ms               </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">39.813 ms</span> ± <span class="ansi-green-fg">234.864 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%

                                         ▅▃<span class="ansi-green-fg">█</span><span class="ansi-blue-fg">▂</span>▄▁                 
  ▃▁▁▁▁▁▁▃▁▁▁▃▁▁▁▁▁▁▁▃▁▃▁▁▁▁▁▁▁▁▃▁▁▁▁▃▃▄▆██<span class="ansi-green-fg">█</span><span class="ansi-blue-fg">█</span>███▄▃▃▃▃▁▁▁▁▁▁▁▃▃ ▃
  38.5 ms<span class="ansi-bright-black-fg">         Histogram: frequency by time</span>         40.4 ms <span class="ansi-bold">&lt;</span>

 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">80.08 KiB</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">3</span>.</pre>
</div>
</div>
</div>
<div id="cell-benchmark-multi" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@benchmark</span> <span class="fu">solve_multi!</span>(m) setup <span class="op">=</span> (m <span class="op">=</span> My.<span class="fu">Model</span>(n_a<span class="op">=</span><span class="fl">1000</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="benchmark-multi" class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 1181 samples with 1 evaluation per sample.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">3.916 ms</span> … <span class="ansi-magenta-fg"> 11.149 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 62.80%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">4.041 ms               </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">4.209 ms</span> ± <span class="ansi-green-fg">606.523 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.38% ±  2.92%

  █▅▂<span class="ansi-blue-fg">▃</span>▅▆<span class="ansi-green-fg">▃</span>▁                                                     
  ███<span class="ansi-blue-fg">█</span>██<span class="ansi-green-fg">█</span>████▇▆▆▇▅▆▄▅▆▆▆▁▅▆▅▆▅▄▇▅▁▄▅▅▅▁▁▁▁▁▁▁▁▁▁▄▄▄▁▅▆▆▅▆▅▅▄▆ █
  3.92 ms<span class="ansi-bright-black-fg">      </span><span class="ansi-bright-black-fg">Histogram: </span><span class="ansi-bright-black-fg ansi-bold">log(</span><span class="ansi-bright-black-fg">frequency</span><span class="ansi-bright-black-fg ansi-bold">)</span><span class="ansi-bright-black-fg"> by time</span>      6.59 ms <span class="ansi-bold">&lt;</span>

 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">181.02 KiB</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">863</span>.</pre>
</div>
</div>
</div>
<p>並列化した場合, 1コアで実行した場合と比べて, おおむねスレッド数に応じて計算時間が短縮されていることがわかります. ただし, ここまで理論値に近い速度向上が得られることは稀で, 実際には理論値の数%から数十%程度の速度向上にとどまることが多いです.</p>
<p><strong>並列化できない計算</strong></p>
<p>並列計算の大前提は, 各スレッドが独立して計算できることです. 今回は後方帰納法で解くため, 時刻 <span class="math inline">\(t\)</span> の価値関数を計算する際に, 時刻 <span class="math inline">\(t+1\)</span> の価値関数が必要になり, 時刻方向に並列化することはできません.</p>
<div id="define-solve-muli-illegal" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">solve_multi_illegal!</span>(m<span class="op">::</span><span class="dt">My.Model</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    (; T, n_a, r, w, β, a_grid) <span class="op">=</span> m</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    V <span class="op">=</span> <span class="fu">zeros</span>(n_a, T)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Threads</span>.<span class="pp">@threads</span> <span class="cf">for</span> t <span class="op">=</span> T<span class="op">:-</span><span class="fl">1</span><span class="op">:</span><span class="fl">1</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i_a <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>n_a</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>            utility <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i_a′ <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>n_a</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>                V′ <span class="op">=</span> (t <span class="op">==</span> T) ? <span class="fl">0.0</span> <span class="op">:</span> V[i_a′, t<span class="op">+</span><span class="fl">1</span>]</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>                c <span class="op">=</span> (<span class="fl">1</span> <span class="op">+</span> r) <span class="op">*</span> a_grid[i_a] <span class="op">+</span> w <span class="op">-</span> a_grid[i_a′]</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> c <span class="op">&gt;</span> <span class="fl">0</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>                    utility <span class="op">=</span> <span class="fu">max</span>(My.<span class="fu">u</span>(c, m) <span class="op">+</span> β <span class="op">*</span> V′, utility)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>                <span class="cf">end</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>            V[i_a, t] <span class="op">=</span> utility</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    m.V <span class="op">.=</span> V</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="cn">nothing</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-fig-vf-illegal" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> My.<span class="fu">Model</span>(n_a<span class="op">=</span><span class="fl">100</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">solve_multi_illegal!</span>(m)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m.a_grid, m.V[<span class="op">:</span>, <span class="kw">end</span>], xlabel<span class="op">=</span>L<span class="st">"a"</span>, ylabel<span class="op">=</span>L<span class="st">"V(a, t)"</span>, label<span class="op">=</span>L<span class="st">"t=T"</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(m.a_grid, m.V[<span class="op">:</span>, <span class="kw">end</span><span class="op">-</span><span class="fl">2</span>], label<span class="op">=</span>L<span class="st">"t=T-2"</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(m.a_grid, m.V[<span class="op">:</span>, begin], label<span class="op">=</span>L<span class="st">"t=1"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="fig-vf-illegal" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="1">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-vf-illegal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="500" height="309" viewbox="0 0 2000 1236">
<defs>
  <clippath id="clip420">
    <rect x="0" y="0" width="2000" height="1236"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip420)" d="M0 1236 L2000 1236 L2000 1.24345e-14 L0 1.24345e-14  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip421">
    <rect x="400" y="0" width="1401" height="1236"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip420)" d="M279.897 1068.81 L1952.76 1068.81 L1952.76 47.2441 L279.897 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip422">
    <rect x="279" y="47" width="1674" height="1023"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip422)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="286.776,1068.81 286.776,47.2441 "></polyline>
<polyline clip-path="url(#clip422)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="691.435,1068.81 691.435,47.2441 "></polyline>
<polyline clip-path="url(#clip422)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1096.09,1068.81 1096.09,47.2441 "></polyline>
<polyline clip-path="url(#clip422)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1500.75,1068.81 1500.75,47.2441 "></polyline>
<polyline clip-path="url(#clip422)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1905.41,1068.81 1905.41,47.2441 "></polyline>
<polyline clip-path="url(#clip422)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="279.897,898.546 1952.76,898.546 "></polyline>
<polyline clip-path="url(#clip422)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="279.897,727.973 1952.76,727.973 "></polyline>
<polyline clip-path="url(#clip422)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="279.897,557.401 1952.76,557.401 "></polyline>
<polyline clip-path="url(#clip422)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="279.897,386.828 1952.76,386.828 "></polyline>
<polyline clip-path="url(#clip422)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="279.897,216.256 1952.76,216.256 "></polyline>
<polyline clip-path="url(#clip420)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="279.897,1068.81 1952.76,1068.81 "></polyline>
<polyline clip-path="url(#clip420)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="286.776,1068.81 286.776,1049.91 "></polyline>
<polyline clip-path="url(#clip420)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="691.435,1068.81 691.435,1049.91 "></polyline>
<polyline clip-path="url(#clip420)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1096.09,1068.81 1096.09,1049.91 "></polyline>
<polyline clip-path="url(#clip420)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1500.75,1068.81 1500.75,1049.91 "></polyline>
<polyline clip-path="url(#clip420)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1905.41,1068.81 1905.41,1049.91 "></polyline>
<path clip-path="url(#clip420)" d="M286.776 1096.53 Q283.165 1096.53 281.336 1100.1 Q279.531 1103.64 279.531 1110.77 Q279.531 1117.87 281.336 1121.44 Q283.165 1124.98 286.776 1124.98 Q290.41 1124.98 292.216 1121.44 Q294.045 1117.87 294.045 1110.77 Q294.045 1103.64 292.216 1100.1 Q290.41 1096.53 286.776 1096.53 M286.776 1092.83 Q292.586 1092.83 295.642 1097.43 Q298.721 1102.02 298.721 1110.77 Q298.721 1119.49 295.642 1124.1 Q292.586 1128.68 286.776 1128.68 Q280.966 1128.68 277.887 1124.1 Q274.832 1119.49 274.832 1110.77 Q274.832 1102.02 277.887 1097.43 Q280.966 1092.83 286.776 1092.83 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M681.817 1124.08 L689.456 1124.08 L689.456 1097.71 L681.146 1099.38 L681.146 1095.12 L689.409 1093.45 L694.085 1093.45 L694.085 1124.08 L701.724 1124.08 L701.724 1128.01 L681.817 1128.01 L681.817 1124.08 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M1090.75 1124.08 L1107.07 1124.08 L1107.07 1128.01 L1085.12 1128.01 L1085.12 1124.08 Q1087.78 1121.32 1092.37 1116.69 Q1096.97 1112.04 1098.15 1110.7 Q1100.4 1108.17 1101.28 1106.44 Q1102.18 1104.68 1102.18 1102.99 Q1102.18 1100.23 1100.24 1098.5 Q1098.32 1096.76 1095.21 1096.76 Q1093.01 1096.76 1090.56 1097.53 Q1088.13 1098.29 1085.35 1099.84 L1085.35 1095.12 Q1088.18 1093.98 1090.63 1093.41 Q1093.08 1092.83 1095.12 1092.83 Q1100.49 1092.83 1103.69 1095.51 Q1106.88 1098.2 1106.88 1102.69 Q1106.88 1104.82 1106.07 1106.74 Q1105.28 1108.64 1103.18 1111.23 Q1102.6 1111.9 1099.5 1115.12 Q1096.39 1118.31 1090.75 1124.08 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M1505 1109.38 Q1508.36 1110.1 1510.23 1112.36 Q1512.13 1114.63 1512.13 1117.97 Q1512.13 1123.08 1508.61 1125.88 Q1505.09 1128.68 1498.61 1128.68 Q1496.44 1128.68 1494.12 1128.24 Q1491.83 1127.83 1489.37 1126.97 L1489.37 1122.46 Q1491.32 1123.59 1493.63 1124.17 Q1495.95 1124.75 1498.47 1124.75 Q1502.87 1124.75 1505.16 1123.01 Q1507.48 1121.28 1507.48 1117.97 Q1507.48 1114.91 1505.32 1113.2 Q1503.19 1111.46 1499.37 1111.46 L1495.35 1111.46 L1495.35 1107.62 L1499.56 1107.62 Q1503.01 1107.62 1504.84 1106.25 Q1506.67 1104.86 1506.67 1102.27 Q1506.67 1099.61 1504.77 1098.2 Q1502.89 1096.76 1499.37 1096.76 Q1497.45 1096.76 1495.25 1097.18 Q1493.06 1097.6 1490.42 1098.47 L1490.42 1094.31 Q1493.08 1093.57 1495.39 1093.2 Q1497.73 1092.83 1499.79 1092.83 Q1505.12 1092.83 1508.22 1095.26 Q1511.32 1097.66 1511.32 1101.78 Q1511.32 1104.66 1509.68 1106.65 Q1508.03 1108.61 1505 1109.38 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M1908.42 1097.53 L1896.61 1115.97 L1908.42 1115.97 L1908.42 1097.53 M1907.19 1093.45 L1913.07 1093.45 L1913.07 1115.97 L1918 1115.97 L1918 1119.86 L1913.07 1119.86 L1913.07 1128.01 L1908.42 1128.01 L1908.42 1119.86 L1892.82 1119.86 L1892.82 1115.35 L1907.19 1093.45 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M1129.26 1183.8 Q1128.39 1187.95 1127.27 1190.33 Q1125.46 1193.97 1122.4 1193.97 Q1120.08 1193.97 1118.44 1192.56 Q1116.8 1191.14 1116.41 1189.01 Q1112.19 1193.97 1107.81 1193.97 Q1103.95 1193.97 1101.5 1191.04 Q1099.05 1188.08 1099.05 1183.41 Q1099.05 1178.71 1101.37 1174.2 Q1103.72 1169.69 1107.43 1166.89 Q1111.13 1164.09 1114.93 1164.09 Q1118.96 1164.09 1121.02 1168.31 Q1121.18 1167.15 1121.92 1166.28 Q1122.66 1165.41 1123.79 1165.41 Q1124.66 1165.41 1125.17 1165.89 Q1125.69 1166.34 1125.69 1167.18 Q1125.69 1167.6 1125.24 1169.43 L1122.85 1178.64 L1121.4 1184.6 Q1120.86 1186.79 1120.7 1187.6 Q1120.57 1188.4 1120.57 1189.46 Q1120.57 1192.49 1122.53 1192.49 Q1123.5 1192.49 1124.27 1191.88 Q1125.04 1191.27 1125.66 1189.98 Q1126.27 1188.69 1126.65 1187.5 Q1127.04 1186.28 1127.56 1184.34 Q1127.72 1183.57 1127.85 1183.38 Q1128.01 1183.15 1128.46 1183.15 Q1129.26 1183.15 1129.26 1183.8 M1120.21 1171.33 Q1120.21 1171.04 1119.99 1170.24 Q1119.76 1169.43 1119.25 1168.31 Q1118.73 1167.18 1117.6 1166.37 Q1116.51 1165.54 1115.03 1165.54 Q1113.03 1165.54 1110.94 1167.24 Q1108.88 1168.95 1107.36 1171.85 Q1106.2 1174.17 1104.95 1179.03 Q1103.72 1183.89 1103.72 1186.31 Q1103.72 1187.79 1104.05 1189.11 Q1104.4 1190.4 1105.4 1191.46 Q1106.4 1192.49 1107.94 1192.49 Q1111.71 1192.49 1115.41 1187.82 Q1116.12 1187.02 1116.28 1186.69 Q1116.48 1186.34 1116.74 1185.37 L1120.02 1172.46 Q1120.21 1171.49 1120.21 1171.33 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip420)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="279.897,1068.81 279.897,47.2441 "></polyline>
<polyline clip-path="url(#clip420)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="279.897,898.546 298.795,898.546 "></polyline>
<polyline clip-path="url(#clip420)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="279.897,727.973 298.795,727.973 "></polyline>
<polyline clip-path="url(#clip420)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="279.897,557.401 298.795,557.401 "></polyline>
<polyline clip-path="url(#clip420)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="279.897,386.828 298.795,386.828 "></polyline>
<polyline clip-path="url(#clip420)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="279.897,216.256 298.795,216.256 "></polyline>
<path clip-path="url(#clip420)" d="M113.787 898.997 L143.462 898.997 L143.462 902.932 L113.787 902.932 L113.787 898.997 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M163.555 884.344 Q159.944 884.344 158.115 887.909 Q156.309 891.451 156.309 898.58 Q156.309 905.687 158.115 909.251 Q159.944 912.793 163.555 912.793 Q167.189 912.793 168.995 909.251 Q170.823 905.687 170.823 898.58 Q170.823 891.451 168.995 887.909 Q167.189 884.344 163.555 884.344 M163.555 880.641 Q169.365 880.641 172.421 885.247 Q175.499 889.83 175.499 898.58 Q175.499 907.307 172.421 911.914 Q169.365 916.497 163.555 916.497 Q157.745 916.497 154.666 911.914 Q151.61 907.307 151.61 898.58 Q151.61 889.83 154.666 885.247 Q157.745 880.641 163.555 880.641 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M183.717 909.946 L188.601 909.946 L188.601 915.826 L183.717 915.826 L183.717 909.946 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M212.953 897.191 Q216.309 897.909 218.184 900.177 Q220.082 902.446 220.082 905.779 Q220.082 910.895 216.564 913.696 Q213.045 916.497 206.564 916.497 Q204.388 916.497 202.073 916.057 Q199.781 915.64 197.328 914.784 L197.328 910.27 Q199.272 911.404 201.587 911.983 Q203.902 912.562 206.425 912.562 Q210.823 912.562 213.115 910.826 Q215.43 909.089 215.43 905.779 Q215.43 902.724 213.277 901.011 Q211.147 899.275 207.328 899.275 L203.3 899.275 L203.3 895.432 L207.513 895.432 Q210.962 895.432 212.791 894.066 Q214.619 892.678 214.619 890.085 Q214.619 887.423 212.721 886.011 Q210.846 884.576 207.328 884.576 Q205.406 884.576 203.207 884.992 Q201.008 885.409 198.369 886.289 L198.369 882.122 Q201.031 881.381 203.346 881.011 Q205.684 880.641 207.744 880.641 Q213.068 880.641 216.17 883.071 Q219.272 885.478 219.272 889.599 Q219.272 892.469 217.629 894.46 Q215.985 896.427 212.953 897.191 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M228.994 881.266 L247.351 881.266 L247.351 885.201 L233.277 885.201 L233.277 893.673 Q234.295 893.326 235.314 893.164 Q236.332 892.978 237.351 892.978 Q243.138 892.978 246.517 896.15 Q249.897 899.321 249.897 904.738 Q249.897 910.316 246.425 913.418 Q242.953 916.497 236.633 916.497 Q234.457 916.497 232.189 916.126 Q229.943 915.756 227.536 915.015 L227.536 910.316 Q229.619 911.451 231.841 912.006 Q234.064 912.562 236.541 912.562 Q240.545 912.562 242.883 910.455 Q245.221 908.349 245.221 904.738 Q245.221 901.127 242.883 899.02 Q240.545 896.914 236.541 896.914 Q234.666 896.914 232.791 897.33 Q230.939 897.747 228.994 898.627 L228.994 881.266 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M112.791 728.425 L142.467 728.425 L142.467 732.36 L112.791 732.36 L112.791 728.425 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M162.559 713.772 Q158.948 713.772 157.12 717.337 Q155.314 720.878 155.314 728.008 Q155.314 735.114 157.12 738.679 Q158.948 742.221 162.559 742.221 Q166.194 742.221 167.999 738.679 Q169.828 735.114 169.828 728.008 Q169.828 720.878 167.999 717.337 Q166.194 713.772 162.559 713.772 M162.559 710.068 Q168.37 710.068 171.425 714.675 Q174.504 719.258 174.504 728.008 Q174.504 736.735 171.425 741.341 Q168.37 745.924 162.559 745.924 Q156.749 745.924 153.671 741.341 Q150.615 736.735 150.615 728.008 Q150.615 719.258 153.671 714.675 Q156.749 710.068 162.559 710.068 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M182.721 739.374 L187.606 739.374 L187.606 745.253 L182.721 745.253 L182.721 739.374 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M211.957 726.619 Q215.314 727.337 217.189 729.605 Q219.087 731.874 219.087 735.207 Q219.087 740.323 215.568 743.124 Q212.05 745.924 205.568 745.924 Q203.393 745.924 201.078 745.485 Q198.786 745.068 196.332 744.212 L196.332 739.698 Q198.277 740.832 200.592 741.411 Q202.906 741.989 205.43 741.989 Q209.828 741.989 212.119 740.253 Q214.434 738.517 214.434 735.207 Q214.434 732.151 212.281 730.438 Q210.152 728.702 206.332 728.702 L202.305 728.702 L202.305 724.86 L206.518 724.86 Q209.967 724.86 211.795 723.494 Q213.624 722.105 213.624 719.513 Q213.624 716.851 211.726 715.439 Q209.851 714.003 206.332 714.003 Q204.411 714.003 202.212 714.42 Q200.013 714.837 197.374 715.716 L197.374 711.55 Q200.036 710.809 202.351 710.439 Q204.689 710.068 206.749 710.068 Q212.073 710.068 215.175 712.499 Q218.277 714.906 218.277 719.026 Q218.277 721.897 216.633 723.888 Q214.99 725.855 211.957 726.619 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M237.953 713.772 Q234.341 713.772 232.513 717.337 Q230.707 720.878 230.707 728.008 Q230.707 735.114 232.513 738.679 Q234.341 742.221 237.953 742.221 Q241.587 742.221 243.392 738.679 Q245.221 735.114 245.221 728.008 Q245.221 720.878 243.392 717.337 Q241.587 713.772 237.953 713.772 M237.953 710.068 Q243.763 710.068 246.818 714.675 Q249.897 719.258 249.897 728.008 Q249.897 736.735 246.818 741.341 Q243.763 745.924 237.953 745.924 Q232.142 745.924 229.064 741.341 Q226.008 736.735 226.008 728.008 Q226.008 719.258 229.064 714.675 Q232.142 710.068 237.953 710.068 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M113.787 557.852 L143.462 557.852 L143.462 561.787 L113.787 561.787 L113.787 557.852 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M163.555 543.2 Q159.944 543.2 158.115 546.764 Q156.309 550.306 156.309 557.436 Q156.309 564.542 158.115 568.107 Q159.944 571.648 163.555 571.648 Q167.189 571.648 168.995 568.107 Q170.823 564.542 170.823 557.436 Q170.823 550.306 168.995 546.764 Q167.189 543.2 163.555 543.2 M163.555 539.496 Q169.365 539.496 172.421 544.102 Q175.499 548.686 175.499 557.436 Q175.499 566.162 172.421 570.769 Q169.365 575.352 163.555 575.352 Q157.745 575.352 154.666 570.769 Q151.61 566.162 151.61 557.436 Q151.61 548.686 154.666 544.102 Q157.745 539.496 163.555 539.496 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M183.717 568.801 L188.601 568.801 L188.601 574.681 L183.717 574.681 L183.717 568.801 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M202.814 570.746 L219.133 570.746 L219.133 574.681 L197.189 574.681 L197.189 570.746 Q199.851 567.991 204.434 563.361 Q209.041 558.709 210.221 557.366 Q212.467 554.843 213.346 553.107 Q214.249 551.348 214.249 549.658 Q214.249 546.903 212.305 545.167 Q210.383 543.431 207.281 543.431 Q205.082 543.431 202.629 544.195 Q200.198 544.959 197.42 546.51 L197.42 541.787 Q200.244 540.653 202.698 540.075 Q205.152 539.496 207.189 539.496 Q212.559 539.496 215.754 542.181 Q218.948 544.866 218.948 549.357 Q218.948 551.487 218.138 553.408 Q217.351 555.306 215.244 557.899 Q214.666 558.57 211.564 561.787 Q208.462 564.982 202.814 570.746 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M228.994 540.121 L247.351 540.121 L247.351 544.056 L233.277 544.056 L233.277 552.528 Q234.295 552.181 235.314 552.019 Q236.332 551.834 237.351 551.834 Q243.138 551.834 246.517 555.005 Q249.897 558.176 249.897 563.593 Q249.897 569.172 246.425 572.273 Q242.953 575.352 236.633 575.352 Q234.457 575.352 232.189 574.982 Q229.943 574.611 227.536 573.871 L227.536 569.172 Q229.619 570.306 231.841 570.861 Q234.064 571.417 236.541 571.417 Q240.545 571.417 242.883 569.31 Q245.221 567.204 245.221 563.593 Q245.221 559.982 242.883 557.875 Q240.545 555.769 236.541 555.769 Q234.666 555.769 232.791 556.186 Q230.939 556.602 228.994 557.482 L228.994 540.121 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M112.791 387.28 L142.467 387.28 L142.467 391.215 L112.791 391.215 L112.791 387.28 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M162.559 372.627 Q158.948 372.627 157.12 376.192 Q155.314 379.734 155.314 386.863 Q155.314 393.97 157.12 397.534 Q158.948 401.076 162.559 401.076 Q166.194 401.076 167.999 397.534 Q169.828 393.97 169.828 386.863 Q169.828 379.734 167.999 376.192 Q166.194 372.627 162.559 372.627 M162.559 368.923 Q168.37 368.923 171.425 373.53 Q174.504 378.113 174.504 386.863 Q174.504 395.59 171.425 400.196 Q168.37 404.78 162.559 404.78 Q156.749 404.78 153.671 400.196 Q150.615 395.59 150.615 386.863 Q150.615 378.113 153.671 373.53 Q156.749 368.923 162.559 368.923 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M182.721 398.229 L187.606 398.229 L187.606 404.108 L182.721 404.108 L182.721 398.229 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M201.818 400.173 L218.138 400.173 L218.138 404.108 L196.194 404.108 L196.194 400.173 Q198.856 397.419 203.439 392.789 Q208.045 388.136 209.226 386.794 Q211.471 384.271 212.351 382.535 Q213.254 380.775 213.254 379.085 Q213.254 376.331 211.309 374.595 Q209.388 372.859 206.286 372.859 Q204.087 372.859 201.633 373.623 Q199.203 374.386 196.425 375.937 L196.425 371.215 Q199.249 370.081 201.703 369.502 Q204.156 368.923 206.193 368.923 Q211.564 368.923 214.758 371.609 Q217.953 374.294 217.953 378.785 Q217.953 380.914 217.142 382.835 Q216.355 384.734 214.249 387.326 Q213.67 387.997 210.568 391.215 Q207.467 394.409 201.818 400.173 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M237.953 372.627 Q234.341 372.627 232.513 376.192 Q230.707 379.734 230.707 386.863 Q230.707 393.97 232.513 397.534 Q234.341 401.076 237.953 401.076 Q241.587 401.076 243.392 397.534 Q245.221 393.97 245.221 386.863 Q245.221 379.734 243.392 376.192 Q241.587 372.627 237.953 372.627 M237.953 368.923 Q243.763 368.923 246.818 373.53 Q249.897 378.113 249.897 386.863 Q249.897 395.59 246.818 400.196 Q243.763 404.78 237.953 404.78 Q232.142 404.78 229.064 400.196 Q226.008 395.59 226.008 386.863 Q226.008 378.113 229.064 373.53 Q232.142 368.923 237.953 368.923 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M113.787 216.708 L143.462 216.708 L143.462 220.643 L113.787 220.643 L113.787 216.708 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M163.555 202.055 Q159.944 202.055 158.115 205.62 Q156.309 209.161 156.309 216.291 Q156.309 223.397 158.115 226.962 Q159.944 230.504 163.555 230.504 Q167.189 230.504 168.995 226.962 Q170.823 223.397 170.823 216.291 Q170.823 209.161 168.995 205.62 Q167.189 202.055 163.555 202.055 M163.555 198.351 Q169.365 198.351 172.421 202.958 Q175.499 207.541 175.499 216.291 Q175.499 225.018 172.421 229.624 Q169.365 234.207 163.555 234.207 Q157.745 234.207 154.666 229.624 Q151.61 225.018 151.61 216.291 Q151.61 207.541 154.666 202.958 Q157.745 198.351 163.555 198.351 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M183.717 227.657 L188.601 227.657 L188.601 233.536 L183.717 233.536 L183.717 227.657 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M199.596 229.601 L207.235 229.601 L207.235 203.235 L198.925 204.902 L198.925 200.643 L207.189 198.976 L211.865 198.976 L211.865 229.601 L219.504 229.601 L219.504 233.536 L199.596 233.536 L199.596 229.601 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M228.994 198.976 L247.351 198.976 L247.351 202.911 L233.277 202.911 L233.277 211.383 Q234.295 211.036 235.314 210.874 Q236.332 210.689 237.351 210.689 Q243.138 210.689 246.517 213.86 Q249.897 217.032 249.897 222.448 Q249.897 228.027 246.425 231.129 Q242.953 234.207 236.633 234.207 Q234.457 234.207 232.189 233.837 Q229.943 233.467 227.536 232.726 L227.536 228.027 Q229.619 229.161 231.841 229.717 Q234.064 230.272 236.541 230.272 Q240.545 230.272 242.883 228.166 Q245.221 226.059 245.221 222.448 Q245.221 218.837 242.883 216.731 Q240.545 214.624 236.541 214.624 Q234.666 214.624 232.791 215.041 Q230.939 215.458 228.994 216.337 L228.994 198.976 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M26.363 606.478 Q27.5546 606.543 27.619 607.348 Q27.6834 608.572 27.8444 609.313 Q27.9733 610.053 28.4564 611.213 Q28.9394 612.372 30.0989 613.499 Q31.2583 614.627 33.094 615.786 L70.8715 639.522 Q71.58 639.94 71.8054 640.295 Q72.0631 640.617 72.0631 641.357 Q72.0631 642.034 71.7732 642.291 Q71.5156 642.549 70.5494 642.678 L29.8412 647.895 Q29.1005 647.992 28.7784 648.088 Q28.4564 648.185 28.1343 648.572 Q27.8122 648.926 27.7156 649.699 Q27.619 650.472 27.619 651.857 Q27.619 652.501 27.5868 652.791 Q27.5546 653.048 27.3936 653.274 Q27.2003 653.499 26.8139 653.499 Q26.2342 653.499 25.9443 653.274 Q25.6222 653.016 25.59 652.823 Q25.5578 652.597 25.5578 652.243 Q25.5578 651.696 25.6222 650.504 Q25.6867 649.312 25.6867 648.7 Q25.6867 648.121 25.7189 646.897 Q25.7511 645.673 25.7511 645.061 Q25.7511 643.708 25.6545 640.971 Q25.5578 638.201 25.5578 636.881 Q25.5578 635.979 26.2986 635.979 Q27.2003 635.979 27.4258 636.366 Q27.619 636.752 27.619 637.622 Q27.619 639.812 28.1665 641.003 Q28.714 642.163 29.5836 642.163 L64.4947 637.686 L32.2889 617.428 Q30.7752 616.43 29.7768 616.43 Q27.8444 616.43 27.619 619.49 Q27.619 620.52 26.8139 620.52 Q26.2342 620.52 25.9443 620.263 Q25.6222 620.005 25.59 619.812 Q25.5578 619.586 25.5578 619.264 Q25.5578 618.201 25.6545 616.044 Q25.7511 613.854 25.7511 612.759 Q25.7511 611.857 25.6545 610.021 Q25.5578 608.185 25.5578 607.348 Q25.5578 606.478 26.363 606.478 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M54.1244 597.758 Q42.9812 597.758 33.9958 593.603 Q30.2277 591.832 27.0715 589.352 Q23.9153 586.872 22.5305 585.23 Q21.1456 583.587 21.1456 583.136 Q21.1456 582.492 21.7897 582.46 Q22.1118 582.46 22.917 583.329 Q33.7381 593.957 54.1244 593.925 Q74.5752 593.925 84.9776 583.587 Q86.1049 582.46 86.4591 582.46 Q87.1032 582.46 87.1032 583.136 Q87.1032 583.587 85.7828 585.165 Q84.4624 586.743 81.435 589.191 Q78.4077 591.639 74.704 593.41 Q65.7185 597.758 54.1244 597.758 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M61.1775 546.182 Q65.3321 547.052 67.7153 548.179 Q71.3546 549.982 71.3546 553.042 Q71.3546 555.361 69.9375 557.003 Q68.5205 558.646 66.3949 559.032 Q71.3546 563.251 71.3546 567.631 Q71.3546 571.496 68.4238 573.944 Q65.4609 576.391 60.791 576.391 Q56.089 576.391 51.5802 574.072 Q47.0713 571.721 44.2694 568.018 Q41.4675 564.314 41.4675 560.514 Q41.4675 556.488 45.6865 554.427 Q44.5271 554.266 43.6575 553.525 Q42.788 552.784 42.788 551.657 Q42.788 550.788 43.2711 550.272 Q43.7219 549.757 44.5593 549.757 Q44.978 549.757 46.8137 550.208 L56.0246 552.591 L61.9827 554.04 Q64.1727 554.588 64.9778 554.749 Q65.783 554.878 66.8457 554.878 Q69.8731 554.878 69.8731 552.913 Q69.8731 551.947 69.2612 551.174 Q68.6493 550.401 67.361 549.789 Q66.0728 549.177 64.8812 548.791 Q63.6574 548.404 61.725 547.889 Q60.9521 547.728 60.7588 547.599 Q60.5334 547.438 60.5334 546.987 Q60.5334 546.182 61.1775 546.182 M48.7138 555.232 Q48.424 555.232 47.6188 555.457 Q46.8137 555.683 45.6865 556.198 Q44.5593 556.713 43.7541 557.841 Q42.9168 558.936 42.9168 560.417 Q42.9168 562.414 44.6237 564.507 Q46.3306 566.568 49.2291 568.082 Q51.548 569.242 56.411 570.498 Q61.2741 571.721 63.6896 571.721 Q65.171 571.721 66.4915 571.399 Q67.7797 571.045 68.8425 570.047 Q69.8731 569.048 69.8731 567.502 Q69.8731 563.734 65.2032 560.031 Q64.3981 559.322 64.076 559.161 Q63.7218 558.968 62.7556 558.71 L49.8411 555.425 Q48.8749 555.232 48.7138 555.232 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M69.551 540.913 Q68.4882 541.847 67.1034 541.847 Q65.7185 541.847 64.688 540.945 Q63.6252 540.011 63.6252 538.336 Q63.6252 536.372 65.5253 535.244 Q67.3932 534.117 70.5494 534.117 Q73.9632 534.117 77.1194 535.502 Q80.3078 536.887 81.8215 538.24 Q83.3351 539.592 83.3351 540.14 Q83.3351 540.784 82.6266 540.784 Q82.369 540.784 81.8859 540.333 Q76.7974 535.599 70.5494 535.566 Q69.551 535.566 69.551 535.695 L69.6799 535.856 Q70.6138 536.983 70.6138 538.336 Q70.6138 539.979 69.551 540.913 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M42.9168 493.046 Q43.8186 493.046 44.044 493.464 Q44.2372 493.883 44.2372 495.042 L44.2372 501.226 L63.6896 506.121 Q65.3965 506.508 66.8457 506.508 Q68.456 506.508 69.1646 506.025 Q69.8731 505.509 69.8731 504.447 Q69.8731 502.353 67.973 500.099 Q66.0728 497.812 61.4352 495.88 Q60.8233 495.622 60.6944 495.493 Q60.5334 495.332 60.5334 494.914 Q60.5334 494.108 61.1775 494.108 Q61.403 494.108 62.4335 494.559 Q63.4641 494.978 64.9778 495.912 Q66.4915 496.814 67.9085 498.005 Q69.3256 499.165 70.3562 500.936 Q71.3546 502.707 71.3546 504.608 Q71.3546 507.281 69.6477 508.988 Q67.9407 510.662 65.2677 510.662 Q64.3981 510.662 61.6284 509.986 Q58.8265 509.31 44.2372 505.638 L44.2372 511.467 Q44.2372 512.273 44.205 512.595 Q44.1728 512.884 44.0118 513.11 Q43.8186 513.303 43.4321 513.303 Q42.8202 513.303 42.5625 513.046 Q42.2727 512.788 42.2405 512.466 Q42.1761 512.112 42.1761 511.306 L42.1761 505.123 L31.7092 502.546 Q30.6786 502.289 30.0989 501.645 Q29.4869 500.968 29.4225 500.582 Q29.3259 500.195 29.3259 499.906 Q29.3259 499.036 29.809 498.521 Q30.2599 498.005 31.0972 498.005 Q31.5481 498.005 42.1761 500.711 L42.1761 494.914 Q42.1761 494.173 42.2083 493.883 Q42.2405 493.561 42.4015 493.303 Q42.5625 493.046 42.9168 493.046 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M86.4591 487.883 Q86.1371 487.883 85.3319 487.046 Q74.5107 476.418 54.1244 476.418 Q33.6737 476.418 23.3356 486.627 Q22.144 487.883 21.7897 487.883 Q21.1456 487.883 21.1456 487.239 Q21.1456 486.788 22.4661 485.21 Q23.7865 483.6 26.8139 481.184 Q29.8412 478.737 33.5449 476.933 Q42.5303 472.585 54.1244 472.585 Q65.2677 472.585 74.2531 476.74 Q78.0212 478.511 81.1774 480.991 Q84.3335 483.471 85.7184 485.113 Q87.1032 486.756 87.1032 487.239 Q87.1032 487.883 86.4591 487.883 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip422)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="327.242,385.875 343.183,380.187 359.124,374.593 375.065,369.091 391.006,363.679 406.948,358.354 422.889,353.114 438.83,347.958 454.771,342.883 470.712,337.888 486.653,332.97 502.594,328.128 518.535,323.36 534.476,318.664 550.417,314.039 566.358,309.484 582.3,304.995 598.241,300.573 614.182,296.216 630.123,291.922 646.064,287.689 662.005,283.518 677.946,279.405 693.887,275.351 709.828,271.353 725.769,267.411 741.711,263.523 757.652,259.689 773.593,255.907 789.534,252.176 805.475,248.495 821.416,244.864 837.357,241.28 853.298,237.744 869.239,234.254 885.18,230.81 901.122,227.41 917.063,224.054 933.004,220.74 948.945,217.468 964.886,214.238 980.827,211.048 996.768,207.898 1012.71,204.787 1028.65,201.714 1044.59,198.678 1060.53,195.68 1076.47,192.717 1092.41,189.79 1108.36,186.898 1124.3,184.04 1140.24,181.216 1156.18,178.425 1172.12,175.666 1188.06,172.94 1204,170.244 1219.94,167.58 1235.88,164.946 1251.83,162.342 1267.77,159.767 1283.71,157.22 1299.65,154.702 1315.59,152.212 1331.53,149.75 1347.47,147.314 1363.41,144.905 1379.35,142.522 1395.3,140.164 1411.24,137.832 1427.18,135.525 1443.12,133.242 1459.06,130.983 1475,128.748 1490.94,126.536 1506.88,124.347 1522.82,122.18 1538.77,120.036 1554.71,117.914 1570.65,115.814 1586.59,113.734 1602.53,111.676 1618.47,109.638 1634.41,107.62 1650.35,105.623 1666.29,103.645 1682.24,101.686 1698.18,99.747 1714.12,97.8265 1730.06,95.9246 1746,94.041 1761.94,92.1755 1777.88,90.3277 1793.82,88.4975 1809.76,86.6845 1825.71,84.8886 1841.65,83.1095 1857.59,81.3469 1873.53,79.6007 1889.47,77.8706 1905.41,76.1564 "></polyline>
<polyline clip-path="url(#clip422)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="327.242,444.058 343.183,476.561 359.124,519.652 375.065,559.318 391.006,603.041 406.948,641.235 422.889,693.999 438.83,740.518 454.771,805.447 470.712,879.059 486.653,963.221 502.594,978.912 518.535,973.626 534.476,968.412 550.417,963.216 566.358,958.083 582.3,952.975 598.241,947.923 614.182,942.9 630.123,937.926 646.064,932.986 662.005,928.089 677.946,923.231 693.887,918.407 709.828,913.629 725.769,908.878 741.711,904.177 757.652,899.498 773.593,894.872 789.534,890.315 805.475,885.825 821.416,881.402 837.357,877.043 853.298,872.748 869.239,868.515 885.18,864.342 901.122,860.228 917.063,856.173 933.004,852.174 948.945,848.231 964.886,844.342 980.827,840.507 996.768,836.724 1012.71,832.992 1028.65,829.31 1044.59,825.678 1060.53,822.094 1076.47,818.371 1092.41,814.655 1108.36,810.99 1124.3,807.373 1140.24,803.805 1156.18,800.283 1172.12,796.807 1188.06,793.376 1204,789.99 1219.94,786.502 1235.88,782.995 1251.83,779.534 1267.77,776.118 1283.71,772.746 1299.65,769.417 1315.59,766.13 1331.53,762.764 1347.47,759.32 1363.41,755.922 1379.35,752.567 1395.3,749.254 1411.24,745.984 1427.18,742.755 1443.12,739.566 1459.06,736.417 1475,733.307 1490.94,730.235 1506.88,727.2 1522.82,724.202 1538.77,721.168 1554.71,718.07 1570.65,715.011 1586.59,711.988 1602.53,709.002 1618.47,706.053 1634.41,703.138 1650.35,700.258 1666.29,697.412 1682.24,694.6 1698.18,691.821 1714.12,689.073 1730.06,686.358 1746,683.638 1761.94,680.867 1777.88,678.128 1793.82,675.39 1809.76,672.564 1825.71,669.771 1841.65,667.011 1857.59,664.282 1873.53,661.585 1889.47,658.919 1905.41,656.222 "></polyline>
<polyline clip-path="url(#clip422)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="327.242,1039.9 343.183,1034.12 359.124,1028.38 375.065,1022.7 391.006,1017.05 406.948,1011.48 422.889,1005.92 438.83,1000.44 454.771,994.973 470.712,989.588 486.653,984.211 502.594,978.912 518.535,973.626 534.476,968.412 550.417,963.216 566.358,958.083 582.3,952.975 598.241,947.923 614.182,942.9 630.123,937.926 646.064,932.986 662.005,928.089 677.946,923.231 693.887,918.407 709.828,913.629 725.769,908.878 741.711,904.177 757.652,899.498 773.593,894.872 789.534,890.263 805.475,885.71 821.416,881.17 837.357,876.689 853.298,872.215 869.239,867.802 885.18,863.396 901.122,859.047 917.063,854.709 933.004,850.423 948.945,846.152 964.886,841.927 980.827,837.721 996.768,833.556 1012.71,829.414 1028.65,825.307 1044.59,821.228 1060.53,817.179 1076.47,813.161 1092.41,809.168 1108.36,805.209 1124.3,801.271 1140.24,797.371 1156.18,793.487 1172.12,789.644 1188.06,785.812 1204,782.025 1219.94,778.246 1235.88,774.513 1251.83,770.784 1267.77,767.102 1283.71,763.426 1299.65,759.792 1315.59,756.168 1331.53,752.583 1347.47,749.01 1363.41,745.471 1379.35,741.948 1395.3,738.456 1411.24,734.982 1427.18,731.534 1443.12,728.109 1459.06,724.705 1475,721.326 1490.94,717.966 1506.88,714.633 1522.82,711.316 1538.77,708.028 1554.71,704.752 1570.65,701.509 1586.59,698.274 1602.53,695.074 1618.47,691.879 1634.41,688.721 1650.35,685.566 1666.29,682.447 1682.24,679.334 1698.18,676.253 1714.12,673.18 1730.06,670.136 1746,667.104 1761.94,664.097 1777.88,661.103 1793.82,658.132 1809.76,655.177 1825.71,652.241 1841.65,649.324 1857.59,646.423 1873.53,643.543 1889.47,640.676 1905.41,637.832 "></polyline>
<path clip-path="url(#clip420)" d="M1533.9 1034.76 L1896.99 1034.76 L1896.99 827.399 L1533.9 827.399  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<polyline clip-path="url(#clip420)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1533.9,1034.76 1896.99,1034.76 1896.99,827.399 1533.9,827.399 1533.9,1034.76 "></polyline>
<polyline clip-path="url(#clip420)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1552.49,879.239 1664.01,879.239 "></polyline>
<path clip-path="url(#clip420)" d="M1697.33 874.903 Q1697.33 875.559 1697.03 875.723 Q1696.72 875.864 1695.88 875.864 L1691.38 875.864 L1687.82 890.011 Q1687.54 891.252 1687.54 892.306 Q1687.54 893.477 1687.89 893.993 Q1688.27 894.508 1689.04 894.508 Q1690.56 894.508 1692.2 893.126 Q1693.87 891.744 1695.27 888.371 Q1695.46 887.926 1695.55 887.833 Q1695.67 887.715 1695.97 887.715 Q1696.56 887.715 1696.56 888.184 Q1696.56 888.348 1696.23 889.097 Q1695.93 889.847 1695.25 890.948 Q1694.59 892.049 1693.73 893.079 Q1692.88 894.11 1691.59 894.859 Q1690.31 895.585 1688.92 895.585 Q1686.98 895.585 1685.74 894.344 Q1684.52 893.103 1684.52 891.159 Q1684.52 890.526 1685.01 888.512 Q1685.5 886.474 1688.17 875.864 L1683.93 875.864 Q1683.35 875.864 1683.11 875.84 Q1682.9 875.817 1682.74 875.7 Q1682.6 875.559 1682.6 875.278 Q1682.6 874.833 1682.79 874.646 Q1682.97 874.435 1683.21 874.412 Q1683.47 874.365 1684.05 874.365 L1688.55 874.365 L1690.42 866.752 Q1690.61 866.003 1691.08 865.581 Q1691.57 865.136 1691.85 865.089 Q1692.13 865.019 1692.34 865.019 Q1692.98 865.019 1693.35 865.37 Q1693.73 865.698 1693.73 866.307 Q1693.73 866.635 1691.76 874.365 L1695.97 874.365 Q1696.51 874.365 1696.72 874.388 Q1696.96 874.412 1697.14 874.529 Q1697.33 874.646 1697.33 874.903 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M1713.06 887.762 Q1713.1 887.177 1714.02 887.177 L1743.41 887.177 Q1744.79 887.177 1744.82 887.715 Q1744.82 888.301 1743.5 888.278 L1714.34 888.278 Q1713.06 888.301 1713.06 887.762 M1713.06 878.393 Q1713.06 877.808 1714.06 877.831 L1743.36 877.831 Q1744.79 877.831 1744.82 878.393 Q1744.82 878.932 1743.6 878.932 L1714.02 878.932 Q1713.06 878.932 1713.06 878.393 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M1795.95 863.099 Q1795.95 863.544 1795.86 863.918 L1794.55 872.257 Q1794.48 872.889 1794.33 873.123 Q1794.22 873.358 1793.84 873.358 Q1793.26 873.358 1793.26 872.749 Q1793.26 872.397 1793.4 871.835 Q1793.8 869.188 1793.8 867.994 Q1793.8 867.197 1793.63 866.612 Q1793.49 866.003 1793.26 865.581 Q1793.05 865.16 1792.55 864.879 Q1792.06 864.598 1791.59 864.434 Q1791.13 864.27 1790.28 864.199 Q1789.44 864.106 1788.71 864.082 Q1787.99 864.059 1786.79 864.059 Q1784.19 864.059 1783.77 864.153 Q1783.33 864.27 1783.09 864.621 Q1782.88 864.949 1782.65 865.933 L1776.28 891.393 L1776.09 892.4 Q1776.09 892.962 1776.44 893.15 Q1776.79 893.337 1777.87 893.454 Q1779.41 893.571 1780.94 893.571 Q1780.98 893.571 1781.08 893.571 Q1781.59 893.571 1781.8 893.595 Q1782.01 893.595 1782.23 893.641 Q1782.44 893.688 1782.48 893.805 Q1782.55 893.899 1782.55 894.086 Q1782.55 894.531 1782.37 894.766 Q1782.18 894.976 1781.99 895.023 Q1781.83 895.047 1781.5 895.047 Q1780.84 895.047 1779.44 895 Q1778.03 894.953 1777.33 894.953 L1773.35 894.906 L1769.27 894.953 Q1768.64 894.953 1767.31 895 Q1765.97 895.047 1765.34 895.047 Q1764.52 895.047 1764.52 894.461 Q1764.52 893.805 1764.82 893.688 Q1765.15 893.571 1766.53 893.571 Q1768.48 893.571 1769.53 893.477 Q1770.58 893.384 1771.15 893.056 Q1771.73 892.728 1771.9 892.4 Q1772.06 892.049 1772.25 891.252 L1778.69 865.652 Q1778.88 865.089 1778.88 864.644 Q1778.88 864.41 1778.81 864.316 Q1778.76 864.223 1778.45 864.153 Q1778.15 864.059 1777.52 864.059 L1775.64 864.059 Q1773.72 864.059 1772.53 864.153 Q1771.36 864.223 1770.23 864.574 Q1769.13 864.925 1768.48 865.417 Q1767.84 865.909 1767.14 866.916 Q1766.44 867.924 1765.92 869.141 Q1765.43 870.359 1764.73 872.35 Q1764.49 873.006 1764.35 873.194 Q1764.24 873.358 1763.91 873.358 Q1763.67 873.358 1763.49 873.217 Q1763.32 873.053 1763.32 872.842 Q1763.56 872.069 1763.6 871.976 L1766.49 863.52 Q1766.72 862.841 1766.93 862.724 Q1767.16 862.583 1768.03 862.583 L1794.64 862.583 Q1795.06 862.583 1795.2 862.583 Q1795.34 862.583 1795.58 862.63 Q1795.81 862.677 1795.88 862.794 Q1795.95 862.911 1795.95 863.099 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip420)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1552.49,931.079 1664.01,931.079 "></polyline>
<path clip-path="url(#clip420)" d="M1697.33 926.743 Q1697.33 927.399 1697.03 927.563 Q1696.72 927.704 1695.88 927.704 L1691.38 927.704 L1687.82 941.851 Q1687.54 943.092 1687.54 944.146 Q1687.54 945.317 1687.89 945.833 Q1688.27 946.348 1689.04 946.348 Q1690.56 946.348 1692.2 944.966 Q1693.87 943.584 1695.27 940.211 Q1695.46 939.766 1695.55 939.673 Q1695.67 939.555 1695.97 939.555 Q1696.56 939.555 1696.56 940.024 Q1696.56 940.188 1696.23 940.937 Q1695.93 941.687 1695.25 942.788 Q1694.59 943.889 1693.73 944.919 Q1692.88 945.95 1691.59 946.699 Q1690.31 947.425 1688.92 947.425 Q1686.98 947.425 1685.74 946.184 Q1684.52 944.943 1684.52 942.999 Q1684.52 942.366 1685.01 940.352 Q1685.5 938.314 1688.17 927.704 L1683.93 927.704 Q1683.35 927.704 1683.11 927.68 Q1682.9 927.657 1682.74 927.54 Q1682.6 927.399 1682.6 927.118 Q1682.6 926.673 1682.79 926.486 Q1682.97 926.275 1683.21 926.252 Q1683.47 926.205 1684.05 926.205 L1688.55 926.205 L1690.42 918.592 Q1690.61 917.843 1691.08 917.421 Q1691.57 916.976 1691.85 916.929 Q1692.13 916.859 1692.34 916.859 Q1692.98 916.859 1693.35 917.21 Q1693.73 917.538 1693.73 918.147 Q1693.73 918.475 1691.76 926.205 L1695.97 926.205 Q1696.51 926.205 1696.72 926.228 Q1696.96 926.252 1697.14 926.369 Q1697.33 926.486 1697.33 926.743 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M1713.06 939.602 Q1713.1 939.017 1714.02 939.017 L1743.41 939.017 Q1744.79 939.017 1744.82 939.555 Q1744.82 940.141 1743.5 940.118 L1714.34 940.118 Q1713.06 940.141 1713.06 939.602 M1713.06 930.233 Q1713.06 929.648 1714.06 929.671 L1743.36 929.671 Q1744.79 929.671 1744.82 930.233 Q1744.82 930.772 1743.6 930.772 L1714.02 930.772 Q1713.06 930.772 1713.06 930.233 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M1795.95 914.939 Q1795.95 915.384 1795.86 915.758 L1794.55 924.097 Q1794.48 924.729 1794.33 924.963 Q1794.22 925.198 1793.84 925.198 Q1793.26 925.198 1793.26 924.589 Q1793.26 924.237 1793.4 923.675 Q1793.8 921.028 1793.8 919.834 Q1793.8 919.037 1793.63 918.452 Q1793.49 917.843 1793.26 917.421 Q1793.05 917 1792.55 916.719 Q1792.06 916.438 1791.59 916.274 Q1791.13 916.11 1790.28 916.039 Q1789.44 915.946 1788.71 915.922 Q1787.99 915.899 1786.79 915.899 Q1784.19 915.899 1783.77 915.993 Q1783.33 916.11 1783.09 916.461 Q1782.88 916.789 1782.65 917.773 L1776.28 943.233 L1776.09 944.24 Q1776.09 944.802 1776.44 944.99 Q1776.79 945.177 1777.87 945.294 Q1779.41 945.411 1780.94 945.411 Q1780.98 945.411 1781.08 945.411 Q1781.59 945.411 1781.8 945.435 Q1782.01 945.435 1782.23 945.481 Q1782.44 945.528 1782.48 945.645 Q1782.55 945.739 1782.55 945.926 Q1782.55 946.371 1782.37 946.606 Q1782.18 946.816 1781.99 946.863 Q1781.83 946.887 1781.5 946.887 Q1780.84 946.887 1779.44 946.84 Q1778.03 946.793 1777.33 946.793 L1773.35 946.746 L1769.27 946.793 Q1768.64 946.793 1767.31 946.84 Q1765.97 946.887 1765.34 946.887 Q1764.52 946.887 1764.52 946.301 Q1764.52 945.645 1764.82 945.528 Q1765.15 945.411 1766.53 945.411 Q1768.48 945.411 1769.53 945.317 Q1770.58 945.224 1771.15 944.896 Q1771.73 944.568 1771.9 944.24 Q1772.06 943.889 1772.25 943.092 L1778.69 917.492 Q1778.88 916.929 1778.88 916.484 Q1778.88 916.25 1778.81 916.156 Q1778.76 916.063 1778.45 915.993 Q1778.15 915.899 1777.52 915.899 L1775.64 915.899 Q1773.72 915.899 1772.53 915.993 Q1771.36 916.063 1770.23 916.414 Q1769.13 916.765 1768.48 917.257 Q1767.84 917.749 1767.14 918.756 Q1766.44 919.764 1765.92 920.981 Q1765.43 922.199 1764.73 924.19 Q1764.49 924.846 1764.35 925.034 Q1764.24 925.198 1763.91 925.198 Q1763.67 925.198 1763.49 925.057 Q1763.32 924.893 1763.32 924.682 Q1763.56 923.909 1763.6 923.816 L1766.49 915.36 Q1766.72 914.681 1766.93 914.564 Q1767.16 914.423 1768.03 914.423 L1794.64 914.423 Q1795.06 914.423 1795.2 914.423 Q1795.34 914.423 1795.58 914.47 Q1795.81 914.517 1795.88 914.634 Q1795.95 914.751 1795.95 914.939 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M1836.05 934.215 Q1836.33 934.496 1836.33 934.894 Q1836.33 935.293 1836.05 935.574 Q1835.77 935.855 1835.37 935.855 L1805.34 935.855 Q1804.94 935.855 1804.66 935.574 Q1804.38 935.293 1804.38 934.894 Q1804.38 934.496 1804.66 934.215 Q1804.94 933.934 1805.34 933.934 L1835.37 933.934 Q1835.77 933.934 1836.05 934.215 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M1854.65 946.887 Q1854.65 946.02 1854.72 945.762 Q1854.81 945.505 1855.19 945.107 L1864.39 934.848 Q1869.43 929.179 1869.43 924.237 Q1869.43 921.028 1867.74 918.733 Q1866.08 916.438 1863.01 916.438 Q1860.9 916.438 1859.12 917.726 Q1857.34 919.014 1856.52 921.309 Q1856.66 921.263 1857.16 921.263 Q1858.35 921.263 1859.01 922.012 Q1859.69 922.762 1859.69 923.769 Q1859.69 925.057 1858.84 925.689 Q1858.02 926.298 1857.2 926.298 Q1856.88 926.298 1856.43 926.228 Q1856.01 926.158 1855.33 925.502 Q1854.65 924.823 1854.65 923.628 Q1854.65 920.279 1857.18 917.609 Q1859.73 914.939 1863.62 914.939 Q1868.02 914.939 1870.91 917.562 Q1873.81 920.162 1873.81 924.237 Q1873.81 925.666 1873.36 926.978 Q1872.94 928.266 1872.36 929.273 Q1871.8 930.28 1870.25 931.896 Q1868.7 933.513 1867.46 934.66 Q1866.22 935.808 1863.43 938.244 L1858.35 943.186 L1866.99 943.186 Q1871.21 943.186 1871.54 942.811 Q1872.01 942.132 1872.59 938.548 L1873.81 938.548 L1872.45 946.887 L1854.65 946.887 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip420)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1552.49,982.919 1664.01,982.919 "></polyline>
<path clip-path="url(#clip420)" d="M1697.33 978.33 Q1697.33 978.985 1697.03 979.149 Q1696.72 979.29 1695.88 979.29 L1691.38 979.29 L1687.82 993.437 Q1687.54 994.678 1687.54 995.732 Q1687.54 996.904 1687.89 997.419 Q1688.27 997.934 1689.04 997.934 Q1690.56 997.934 1692.2 996.552 Q1693.87 995.17 1695.27 991.797 Q1695.46 991.352 1695.55 991.259 Q1695.67 991.142 1695.97 991.142 Q1696.56 991.142 1696.56 991.61 Q1696.56 991.774 1696.23 992.524 Q1695.93 993.273 1695.25 994.374 Q1694.59 995.475 1693.73 996.505 Q1692.88 997.536 1691.59 998.285 Q1690.31 999.012 1688.92 999.012 Q1686.98 999.012 1685.74 997.77 Q1684.52 996.529 1684.52 994.585 Q1684.52 993.952 1685.01 991.938 Q1685.5 989.9 1688.17 979.29 L1683.93 979.29 Q1683.35 979.29 1683.11 979.266 Q1682.9 979.243 1682.74 979.126 Q1682.6 978.985 1682.6 978.704 Q1682.6 978.259 1682.79 978.072 Q1682.97 977.861 1683.21 977.838 Q1683.47 977.791 1684.05 977.791 L1688.55 977.791 L1690.42 970.179 Q1690.61 969.429 1691.08 969.007 Q1691.57 968.562 1691.85 968.516 Q1692.13 968.445 1692.34 968.445 Q1692.98 968.445 1693.35 968.797 Q1693.73 969.124 1693.73 969.733 Q1693.73 970.061 1691.76 977.791 L1695.97 977.791 Q1696.51 977.791 1696.72 977.814 Q1696.96 977.838 1697.14 977.955 Q1697.33 978.072 1697.33 978.33 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M1713.06 991.188 Q1713.1 990.603 1714.02 990.603 L1743.41 990.603 Q1744.79 990.603 1744.82 991.142 Q1744.82 991.727 1743.5 991.704 L1714.34 991.704 Q1713.06 991.727 1713.06 991.188 M1713.06 981.819 Q1713.06 981.234 1714.06 981.257 L1743.36 981.257 Q1744.79 981.257 1744.82 981.819 Q1744.82 982.358 1743.6 982.358 L1714.02 982.358 Q1713.06 982.358 1713.06 981.819 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip420)" d="M1763.32 971.092 L1763.32 969.593 Q1769.09 969.593 1772.06 966.525 Q1772.88 966.525 1773.02 966.712 Q1773.16 966.899 1773.16 967.766 L1773.16 994.678 Q1773.16 996.107 1773.86 996.552 Q1774.57 996.997 1777.63 996.997 L1779.16 996.997 L1779.16 998.473 Q1777.47 998.332 1771.38 998.332 Q1765.29 998.332 1763.63 998.473 L1763.63 996.997 L1765.15 996.997 Q1768.17 996.997 1768.9 996.576 Q1769.62 996.131 1769.62 994.678 L1769.62 969.827 Q1767.12 971.092 1763.32 971.092 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path></svg>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-vf-illegal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Value function computed with illegal parallelization.
</figcaption>
</figure>
</div>
</div>
<p><a href="#fig-vf-illegal" class="quarto-xref">図&nbsp;4</a> のように, 時間方向に並列化すると正しい価値関数が得られません.</p>
</section>
<section id="monte-carlo-simulation-for-smm" class="level2">
<h2 class="anchored" data-anchor-id="monte-carlo-simulation-for-smm">Monte Carlo Simulation for SMM</h2>
<p>SMM (Simulated Method of Moments) のようなシミュレーションベースの推定では, モデルのパラメータを変化させながら (モンテカルロ) シミュレーションを繰り返す必要があります. このとき, 正確に実装しないと, モデルのパラメータを変化させるたびに, ランダムな数を生成してまい, 正確な最適化ができません. そのため, モデルのパラメータを変化させるたびに, 新たに乱数を生成するのではなく, 事前に乱数を生成しておき, それを使いまわす必要があります.</p>
<p>例として, 第二回の授業で扱った次のモデルを考えましょう.</p>
<p><strong>モデル</strong></p>
<p><span class="math display">\[
\max_{c, l} u(c, l) = \log c + \alpha \log (1-l) \quad \text{s.t.} \quad c = w (1 - l),
\]</span></p>
<p>where</p>
<p><span class="math display">\[
\log w \sim \mathcal{N}(\mu, \sigma).
\]</span></p>
<p>標準化のため, <span class="math inline">\(\mu = 0\)</span> とする. この時, <span class="math inline">\(\theta = (\alpha, \sigma)\)</span> を推定する.</p>
<div id="cell-prep-dist-earn" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>mean_leisure_data <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fl">33.4</span> <span class="op">/</span> (<span class="fl">16</span> <span class="op">*</span> <span class="fl">7</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>earn <span class="op">=</span> [<span class="fl">25</span>, <span class="fl">75</span>, <span class="fl">150</span>, <span class="fl">250</span>, <span class="fl">350</span>, <span class="fl">450</span>, <span class="fl">550</span>, <span class="fl">650</span>, <span class="fl">750</span>, <span class="fl">850</span>, <span class="fl">950</span>, <span class="fl">1100</span>, <span class="fl">1200</span>]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>density <span class="op">=</span> [<span class="fl">13.7</span>, <span class="fl">12.2</span>, <span class="fl">12.3</span>, <span class="fl">14.8</span>, <span class="fl">20.2</span>, <span class="fl">16.3</span>, <span class="fl">7.0</span>, <span class="fl">2.0</span>, <span class="fl">0.6</span>, <span class="fl">0.4</span>, <span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>] <span class="op">/</span> <span class="fl">100</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>mean_learn_data <span class="op">=</span> density<span class="op">'</span> <span class="op">*</span> <span class="fu">log</span>.(earn)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>sd_learn_data <span class="op">=</span> <span class="fu">sqrt</span>(density<span class="op">'</span> <span class="op">*</span> (<span class="fu">log</span>.(earn) <span class="op">.-</span> mean_learn_data) <span class="op">.^</span> <span class="fl">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div id="prep-dist-earn" class="cell-output cell-output-display" data-execution_count="1">
<pre><code>1.0157557015499716</code></pre>
</div>
</div>
<p><strong>悪い実装例</strong></p>
<div id="34" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">mc_bad</span>(α, σ; n_mc<span class="op">=</span><span class="fl">10</span><span class="op">^</span><span class="fl">6</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    ls <span class="op">=</span> <span class="fu">zeros</span>(n_mc)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    learns <span class="op">=</span> <span class="fu">similar</span>(ls)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>n_mc</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>        w <span class="op">=</span> <span class="fu">rand</span>(<span class="fu">LogNormal</span>(<span class="fl">0</span>, σ))</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        l_opt <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> (<span class="fl">1</span> <span class="op">+</span> α)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>        c_opt <span class="op">=</span> w <span class="op">*</span> (<span class="fl">1</span> <span class="op">-</span> l_opt)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        ls[i] <span class="op">=</span> l_opt</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        learns[i] <span class="op">=</span> <span class="fu">log</span>(w)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [<span class="fu">mean</span>(ls), <span class="fu">std</span>(ls)]</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>mc_bad (generic function with 1 method)</code></pre>
</div>
</div>
<p>では, SMMで推定するパラメータが確率分布のパラメータであるときは, どのように乱数を生成すれば良いでしょうか. これには大きく二つの方法があります.</p>


<!-- -->


</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-perla" class="csl-entry" role="listitem">
Perla, Jesse, Thomas J. Sargent, and John Stachurski. n.d. <span>“Quantitative <span>Economics</span> with <span>Julia</span>.”</span> <em>Quantitative Economics with Julia</em>. https://julia.quantecon.org/intro.html. Accessed October 8, 2025.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p><code>@time</code> マクロでも簡易的に測定できますが, 関数の宣言によるコンパイル時間なども含んでしまうため, 関数の実行速度を正確に測定するには <code>BenchmarkTools.jl</code> パッケージを使うのが望ましいです.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/kazuyanagimoto\.github\.io\/course-kobe-macro4-2025\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> 数値計算の補足</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2025-10-11</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="an">engine:</span><span class="co"> julia</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="an">julia:</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">  exeflags: ["--threads=auto"]</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>::: {.callout-warning}</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>このページは数値計算に関する補足を雑多にまとめたものです. 書きかけの内容を多く含みます.</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="in">```{julia}</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Plots</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LaTeXStrings</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a><span class="fu">default</span>(size<span class="op">=</span>(<span class="fl">500</span>, <span class="fl">309</span>), titlefontsize<span class="op">=</span><span class="fl">10</span>, fmt<span class="op">=:</span>svg)</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a><span class="fu">## 計算量</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>アルゴリズムの効率性を評価する尺度として、計算時間とメモリ使用量があります. ここでいう計算時間とは, アルゴリズムが終了するまでにかかるステップ数 (**時間計算量**, time complexity) のことをいい, 実際のPC上での実行時間とは異なります. より高いスペックのPCを使えば, 同じアルゴリズムでも実行時間は短くなる一方で, ステップ数の次元が異なるアルゴリズムはマシンの性能に関わらず効率的と言えます.また, メモリ使用量とはアルゴリズムが終了するまでに必要なメモリの量 (**領域計算量**, space complexity) のことをいいます.</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a><span class="fu">### 時間計算量</span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>時間計算量は, 入力の大きさ $n$ に対するステップ数 $T(n)$ の関数として表されます. 例えば, 配列の要素数が $n$ のときに, すべての要素を1回ずつ見るアルゴリズムは, $T(n) = n$ となります. また, 2重ループで配列のすべての組み合わせを調べるアルゴリズムは, $T(n) = n^2$ となります. このように, アルゴリズムの時間計算量は, 入力の大きさに対するステップ数の増加率によって特徴づけられます.</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>時間計算量を評価する際, 重要なのは支配的な項の次元数になります. 例えば, $T(n) = 3n^2 + 2n + 1$ の場合, $n$ が大きくなると $3n^2$ の項が支配的になるため, $n^2$ に着目すれば十分です. この考え方に従ったとき, 計算量を $O(n^2)$ と表記します. より厳密に表現すると以下のようになります.</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a><span class="fu">## $O$-記法</span></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>$f(n)$ が $O(g(n))$ とは, 任意の $n \ge 0$ に対して, ある定数 $C &gt; 0$ が存在して, 以下の不等式が成り立つことをいう.</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span>f(n)<span class="pp">|</span> \le C <span class="pp">|</span>g(n)<span class="pp">|</span>.</span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>定量モデルで気にする必要があるのは, ほとんどの場合, グリッド数によるオーダーです. 例えば, $V(k, z)$ のような2次元の価値関数をグリッド上で計算する場合, $k$ のグリッド数 $n_k$ と $z$ のグリッド数 $n_z$ に対して, 計算量は $n_k n_z$ の関数となります.</span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a><span class="fu">### 領域計算量</span></span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>領域計算量は, アルゴリズムが終了するまでに必要なメモリの量を, 入力の大きさ $n$ に対する関数として表します. 例えば, 配列の要素数が $n$ のときに, すべての要素を保存するアルゴリズムは, 領域計算量が $O(n)$ となります. また, 2次元配列を保存するアルゴリズムは, 領域計算量が $O(n^2)$ となります.</span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>**メモリのヒエラルキー**</span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>なぜメモリの使用量が重要なのでしょうか. 近年のPCは何百GBもの容量があるし, いくら使おうと問題ではないのではないか, と思うかもしれません. しかし, 実際には, メモリのヒエラルキー (memory hierarchy) によって, メモリの速度と容量が大きく異なります.</span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>一般に, 高速なメモリは高価であるため搭載量が少なく, 低速なメモリは安価であるため搭載量が多いです. それらを合わせると @fig-memory-hierarchy ようなピラミッド型のヒエラルキーが形成されます.</span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a><span class="al">![Memory Hierarchy.](/static/img/lecture/memory_hierarchy.drawio.svg)</span>{#fig-memory-hierarchy fig-align="center"}</span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>レジスタ (Registers): CPU内部にある最も高速なメモリ</span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>キャッシュ (Cache): (近年では) CPU内部にある高速なメモリ. L1, L2, L3 などのレベルがある. ここまでCPU内部にある.</span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>主記憶 (Main Memory): RAM (Random Access Memory)</span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>補助記憶 (Auxiliary Storage): SSD (Solid State Drive) やHDD (Hard Disk Drive)</span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a>たとえば, AMDの最新世代のCPUである <span class="co">[</span><span class="ot">Ryzen 5 9600</span><span class="co">](https://www.amd.com/en/products/processors/desktops/ryzen/9000-series/amd-ryzen-5-9600.html)</span> の場合, L1キャッシュは480KB, L2キャッシュは6MB, L3キャッシュは32MBです. レジスタはサイズで表現することはあまりありませんが, ざっくり数百B程度と考えてください. 一方で, 一般にメモリと呼ばれる RAM は8GBから64GB 程度が一般的です. さらに, 一般にストレージとよばれるSSDやHDDは数百GBから数TBの容量があります.</span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a><span class="fu">### 計算量の実践</span></span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a>実際にモデルを使って, 計算量を測定してみましょう. 例えば, 以下のような単純なライフサイクルモデルを考えます.</span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a>**Model**</span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a>\max_{<span class="sc">\{</span>c_t, a_{t+1}<span class="sc">\}</span>_{t=0}^{T-1}} \sum_{t=0}^{T-1} \beta^t u(c_t) <span class="sc">\\</span></span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a>\quad\text{s.t. } c_t + a_{t+1} = (1+r) a_t + w, \quad a_0 \text{ given}, \quad a_T \ge 0.</span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-86"><a href="#cb21-86" aria-hidden="true" tabindex="-1"></a>これは後方帰納法で解くことができます. コードで表すと次の <span class="in">`solve!`</span> 関数のようになります.</span>
<span id="cb21-87"><a href="#cb21-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-90"><a href="#cb21-90" aria-hidden="true" tabindex="-1"></a><span class="in">```{julia}</span></span>
<span id="cb21-91"><a href="#cb21-91" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: model-life-cycle</span></span>
<span id="cb21-92"><a href="#cb21-92" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb21-93"><a href="#cb21-93" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> My</span>
<span id="cb21-94"><a href="#cb21-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-95"><a href="#cb21-95" aria-hidden="true" tabindex="-1"></a><span class="pp">@kwdef</span> <span class="kw">struct</span> Model{TF<span class="op">&lt;:</span><span class="dt">AbstractFloat</span>,TI<span class="op">&lt;:</span><span class="dt">Integer</span>}</span>
<span id="cb21-96"><a href="#cb21-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-97"><a href="#cb21-97" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Utility function</span></span>
<span id="cb21-98"><a href="#cb21-98" aria-hidden="true" tabindex="-1"></a>    γ<span class="op">::</span><span class="dt">TF </span><span class="op">=</span> <span class="fl">2.0</span></span>
<span id="cb21-99"><a href="#cb21-99" aria-hidden="true" tabindex="-1"></a>    β<span class="op">::</span><span class="dt">TF </span><span class="op">=</span> <span class="fl">0.96</span></span>
<span id="cb21-100"><a href="#cb21-100" aria-hidden="true" tabindex="-1"></a>    T<span class="op">::</span><span class="dt">Int </span><span class="op">=</span> <span class="fl">10</span></span>
<span id="cb21-101"><a href="#cb21-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-102"><a href="#cb21-102" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prices</span></span>
<span id="cb21-103"><a href="#cb21-103" aria-hidden="true" tabindex="-1"></a>    r<span class="op">::</span><span class="dt">TF </span><span class="op">=</span> <span class="fl">0.07</span></span>
<span id="cb21-104"><a href="#cb21-104" aria-hidden="true" tabindex="-1"></a>    w<span class="op">::</span><span class="dt">TF </span><span class="op">=</span> <span class="fl">5.0</span></span>
<span id="cb21-105"><a href="#cb21-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-106"><a href="#cb21-106" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Grid for assets</span></span>
<span id="cb21-107"><a href="#cb21-107" aria-hidden="true" tabindex="-1"></a>    n_a<span class="op">::</span><span class="dt">TI </span><span class="op">=</span> <span class="fl">30</span></span>
<span id="cb21-108"><a href="#cb21-108" aria-hidden="true" tabindex="-1"></a>    a_min<span class="op">::</span><span class="dt">TF </span><span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb21-109"><a href="#cb21-109" aria-hidden="true" tabindex="-1"></a>    a_max<span class="op">::</span><span class="dt">TF </span><span class="op">=</span> <span class="fl">4.0</span></span>
<span id="cb21-110"><a href="#cb21-110" aria-hidden="true" tabindex="-1"></a>    a_grid<span class="op">::</span><span class="dt">Vector{TF} </span><span class="op">=</span> <span class="fu">collect</span>(<span class="fu">range</span>(start<span class="op">=</span>a_min, stop<span class="op">=</span>a_max, length<span class="op">=</span>n_a))</span>
<span id="cb21-111"><a href="#cb21-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-112"><a href="#cb21-112" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Value function</span></span>
<span id="cb21-113"><a href="#cb21-113" aria-hidden="true" tabindex="-1"></a>    V<span class="op">::</span><span class="dt">Matrix{TF} </span><span class="op">=</span> <span class="fu">zeros</span>(n_a, T)</span>
<span id="cb21-114"><a href="#cb21-114" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb21-115"><a href="#cb21-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-116"><a href="#cb21-116" aria-hidden="true" tabindex="-1"></a><span class="fu">u</span>(c, m<span class="op">::</span><span class="dt">Model</span>) <span class="op">=</span> <span class="fu">isone</span>(m.γ) ? <span class="fu">log</span>(c) <span class="op">:</span> c<span class="op">^</span>(<span class="fl">1</span> <span class="op">-</span> m.γ) <span class="op">/</span> (<span class="fl">1</span> <span class="op">-</span> m.γ)</span>
<span id="cb21-117"><a href="#cb21-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-118"><a href="#cb21-118" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">solve!</span>(m<span class="op">::</span><span class="dt">Model</span>)</span>
<span id="cb21-119"><a href="#cb21-119" aria-hidden="true" tabindex="-1"></a>    (; T, n_a, r, w, β, a_grid) <span class="op">=</span> m</span>
<span id="cb21-120"><a href="#cb21-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-121"><a href="#cb21-121" aria-hidden="true" tabindex="-1"></a>    V <span class="op">=</span> <span class="fu">zeros</span>(n_a, T)</span>
<span id="cb21-122"><a href="#cb21-122" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="op">=</span> T<span class="op">:-</span><span class="fl">1</span><span class="op">:</span><span class="fl">1</span>, i_a <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>n_a</span>
<span id="cb21-123"><a href="#cb21-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-124"><a href="#cb21-124" aria-hidden="true" tabindex="-1"></a>        utility <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span></span>
<span id="cb21-125"><a href="#cb21-125" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i_a′ <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>n_a</span>
<span id="cb21-126"><a href="#cb21-126" aria-hidden="true" tabindex="-1"></a>            V′ <span class="op">=</span> (t <span class="op">==</span> T) ? <span class="fl">0.0</span> <span class="op">:</span> V[i_a′, t<span class="op">+</span><span class="fl">1</span>]</span>
<span id="cb21-127"><a href="#cb21-127" aria-hidden="true" tabindex="-1"></a>            c <span class="op">=</span> (<span class="fl">1</span> <span class="op">+</span> r) <span class="op">*</span> a_grid[i_a] <span class="op">+</span> w <span class="op">-</span> a_grid[i_a′]</span>
<span id="cb21-128"><a href="#cb21-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-129"><a href="#cb21-129" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> c <span class="op">&gt;</span> <span class="fl">0</span></span>
<span id="cb21-130"><a href="#cb21-130" aria-hidden="true" tabindex="-1"></a>                utility <span class="op">=</span> <span class="fu">max</span>(<span class="fu">u</span>(c, m) <span class="op">+</span> β <span class="op">*</span> V′, utility)</span>
<span id="cb21-131"><a href="#cb21-131" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb21-132"><a href="#cb21-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-133"><a href="#cb21-133" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb21-134"><a href="#cb21-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-135"><a href="#cb21-135" aria-hidden="true" tabindex="-1"></a>        V[i_a, t] <span class="op">=</span> utility</span>
<span id="cb21-136"><a href="#cb21-136" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb21-137"><a href="#cb21-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-138"><a href="#cb21-138" aria-hidden="true" tabindex="-1"></a>    m.V <span class="op">.=</span> V</span>
<span id="cb21-139"><a href="#cb21-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-140"><a href="#cb21-140" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="cn">nothing</span></span>
<span id="cb21-141"><a href="#cb21-141" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb21-142"><a href="#cb21-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-143"><a href="#cb21-143" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> <span class="co"># module My</span></span>
<span id="cb21-144"><a href="#cb21-144" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-145"><a href="#cb21-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-146"><a href="#cb21-146" aria-hidden="true" tabindex="-1"></a>時間計算量の数え方として, 四則演算, 比較 (<span class="in">`&gt;`</span>, <span class="in">`max`</span> など), 代入, 配列へのアクセスは $O(1)$ とします. すると, 計算回数の主要部は for-loop つまり, $O(n_a^2 T)$ です. メモリ使用量は, 価値関数 $V$ の保存に使用している部分が支配的なので $O(n_a T)$ です. では, $T = 10$ で固定して, $n_a$ を変化させたときの計算時間とメモリ使用量を測定してみましょう.</span>
<span id="cb21-147"><a href="#cb21-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-148"><a href="#cb21-148" aria-hidden="true" tabindex="-1"></a>**BenchmarkTools.jl**</span>
<span id="cb21-149"><a href="#cb21-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-150"><a href="#cb21-150" aria-hidden="true" tabindex="-1"></a>Juliaでは, <span class="in">`BenchmarkTools.jl`</span> パッケージを使うと実際の計算時間とメモリ使用量を測定できます.^<span class="co">[</span><span class="ot">`@time` マクロでも簡易的に測定できますが, 関数の宣言によるコンパイル時間なども含んでしまうため, 関数の実行速度を正確に測定するには `BenchmarkTools.jl` パッケージを使うのが望ましいです.</span><span class="co">]</span></span>
<span id="cb21-151"><a href="#cb21-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-154"><a href="#cb21-154" aria-hidden="true" tabindex="-1"></a><span class="in">```{julia}</span></span>
<span id="cb21-155"><a href="#cb21-155" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">BenchmarkTools</span></span>
<span id="cb21-156"><a href="#cb21-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-157"><a href="#cb21-157" aria-hidden="true" tabindex="-1"></a><span class="pp">@benchmark</span> My.<span class="fu">solve!</span>(m) setup <span class="op">=</span> (m <span class="op">=</span> My.<span class="fu">Model</span>(n_a<span class="op">=</span><span class="fl">100</span>))</span>
<span id="cb21-158"><a href="#cb21-158" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-159"><a href="#cb21-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-160"><a href="#cb21-160" aria-hidden="true" tabindex="-1"></a><span class="in">`@benchmark`</span> マクロは上記のように関数の実行時間に合わせて適切な試行回数を自動で決定し, 実行時間の分布を表示してくれます. 基本的には中央値 (median) を見るのが良いでしょう. </span>
<span id="cb21-161"><a href="#cb21-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-162"><a href="#cb21-162" aria-hidden="true" tabindex="-1"></a>メモリ使用量も8.08KiBと表示されています. 今回の配列 <span class="in">`V`</span> は <span class="in">`Float64`</span> 型の2次元配列で, $n_a$ 行 $T$ 列なので, メモリ使用量は $8 n_a T$ バイトになります (64bit = 8バイト) . 例えば, $n_a = 100$ のときは $8 \times 100 \times 10 = 8000$ バイトで, 8.08KiB (1KiB = 1024バイト) とほぼ一致しています.</span>
<span id="cb21-163"><a href="#cb21-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-164"><a href="#cb21-164" aria-hidden="true" tabindex="-1"></a>次に $n_a = 1000$ としたときの計算時間を測定してみましょう.</span>
<span id="cb21-165"><a href="#cb21-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-168"><a href="#cb21-168" aria-hidden="true" tabindex="-1"></a><span class="in">```{julia}</span></span>
<span id="cb21-169"><a href="#cb21-169" aria-hidden="true" tabindex="-1"></a><span class="pp">@benchmark</span> My.<span class="fu">solve!</span>(m) setup <span class="op">=</span> (m <span class="op">=</span> My.<span class="fu">Model</span>(n_a<span class="op">=</span><span class="fl">1000</span>))</span>
<span id="cb21-170"><a href="#cb21-170" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-171"><a href="#cb21-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-172"><a href="#cb21-172" aria-hidden="true" tabindex="-1"></a>おおむね計算時間が100倍, メモリ使用量が10倍になっていることがわかります. これは, 計算時間が $O(n_a^2 T)$, メモリ使用量が $O(n_a T)$ であることと一致しています.</span>
<span id="cb21-173"><a href="#cb21-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-174"><a href="#cb21-174" aria-hidden="true" tabindex="-1"></a><span class="fu">## 微分</span></span>
<span id="cb21-175"><a href="#cb21-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-176"><a href="#cb21-176" aria-hidden="true" tabindex="-1"></a>数値計算の文脈において微分は主に3種類あります.</span>
<span id="cb21-177"><a href="#cb21-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-178"><a href="#cb21-178" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>数式微分 (Symbolic Differentiation)</span>
<span id="cb21-179"><a href="#cb21-179" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>数値微分 (Numerical Differentiation)</span>
<span id="cb21-180"><a href="#cb21-180" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>自動微分 (Automatic Differentiation)</span>
<span id="cb21-181"><a href="#cb21-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-182"><a href="#cb21-182" aria-hidden="true" tabindex="-1"></a>数式微分 (手計算による解析的な微分) が可能な場合は, これが最も高速で効率的ですが, 複雑な関数に対しては, 数値微分や自動微分などで計算する必要があります. 以下では, 次のラグランジアンを例に, それぞれの微分方法を説明します.</span>
<span id="cb21-183"><a href="#cb21-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-184"><a href="#cb21-184" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-185"><a href="#cb21-185" aria-hidden="true" tabindex="-1"></a>\mathcal{L} = \phi \log \left(w(1-l)\right)  + (1-\phi) \frac{l^{1-\gamma}}{1-\gamma}</span>
<span id="cb21-186"><a href="#cb21-186" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-187"><a href="#cb21-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-188"><a href="#cb21-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-189"><a href="#cb21-189" aria-hidden="true" tabindex="-1"></a><span class="fu">### 数式微分 (Symbolic Differentiation)</span></span>
<span id="cb21-190"><a href="#cb21-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-191"><a href="#cb21-191" aria-hidden="true" tabindex="-1"></a>いわゆる手計算による微分です. 一階条件を求めると,</span>
<span id="cb21-192"><a href="#cb21-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-193"><a href="#cb21-193" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-194"><a href="#cb21-194" aria-hidden="true" tabindex="-1"></a>\frac{\partial \mathcal{L}}{\partial l} = -\frac{\phi}{1-l} + (1-\phi) l^{-\gamma} = 0.</span>
<span id="cb21-195"><a href="#cb21-195" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-196"><a href="#cb21-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-197"><a href="#cb21-197" aria-hidden="true" tabindex="-1"></a><span class="in">`Symbolics.jl`</span> パッケージを使うと, Julia上で数式微分を行うこともできます.</span>
<span id="cb21-198"><a href="#cb21-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-201"><a href="#cb21-201" aria-hidden="true" tabindex="-1"></a><span class="in">```{julia}</span></span>
<span id="cb21-202"><a href="#cb21-202" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: symbolic-diff</span></span>
<span id="cb21-203"><a href="#cb21-203" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: asis</span></span>
<span id="cb21-204"><a href="#cb21-204" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Symbolics</span></span>
<span id="cb21-205"><a href="#cb21-205" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Latexify</span></span>
<span id="cb21-206"><a href="#cb21-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-207"><a href="#cb21-207" aria-hidden="true" tabindex="-1"></a><span class="pp">@variables</span> w l ϕ γ</span>
<span id="cb21-208"><a href="#cb21-208" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> ϕ <span class="op">*</span> <span class="fu">log</span>(w <span class="op">*</span> (<span class="fl">1</span> <span class="op">-</span> l)) <span class="op">+</span> (<span class="fl">1</span> <span class="op">-</span> ϕ) <span class="op">*</span> l<span class="op">^</span>(<span class="fl">1</span> <span class="op">-</span> γ) <span class="op">/</span> (<span class="fl">1</span> <span class="op">-</span> γ)</span>
<span id="cb21-209"><a href="#cb21-209" aria-hidden="true" tabindex="-1"></a>∂l <span class="op">=</span> <span class="fu">Differential</span>(l)</span>
<span id="cb21-210"><a href="#cb21-210" aria-hidden="true" tabindex="-1"></a>∂L∂l <span class="op">=</span> <span class="fu">expand_derivatives</span>(<span class="fu">∂l</span>(L))</span>
<span id="cb21-211"><a href="#cb21-211" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="fu">latexify</span>(∂L∂l))</span>
<span id="cb21-212"><a href="#cb21-212" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-213"><a href="#cb21-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-214"><a href="#cb21-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-215"><a href="#cb21-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-216"><a href="#cb21-216" aria-hidden="true" tabindex="-1"></a><span class="fu">### 数値微分 (Numerical Differentiation)</span></span>
<span id="cb21-217"><a href="#cb21-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-218"><a href="#cb21-218" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-219"><a href="#cb21-219" aria-hidden="true" tabindex="-1"></a>f'(x) = \lim_{\Delta \to 0} \frac{f(x+\Delta) - f(x)}{\Delta}.</span>
<span id="cb21-220"><a href="#cb21-220" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-221"><a href="#cb21-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-222"><a href="#cb21-222" aria-hidden="true" tabindex="-1"></a>数値微分は上記の微分の定義を数値的に近似する方法です. 定義通りに行うと, 非常に小さい $d$ (例えば $10^{-9}$ など) を使って, 以下のように近似できます.</span>
<span id="cb21-223"><a href="#cb21-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-224"><a href="#cb21-224" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-225"><a href="#cb21-225" aria-hidden="true" tabindex="-1"></a>f'(x) \approx \frac{f(x+d) - f(x)}{d}.</span>
<span id="cb21-226"><a href="#cb21-226" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-227"><a href="#cb21-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-228"><a href="#cb21-228" aria-hidden="true" tabindex="-1"></a>実用上は, 中心差分 (central difference) を使うことが多いです.</span>
<span id="cb21-229"><a href="#cb21-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-230"><a href="#cb21-230" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-231"><a href="#cb21-231" aria-hidden="true" tabindex="-1"></a>f'(x) \approx \frac{f(x+\frac{1}{2}d) - f(x-\frac{1}{2}d)}{d}.</span>
<span id="cb21-232"><a href="#cb21-232" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-233"><a href="#cb21-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-234"><a href="#cb21-234" aria-hidden="true" tabindex="-1"></a>Julia では, <span class="in">`FiniteDiff.jl`</span> パッケージを使うと数値微分ができます.</span>
<span id="cb21-235"><a href="#cb21-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-238"><a href="#cb21-238" aria-hidden="true" tabindex="-1"></a><span class="in">```{julia}</span></span>
<span id="cb21-239"><a href="#cb21-239" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: numerical-diff</span></span>
<span id="cb21-240"><a href="#cb21-240" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb21-241"><a href="#cb21-241" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">FiniteDiff</span></span>
<span id="cb21-242"><a href="#cb21-242" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(l; w<span class="op">=</span><span class="fl">1</span>., ϕ<span class="op">=</span><span class="fl">0.5</span>, γ<span class="op">=</span><span class="fl">1.5</span>) <span class="op">=</span> ϕ <span class="op">*</span> <span class="fu">log</span>(w <span class="op">*</span> (<span class="fl">1</span> <span class="op">-</span> l)) <span class="op">+</span> (<span class="fl">1</span> <span class="op">-</span> ϕ) <span class="op">*</span> l<span class="op">^</span>(<span class="fl">1</span> <span class="op">-</span> γ) <span class="op">/</span> (<span class="fl">1</span> <span class="op">-</span> γ)</span>
<span id="cb21-243"><a href="#cb21-243" aria-hidden="true" tabindex="-1"></a><span class="fu">f′_analytical</span>(l; w<span class="op">=</span><span class="fl">1</span>., ϕ<span class="op">=</span><span class="fl">0.5</span>, γ<span class="op">=</span><span class="fl">1.5</span>) <span class="op">=</span> <span class="op">-</span>ϕ <span class="op">/</span> (<span class="fl">1</span> <span class="op">-</span> l) <span class="op">+</span> (<span class="fl">1</span> <span class="op">-</span> ϕ) <span class="op">*</span> l<span class="op">^</span>(<span class="op">-</span>γ)</span>
<span id="cb21-244"><a href="#cb21-244" aria-hidden="true" tabindex="-1"></a><span class="fu">f′_numerical</span>(l; Δ<span class="op">=</span><span class="fl">1e-9</span>) <span class="op">=</span> (<span class="fu">f</span>(l <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> Δ) <span class="op">-</span> <span class="fu">f</span>(l <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> Δ)) <span class="op">/</span> Δ</span>
<span id="cb21-245"><a href="#cb21-245" aria-hidden="true" tabindex="-1"></a><span class="fu">f′_finitediff</span>(l) <span class="op">=</span> FiniteDiff.<span class="fu">finite_difference_derivative</span>(l <span class="op">-&gt;</span> <span class="fu">f</span>(l), l)</span>
<span id="cb21-246"><a href="#cb21-246" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-247"><a href="#cb21-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-250"><a href="#cb21-250" aria-hidden="true" tabindex="-1"></a><span class="in">```{julia}</span></span>
<span id="cb21-251"><a href="#cb21-251" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-comp-numerical-diff</span></span>
<span id="cb21-252"><a href="#cb21-252" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Comparison of analytical and numerical derivatives."</span></span>
<span id="cb21-253"><a href="#cb21-253" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb21-254"><a href="#cb21-254" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fl">0.2</span><span class="op">:</span><span class="fl">0.01</span><span class="op">:</span><span class="fl">0.9</span>, f′_analytical, label<span class="op">=</span><span class="st">"Analytical"</span>)</span>
<span id="cb21-255"><a href="#cb21-255" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(<span class="fl">0.2</span><span class="op">:</span><span class="fl">0.01</span><span class="op">:</span><span class="fl">0.9</span>, f′_numerical, label<span class="op">=</span><span class="st">"Numerical"</span>, linestyle<span class="op">=:</span>dash)</span>
<span id="cb21-256"><a href="#cb21-256" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(<span class="fl">0.2</span><span class="op">:</span><span class="fl">0.01</span><span class="op">:</span><span class="fl">0.9</span>, f′_finitediff, label<span class="op">=</span><span class="st">"FiniteDiff.jl"</span>, linestyle<span class="op">=:</span>dot)</span>
<span id="cb21-257"><a href="#cb21-257" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-258"><a href="#cb21-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-259"><a href="#cb21-259" aria-hidden="true" tabindex="-1"></a><span class="fu">### 自動微分 (Automatic Differentiation)</span></span>
<span id="cb21-260"><a href="#cb21-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-261"><a href="#cb21-261" aria-hidden="true" tabindex="-1"></a>数値微分はとてもシンプルな実装ですが, $d$ の選び方によっては精度が悪くなる可能性があります. より高い精度を求める場合は, 自動微分を用いることができます. 自動微分は, 関数を基本的な演算 (多項式, 三角関数, 対数関数など) の組み合わせとして分解し, 各基本演算の微分を連鎖律に基づいて計算する方法です. これは, 数式微分を数値的に実行するようなイメージです.</span>
<span id="cb21-262"><a href="#cb21-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-263"><a href="#cb21-263" aria-hidden="true" tabindex="-1"></a>**順伝播と逆伝播**</span>
<span id="cb21-264"><a href="#cb21-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-265"><a href="#cb21-265" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-266"><a href="#cb21-266" aria-hidden="true" tabindex="-1"></a>\frac{dy}{dx} = \frac{dy}{du} \cdot \frac{du}{dx}</span>
<span id="cb21-267"><a href="#cb21-267" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-268"><a href="#cb21-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-269"><a href="#cb21-269" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>順伝播 (forward mode): 入力から出力に向かって微分を計算する方法.</span>
<span id="cb21-270"><a href="#cb21-270" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>$\frac{du}{dx}$ を計算し, それを用いて $\frac{dy}{du}$ を計算する.</span>
<span id="cb21-271"><a href="#cb21-271" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>逆伝播 (reverse mode): 出力から入力に向かって微分を計算する方法.</span>
<span id="cb21-272"><a href="#cb21-272" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>$\frac{dy}{du}$ を計算し, それを用いて $\frac{du}{dx}$ を計算する.</span>
<span id="cb21-273"><a href="#cb21-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-274"><a href="#cb21-274" aria-hidden="true" tabindex="-1"></a>一般に $f: \mathbb{R}^m \to \mathbb{R}^n$ に対して, $m &gt; n$ の場合は逆伝播が効率的であり, $m &lt; n$ の場合は順伝播が効率的です. 例えば, ニューラルネットワークでは, 多数のパラメータ (重み) を持つモデルに対して, 単一の損失関数を最小化するために逆伝播がよく使われます.</span>
<span id="cb21-275"><a href="#cb21-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-276"><a href="#cb21-276" aria-hidden="true" tabindex="-1"></a>順伝播の効率的な実装は双対数 (dual numbers) を用いて行えることが知られています. 一方, 逆伝播の効率的な実装は難しく, 様々な手法が提案されている状況です. 詳しくは, @perla の<span class="co">[</span><span class="ot">9.2節</span><span class="co">](https://julia.quantecon.org/more_julia/optimization_solver_packages.html)</span> を参照してください.</span>
<span id="cb21-277"><a href="#cb21-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-278"><a href="#cb21-278" aria-hidden="true" tabindex="-1"></a>Julia では, <span class="in">`ForwardDiff.jl`</span> パッケージを使うと順伝播の自動微分ができます.</span>
<span id="cb21-279"><a href="#cb21-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-282"><a href="#cb21-282" aria-hidden="true" tabindex="-1"></a><span class="in">```{julia}</span></span>
<span id="cb21-283"><a href="#cb21-283" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: automatic-diff</span></span>
<span id="cb21-284"><a href="#cb21-284" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb21-285"><a href="#cb21-285" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ForwardDiff</span></span>
<span id="cb21-286"><a href="#cb21-286" aria-hidden="true" tabindex="-1"></a><span class="fu">f′_forwarddiff</span>(l) <span class="op">=</span> ForwardDiff.<span class="fu">derivative</span>(l <span class="op">-&gt;</span> <span class="fu">f</span>(l), l)</span>
<span id="cb21-287"><a href="#cb21-287" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-288"><a href="#cb21-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-291"><a href="#cb21-291" aria-hidden="true" tabindex="-1"></a><span class="in">```{julia}</span></span>
<span id="cb21-292"><a href="#cb21-292" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-comp-automatic-diff</span></span>
<span id="cb21-293"><a href="#cb21-293" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Comparison of analytical and automatic derivatives."</span></span>
<span id="cb21-294"><a href="#cb21-294" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb21-295"><a href="#cb21-295" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fl">0.2</span><span class="op">:</span><span class="fl">0.01</span><span class="op">:</span><span class="fl">0.9</span>, f′_analytical, label<span class="op">=</span><span class="st">"Analytical"</span>)</span>
<span id="cb21-296"><a href="#cb21-296" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(<span class="fl">0.2</span><span class="op">:</span><span class="fl">0.01</span><span class="op">:</span><span class="fl">0.9</span>, f′_forwarddiff, label<span class="op">=</span><span class="st">"ForwardDiff.jl"</span>, linestyle<span class="op">=:</span>dash)</span>
<span id="cb21-297"><a href="#cb21-297" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-298"><a href="#cb21-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-299"><a href="#cb21-299" aria-hidden="true" tabindex="-1"></a><span class="fu">## 並列計算</span></span>
<span id="cb21-300"><a href="#cb21-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-301"><a href="#cb21-301" aria-hidden="true" tabindex="-1"></a>現代のPCは複数のコアを持つマルチコアCPUを搭載しています. パッケージのバックグラウンドで並列計算が用いられていることもありますが, 基本的にはユーザーが明示的に並列計算を指示する必要があります.</span>
<span id="cb21-302"><a href="#cb21-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-303"><a href="#cb21-303" aria-hidden="true" tabindex="-1"></a>まずは, 自分のPCが何コア持っているかを確認してみましょう.</span>
<span id="cb21-304"><a href="#cb21-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-307"><a href="#cb21-307" aria-hidden="true" tabindex="-1"></a><span class="in">```{julia}</span></span>
<span id="cb21-308"><a href="#cb21-308" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: check-cores</span></span>
<span id="cb21-309"><a href="#cb21-309" aria-hidden="true" tabindex="-1"></a><span class="bu">Threads</span>.<span class="fu">nthreads</span>()</span>
<span id="cb21-310"><a href="#cb21-310" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-311"><a href="#cb21-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-312"><a href="#cb21-312" aria-hidden="true" tabindex="-1"></a>ここで, スレッド数が1となっている場合は, Juliaを起動する前に環境変数 <span class="in">`JULIA_NUM_THREADS`</span> を設定する必要があります. </span>
<span id="cb21-313"><a href="#cb21-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-314"><a href="#cb21-314" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Quarto: <span class="in">`julia.exeflags: ["--threads=auto"]`</span> をYAMLヘッダーに追加</span>
<span id="cb21-315"><a href="#cb21-315" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>VSCode: <span class="in">`settings.json`</span> に <span class="in">`"julia.numThreads": "auto"`</span> を追加</span>
<span id="cb21-316"><a href="#cb21-316" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>ターミナル: <span class="in">`export JULIA_NUM_THREADS=auto`</span> を実行</span>
<span id="cb21-317"><a href="#cb21-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-318"><a href="#cb21-318" aria-hidden="true" tabindex="-1"></a><span class="in">`auto`</span> と設定した場合, 利用可能なコア数に応じて自動的にスレッド数が設定されます. 現代のPCであれば, ほとんどの場合, 利用可能なコア数が2以上になるはずです.</span>
<span id="cb21-319"><a href="#cb21-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-322"><a href="#cb21-322" aria-hidden="true" tabindex="-1"></a><span class="in">```{julia}</span></span>
<span id="cb21-323"><a href="#cb21-323" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: define-solve-multi</span></span>
<span id="cb21-324"><a href="#cb21-324" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb21-325"><a href="#cb21-325" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">solve_multi!</span>(m<span class="op">::</span><span class="dt">My.Model</span>)</span>
<span id="cb21-326"><a href="#cb21-326" aria-hidden="true" tabindex="-1"></a>    (; T, n_a, r, w, β, a_grid) <span class="op">=</span> m</span>
<span id="cb21-327"><a href="#cb21-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-328"><a href="#cb21-328" aria-hidden="true" tabindex="-1"></a>    V <span class="op">=</span> <span class="fu">zeros</span>(n_a, T)</span>
<span id="cb21-329"><a href="#cb21-329" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="op">=</span> T<span class="op">:-</span><span class="fl">1</span><span class="op">:</span><span class="fl">1</span></span>
<span id="cb21-330"><a href="#cb21-330" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Threads</span>.<span class="pp">@threads</span> <span class="cf">for</span> i_a <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>n_a</span>
<span id="cb21-331"><a href="#cb21-331" aria-hidden="true" tabindex="-1"></a>            utility <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span></span>
<span id="cb21-332"><a href="#cb21-332" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i_a′ <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>n_a</span>
<span id="cb21-333"><a href="#cb21-333" aria-hidden="true" tabindex="-1"></a>                V′ <span class="op">=</span> (t <span class="op">==</span> T) ? <span class="fl">0.0</span> <span class="op">:</span> V[i_a′, t<span class="op">+</span><span class="fl">1</span>]</span>
<span id="cb21-334"><a href="#cb21-334" aria-hidden="true" tabindex="-1"></a>                c <span class="op">=</span> (<span class="fl">1</span> <span class="op">+</span> r) <span class="op">*</span> a_grid[i_a] <span class="op">+</span> w <span class="op">-</span> a_grid[i_a′]</span>
<span id="cb21-335"><a href="#cb21-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-336"><a href="#cb21-336" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> c <span class="op">&gt;</span> <span class="fl">0</span></span>
<span id="cb21-337"><a href="#cb21-337" aria-hidden="true" tabindex="-1"></a>                    utility <span class="op">=</span> <span class="fu">max</span>(My.<span class="fu">u</span>(c, m) <span class="op">+</span> β <span class="op">*</span> V′, utility)</span>
<span id="cb21-338"><a href="#cb21-338" aria-hidden="true" tabindex="-1"></a>                <span class="cf">end</span></span>
<span id="cb21-339"><a href="#cb21-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-340"><a href="#cb21-340" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb21-341"><a href="#cb21-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-342"><a href="#cb21-342" aria-hidden="true" tabindex="-1"></a>            V[i_a, t] <span class="op">=</span> utility</span>
<span id="cb21-343"><a href="#cb21-343" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb21-344"><a href="#cb21-344" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb21-345"><a href="#cb21-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-346"><a href="#cb21-346" aria-hidden="true" tabindex="-1"></a>    m.V <span class="op">.=</span> V</span>
<span id="cb21-347"><a href="#cb21-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-348"><a href="#cb21-348" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="cn">nothing</span></span>
<span id="cb21-349"><a href="#cb21-349" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb21-350"><a href="#cb21-350" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-351"><a href="#cb21-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-354"><a href="#cb21-354" aria-hidden="true" tabindex="-1"></a><span class="in">```{julia}</span></span>
<span id="cb21-355"><a href="#cb21-355" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: benchmark-single</span></span>
<span id="cb21-356"><a href="#cb21-356" aria-hidden="true" tabindex="-1"></a><span class="pp">@benchmark</span> My.<span class="fu">solve!</span>(m) setup <span class="op">=</span> (m <span class="op">=</span> My.<span class="fu">Model</span>(n_a<span class="op">=</span><span class="fl">1000</span>))</span>
<span id="cb21-357"><a href="#cb21-357" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-358"><a href="#cb21-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-361"><a href="#cb21-361" aria-hidden="true" tabindex="-1"></a><span class="in">```{julia}</span></span>
<span id="cb21-362"><a href="#cb21-362" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: benchmark-multi</span></span>
<span id="cb21-363"><a href="#cb21-363" aria-hidden="true" tabindex="-1"></a><span class="pp">@benchmark</span> <span class="fu">solve_multi!</span>(m) setup <span class="op">=</span> (m <span class="op">=</span> My.<span class="fu">Model</span>(n_a<span class="op">=</span><span class="fl">1000</span>))</span>
<span id="cb21-364"><a href="#cb21-364" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-365"><a href="#cb21-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-366"><a href="#cb21-366" aria-hidden="true" tabindex="-1"></a>並列化した場合, 1コアで実行した場合と比べて, おおむねスレッド数に応じて計算時間が短縮されていることがわかります. ただし, ここまで理論値に近い速度向上が得られることは稀で, 実際には理論値の数%から数十%程度の速度向上にとどまることが多いです.</span>
<span id="cb21-367"><a href="#cb21-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-368"><a href="#cb21-368" aria-hidden="true" tabindex="-1"></a>**並列化できない計算**</span>
<span id="cb21-369"><a href="#cb21-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-370"><a href="#cb21-370" aria-hidden="true" tabindex="-1"></a>並列計算の大前提は, 各スレッドが独立して計算できることです. 今回は後方帰納法で解くため, 時刻 $t$ の価値関数を計算する際に, 時刻 $t+1$ の価値関数が必要になり, 時刻方向に並列化することはできません.</span>
<span id="cb21-371"><a href="#cb21-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-374"><a href="#cb21-374" aria-hidden="true" tabindex="-1"></a><span class="in">```{julia}</span></span>
<span id="cb21-375"><a href="#cb21-375" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: define-solve-muli-illegal</span></span>
<span id="cb21-376"><a href="#cb21-376" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb21-377"><a href="#cb21-377" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">solve_multi_illegal!</span>(m<span class="op">::</span><span class="dt">My.Model</span>)</span>
<span id="cb21-378"><a href="#cb21-378" aria-hidden="true" tabindex="-1"></a>    (; T, n_a, r, w, β, a_grid) <span class="op">=</span> m</span>
<span id="cb21-379"><a href="#cb21-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-380"><a href="#cb21-380" aria-hidden="true" tabindex="-1"></a>    V <span class="op">=</span> <span class="fu">zeros</span>(n_a, T)</span>
<span id="cb21-381"><a href="#cb21-381" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Threads</span>.<span class="pp">@threads</span> <span class="cf">for</span> t <span class="op">=</span> T<span class="op">:-</span><span class="fl">1</span><span class="op">:</span><span class="fl">1</span></span>
<span id="cb21-382"><a href="#cb21-382" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i_a <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>n_a</span>
<span id="cb21-383"><a href="#cb21-383" aria-hidden="true" tabindex="-1"></a>            utility <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span></span>
<span id="cb21-384"><a href="#cb21-384" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i_a′ <span class="op">=</span> <span class="fl">1</span><span class="op">:</span>n_a</span>
<span id="cb21-385"><a href="#cb21-385" aria-hidden="true" tabindex="-1"></a>                V′ <span class="op">=</span> (t <span class="op">==</span> T) ? <span class="fl">0.0</span> <span class="op">:</span> V[i_a′, t<span class="op">+</span><span class="fl">1</span>]</span>
<span id="cb21-386"><a href="#cb21-386" aria-hidden="true" tabindex="-1"></a>                c <span class="op">=</span> (<span class="fl">1</span> <span class="op">+</span> r) <span class="op">*</span> a_grid[i_a] <span class="op">+</span> w <span class="op">-</span> a_grid[i_a′]</span>
<span id="cb21-387"><a href="#cb21-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-388"><a href="#cb21-388" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> c <span class="op">&gt;</span> <span class="fl">0</span></span>
<span id="cb21-389"><a href="#cb21-389" aria-hidden="true" tabindex="-1"></a>                    utility <span class="op">=</span> <span class="fu">max</span>(My.<span class="fu">u</span>(c, m) <span class="op">+</span> β <span class="op">*</span> V′, utility)</span>
<span id="cb21-390"><a href="#cb21-390" aria-hidden="true" tabindex="-1"></a>                <span class="cf">end</span></span>
<span id="cb21-391"><a href="#cb21-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-392"><a href="#cb21-392" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb21-393"><a href="#cb21-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-394"><a href="#cb21-394" aria-hidden="true" tabindex="-1"></a>            V[i_a, t] <span class="op">=</span> utility</span>
<span id="cb21-395"><a href="#cb21-395" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb21-396"><a href="#cb21-396" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb21-397"><a href="#cb21-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-398"><a href="#cb21-398" aria-hidden="true" tabindex="-1"></a>    m.V <span class="op">.=</span> V</span>
<span id="cb21-399"><a href="#cb21-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-400"><a href="#cb21-400" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="cn">nothing</span></span>
<span id="cb21-401"><a href="#cb21-401" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb21-402"><a href="#cb21-402" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-403"><a href="#cb21-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-406"><a href="#cb21-406" aria-hidden="true" tabindex="-1"></a><span class="in">```{julia}</span></span>
<span id="cb21-407"><a href="#cb21-407" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-vf-illegal</span></span>
<span id="cb21-408"><a href="#cb21-408" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Value function computed with illegal parallelization."</span></span>
<span id="cb21-409"><a href="#cb21-409" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb21-410"><a href="#cb21-410" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> My.<span class="fu">Model</span>(n_a<span class="op">=</span><span class="fl">100</span>)</span>
<span id="cb21-411"><a href="#cb21-411" aria-hidden="true" tabindex="-1"></a><span class="fu">solve_multi_illegal!</span>(m)</span>
<span id="cb21-412"><a href="#cb21-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-413"><a href="#cb21-413" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m.a_grid, m.V[<span class="op">:</span>, <span class="kw">end</span>], xlabel<span class="op">=</span>L<span class="st">"a"</span>, ylabel<span class="op">=</span>L<span class="st">"V(a, t)"</span>, label<span class="op">=</span>L<span class="st">"t=T"</span>)</span>
<span id="cb21-414"><a href="#cb21-414" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(m.a_grid, m.V[<span class="op">:</span>, <span class="kw">end</span><span class="op">-</span><span class="fl">2</span>], label<span class="op">=</span>L<span class="st">"t=T-2"</span>)</span>
<span id="cb21-415"><a href="#cb21-415" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(m.a_grid, m.V[<span class="op">:</span>, begin], label<span class="op">=</span>L<span class="st">"t=1"</span>)</span>
<span id="cb21-416"><a href="#cb21-416" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-417"><a href="#cb21-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-418"><a href="#cb21-418" aria-hidden="true" tabindex="-1"></a>@fig-vf-illegal のように, 時間方向に並列化すると正しい価値関数が得られません.</span>
<span id="cb21-419"><a href="#cb21-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-420"><a href="#cb21-420" aria-hidden="true" tabindex="-1"></a><span class="fu">## Monte Carlo Simulation for SMM</span></span>
<span id="cb21-421"><a href="#cb21-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-422"><a href="#cb21-422" aria-hidden="true" tabindex="-1"></a>SMM (Simulated Method of Moments) のようなシミュレーションベースの推定では, モデルのパラメータを変化させながら (モンテカルロ) シミュレーションを繰り返す必要があります. このとき, 正確に実装しないと, モデルのパラメータを変化させるたびに, ランダムな数を生成してまい, 正確な最適化ができません. そのため, モデルのパラメータを変化させるたびに, 新たに乱数を生成するのではなく, 事前に乱数を生成しておき, それを使いまわす必要があります.</span>
<span id="cb21-423"><a href="#cb21-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-424"><a href="#cb21-424" aria-hidden="true" tabindex="-1"></a>例として, 第二回の授業で扱った次のモデルを考えましょう.</span>
<span id="cb21-425"><a href="#cb21-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-426"><a href="#cb21-426" aria-hidden="true" tabindex="-1"></a>**モデル**</span>
<span id="cb21-427"><a href="#cb21-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-428"><a href="#cb21-428" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-429"><a href="#cb21-429" aria-hidden="true" tabindex="-1"></a>\max_{c, l} u(c, l) = \log c + \alpha \log (1-l) \quad \text{s.t.} \quad c = w (1 - l),</span>
<span id="cb21-430"><a href="#cb21-430" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-431"><a href="#cb21-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-432"><a href="#cb21-432" aria-hidden="true" tabindex="-1"></a>where</span>
<span id="cb21-433"><a href="#cb21-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-434"><a href="#cb21-434" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-435"><a href="#cb21-435" aria-hidden="true" tabindex="-1"></a>\log w \sim \mathcal{N}(\mu, \sigma).</span>
<span id="cb21-436"><a href="#cb21-436" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb21-437"><a href="#cb21-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-438"><a href="#cb21-438" aria-hidden="true" tabindex="-1"></a>標準化のため, $\mu = 0$ とする. この時, $\theta = (\alpha, \sigma)$ を推定する.</span>
<span id="cb21-439"><a href="#cb21-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-442"><a href="#cb21-442" aria-hidden="true" tabindex="-1"></a><span class="in">```{julia}</span></span>
<span id="cb21-443"><a href="#cb21-443" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: prep-dist-earn</span></span>
<span id="cb21-444"><a href="#cb21-444" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb21-445"><a href="#cb21-445" aria-hidden="true" tabindex="-1"></a>mean_leisure_data <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fl">33.4</span> <span class="op">/</span> (<span class="fl">16</span> <span class="op">*</span> <span class="fl">7</span>)</span>
<span id="cb21-446"><a href="#cb21-446" aria-hidden="true" tabindex="-1"></a>earn <span class="op">=</span> [<span class="fl">25</span>, <span class="fl">75</span>, <span class="fl">150</span>, <span class="fl">250</span>, <span class="fl">350</span>, <span class="fl">450</span>, <span class="fl">550</span>, <span class="fl">650</span>, <span class="fl">750</span>, <span class="fl">850</span>, <span class="fl">950</span>, <span class="fl">1100</span>, <span class="fl">1200</span>]</span>
<span id="cb21-447"><a href="#cb21-447" aria-hidden="true" tabindex="-1"></a>density <span class="op">=</span> [<span class="fl">13.7</span>, <span class="fl">12.2</span>, <span class="fl">12.3</span>, <span class="fl">14.8</span>, <span class="fl">20.2</span>, <span class="fl">16.3</span>, <span class="fl">7.0</span>, <span class="fl">2.0</span>, <span class="fl">0.6</span>, <span class="fl">0.4</span>, <span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>] <span class="op">/</span> <span class="fl">100</span></span>
<span id="cb21-448"><a href="#cb21-448" aria-hidden="true" tabindex="-1"></a>mean_learn_data <span class="op">=</span> density<span class="op">'</span> <span class="op">*</span> <span class="fu">log</span>.(earn)</span>
<span id="cb21-449"><a href="#cb21-449" aria-hidden="true" tabindex="-1"></a>sd_learn_data <span class="op">=</span> <span class="fu">sqrt</span>(density<span class="op">'</span> <span class="op">*</span> (<span class="fu">log</span>.(earn) <span class="op">.-</span> mean_learn_data) <span class="op">.^</span> <span class="fl">2</span>)</span>
<span id="cb21-450"><a href="#cb21-450" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-451"><a href="#cb21-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-452"><a href="#cb21-452" aria-hidden="true" tabindex="-1"></a>**悪い実装例**</span>
<span id="cb21-453"><a href="#cb21-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-456"><a href="#cb21-456" aria-hidden="true" tabindex="-1"></a><span class="in">```{julia}</span></span>
<span id="cb21-457"><a href="#cb21-457" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">mc_bad</span>(α, σ; n_mc<span class="op">=</span><span class="fl">10</span><span class="op">^</span><span class="fl">6</span>)</span>
<span id="cb21-458"><a href="#cb21-458" aria-hidden="true" tabindex="-1"></a>    ls <span class="op">=</span> <span class="fu">zeros</span>(n_mc)</span>
<span id="cb21-459"><a href="#cb21-459" aria-hidden="true" tabindex="-1"></a>    learns <span class="op">=</span> <span class="fu">similar</span>(ls)</span>
<span id="cb21-460"><a href="#cb21-460" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>n_mc</span>
<span id="cb21-461"><a href="#cb21-461" aria-hidden="true" tabindex="-1"></a>        w <span class="op">=</span> <span class="fu">rand</span>(<span class="fu">LogNormal</span>(<span class="fl">0</span>, σ))</span>
<span id="cb21-462"><a href="#cb21-462" aria-hidden="true" tabindex="-1"></a>        l_opt <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> (<span class="fl">1</span> <span class="op">+</span> α)</span>
<span id="cb21-463"><a href="#cb21-463" aria-hidden="true" tabindex="-1"></a>        c_opt <span class="op">=</span> w <span class="op">*</span> (<span class="fl">1</span> <span class="op">-</span> l_opt)</span>
<span id="cb21-464"><a href="#cb21-464" aria-hidden="true" tabindex="-1"></a>        ls[i] <span class="op">=</span> l_opt</span>
<span id="cb21-465"><a href="#cb21-465" aria-hidden="true" tabindex="-1"></a>        learns[i] <span class="op">=</span> <span class="fu">log</span>(w)</span>
<span id="cb21-466"><a href="#cb21-466" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb21-467"><a href="#cb21-467" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [<span class="fu">mean</span>(ls), <span class="fu">std</span>(ls)]</span>
<span id="cb21-468"><a href="#cb21-468" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb21-469"><a href="#cb21-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-470"><a href="#cb21-470" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-471"><a href="#cb21-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-472"><a href="#cb21-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-473"><a href="#cb21-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-474"><a href="#cb21-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-475"><a href="#cb21-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-476"><a href="#cb21-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-477"><a href="#cb21-477" aria-hidden="true" tabindex="-1"></a>では, SMMで推定するパラメータが確率分布のパラメータであるときは, どのように乱数を生成すれば良いでしょうか. これには大きく二つの方法があります.</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>